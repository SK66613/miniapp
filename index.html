<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Mini‑app | Router + BackButton + No-Swipe (robust)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
const tg = window.Telegram && window.Telegram.WebApp;

function openAsMainMiniApp(startParam = 'home'){
  const url = `https://t.me/serge_kamensky_bot/app?startapp=${encodeURIComponent(startParam)}`;
  // если мы внутри Telegram — откроется во встроенном контейнере (фуллскрин)
  if (tg && typeof tg.openTelegramLink === 'function') {
    tg.openTelegramLink(url);
  } else {
    // открыто в браузере (не в Telegram) → покажем страницу t.me (нормально)
    window.open(url, '_blank');
  }
}
</script>


  <style>
    :root{
      --tabH: 64px;
      --navGap: 12px;
      --bg:#0b0c15; --text:#f4f6fa; --border:rgba(255,255,255,.10);
      --appW: 428px;
    }
    *{ box-sizing:border-box }
    img{ max-width:100%; display:block }
    html,body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      overscroll-behavior: none;
    }
    @media (min-width:900px){ body{ display:grid; place-items:center; } }
    .wrap{
      width:100%; max-width:1080px; margin:0 auto;
      min-height:100svh;
      padding:16px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px);
    }
    @media (min-width:900px){
      .wrap{ max-width:var(--appW); padding:20px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px); }
    }
    main>section, section.page{ display:none }
    main>section.active, section.page.active{ display:block }
    .btm-nav{
      position:fixed; left:0; right:0;
      bottom: calc(var(--navGap) + env(safe-area-inset-bottom, 0px));
      height: var(--tabH);
      z-index: 9999;
      display:grid; grid-template-columns:repeat(5,1fr); align-items:center;
      padding: 6px 6px 6px;
      background: rgba(10,12,14,.72);
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      border-left:0; border-right:0; border-bottom:0;
      border-radius: 16px 16px 0 0;
    }
    .btm-nav .tab{
      height:100%; border:0; background:none; color:#dfe3e6; cursor:pointer;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
      font-size:11px; font-weight:700;
      filter: grayscale(.35) saturate(.8); opacity:.85;
      border-radius:14px; -webkit-tap-highlight-color:transparent;
    }
    .btm-nav .tab img{ width:24px; height:24px }
    .btm-nav .tab:active{ transform: translateY(1px) }
    .btm-nav .tab.active{ opacity:1; filter:none; color:#fff; position:relative }
    .btm-nav .tab.active::before{
      content:""; position:absolute; inset:6px 10px 18px 10px; z-index:-1;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    @media (min-width:900px){
      .btm-nav{ left:50%; right:auto; width: var(--appW); transform: translateX(-50%); }
    }
    .card{ background:rgba(255,255,255,.05); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .page-title{ margin:0 0 12px }
    .h1{ font-weight:800; font-size:20px; margin:0 0 8px }
    .muted-sm{ opacity:.8 }
    .sheet{ position:fixed; inset:0; z-index:9990; pointer-events:none; }
    .sheet.is-open{ pointer-events:auto; }
    .sheet__overlay{
      position:absolute; left:0; right:0; top:0;
      bottom: calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      background: rgba(0,0,0,.48); opacity:0; transition:opacity .2s ease;
      -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
    }
    .sheet.is-open .sheet__overlay{ opacity:1; }
    .sheet__panel{
      position:absolute; left:0; right:0; margin:0 auto;
      width:min(820px,100%); max-height:88vh; overflow:auto;
      background:linear-gradient(180deg, rgba(18,20,24,.98), rgba(18,20,24,.96));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 20px 40px rgba(0,0,0,.45);
      transition: transform .28s cubic-bezier(.2,.8,.2,1), opacity .2s ease;
      padding:12px 14px calc(16px + var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      will-change: transform;
      touch-action: pan-y;
    }
    .sheet.sheet-bottom .sheet__panel{ bottom:0; top:auto; border-radius: 16px 16px 0 0; transform: translateY(100%); }
    .sheet.is-open.sheet-bottom .sheet__panel{ transform: translateY(0); }
    .sheet__handle{ width:42px; height:4px; border-radius:999px; margin:6px auto 10px; background:rgba(255,255,255,.18) }
    .sheet__header{ display:flex; align-items:center; gap:10px; margin:0 0 8px }
    .sheet__title{ font-weight:800; font-size:18px; margin:0 }
    .sheet__close{ margin-left:auto; border:0; background:transparent; color:#fff; opacity:.85; width:36px; height:36px; border-radius:10px; display:grid; place-items:center }
    .sheet__close:active{ transform:translateY(1px); opacity:1 }
    .sheet__body{ display:grid; gap:10px }
    body.sheet-open{ overflow:hidden }
    @media (min-width:900px){ .sheet__panel{ width:min(var(--appW),92vw); } }
  </style>


<style>
/* ===== ГЛАВНАЯ HERO GIF (full-bleed) ===== */
:root{
  --wrapPadX: 14px;   /* должен совпасть с боковыми паддингами .wrap */
  --wrapPadTop: 16px; /* верхний паддинг .wrap */
}
.hero{
  position: relative;
  margin: calc(-1 * var(--wrapPadTop)) calc(-1 * var(--wrapPadX)) 14px;
  padding-top: env(safe-area-inset-top, 0px);
  background:#000; overflow:hidden;
}
.hero__media{
  width:100%;
  height: clamp(260px, 42vh, 460px);
  object-fit: cover; display:block;
}
.hero::after{
  content:""; position:absolute; left:0; right:0; bottom:-1px; height:84px;
  pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 100%);
}

/* ===== PROMO (одна плашка, без .card-обёртки) ===== */
.promo{
  display:grid; grid-template-columns:48px 1fr auto; align-items:center; gap:12px;
  padding:10px 12px; margin:0 0 12px;
  background: rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
}
.promo__icon{ width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden }
.promo__icon img{ width:28px; height:28px; display:block }
.promo__title{ font-weight:800 }
.promo__sub{ opacity:.8; font-size:13px; margin-top:2px }
.promo__btn{
  height:36px; padding:0 14px; border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(180deg,#2d7cff,#0f56ff); color:#fff; font-weight:800; cursor:pointer;
}
.promo__btn:active{ transform: translateY(1px) }

/* ===== LIST CARD ("Start here") ===== */
.list-card .list-head{ font:800 16px/1.2 Inter,system-ui; margin-bottom:8px }
.list{ display:grid; gap:8px }

/* Убираем фон и рамки у пунктов */
.list-card .list__item{ background:transparent; border:0; box-shadow:none }

/* Сдвигаем левее и выравниваем под заголовок карточки */
.list-card.tight .list{ margin-left:-16px; margin-right:-16px } /* 16 = padding .card */
.list-card.tight .list__item{
  padding:12px 16px; gap:10px;
  display:grid; grid-template-columns:36px 1fr auto; align-items:center;
}
.list-card.tight .list__icon{
  width:36px; height:36px; border-radius:10px;
  display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden
}
.list-card.tight .list__icon img{ width:22px; height:22px; display:block }
.list__text{ display:grid; gap:4px }
.list__title{ font-weight:800 }
.list__sub{ opacity:.8; font-size:13px }

/* Кликабельная только стрелка */
.list__chev-btn{
  width:36px; height:36px; display:grid; place-items:center;
  border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:transparent; color:inherit; font-size:18px; cursor:pointer;
}
.list__chev-btn:active{ transform:translateY(1px) }

/* ховер по желанию */
.list-card .list__item:hover{ background: rgba(255,255,255,.04) }

/* центрирование на десктопе под мобильное полотно */
@media (min-width:900px){
  .hero{
    margin-left: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
    margin-right: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
  }
}


</style>

<style>
  /* ===== FULLSCREEN INTRO ===== */
/* ===== FULLSCREEN INTRO (обновлено) ===== */
:root{ --introBottomPad: 28px; } /* насколько выше кнопки от нижней перекладины */

.intro{
  position:fixed; inset:0; z-index:10050;
  background:#000; color:#fff;
  display:none; pointer-events:auto;
}
.intro.is-open{ display:block; }
body.intro-open{ overflow:hidden; }

.intro__wrap{
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  padding:
    calc(env(safe-area-inset-top,0px) + 6px)
    14px
    calc(env(safe-area-inset-bottom,0px) + var(--introBottomPad));
}

.intro__progress{
  display:flex; gap:8px; justify-content:center;
  padding:8px 0 12px;
}
.intro__seg{ width:44px; height:4px; border-radius:999px; background:rgba(255,255,255,.28) }
.intro__seg.active{ background:#fff }

.intro__stage{
  flex:1; display:grid; place-items:center; padding:12px; text-align:center;
}
.intro__slides{ width:100% }
.intro__slide{ display:none }
.intro__slide.active{ display:block }

.intro__h1{ font-weight:900; font-size:28px; margin:0 0 10px }
.intro__p{ opacity:.85; font-size:15px; margin:0 auto; max-width:26ch }

/* низ экрана — динамически рендерим набор кнопок */
.intro__actions{
  margin-top:auto; display:grid; gap:10px;
  padding-top:8px;
}
.intro__actions--one{ grid-template-columns:1fr }
.intro__actions--two{ grid-template-columns:1fr 1fr }

.intro__btn{
  height:52px; padding:0 16px; border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.intro__btn--primary{ background:#fff; color:#000; border-color:#fff }
.intro__btn--ghost{ background:transparent }
.intro__btn:active{ transform:translateY(1px) }

@media (min-width:900px){
  .intro__wrap{ max-width: var(--appW,428px); margin:0 auto }
}
</style>
 <style>
/* ===== FULLSCREEN CLICKER v2 ===== */
.clicker{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.clicker.is-open{ display:block; }
body.clicker-open{ overflow:hidden; }

.clicker__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* TIMER */
.timer{ width:100%; max-width:520px; margin:0 auto 10px; }
.timer__row{ display:grid; justify-items:center; gap:6px; }
.timer__text{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.timer__bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.timer__bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* COUNTER (мини-иконка + число) */
.clicker__counter{
  align-self:center; display:flex; align-items:center; gap:10px;
  min-height:40px; padding:6px 12px; border-radius:999px;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  font:800 18px/1 Inter,system-ui;
}
.counter__mini{ width:26px; height:26px; border-radius:6px; overflow:hidden; display:block }

.clicker__stage{ flex:1; display:grid; place-items:center; position:relative; touch-action:manipulation; user-select:none; }
.clicker__img{
  width:min(84vw,520px); height:auto; display:block; cursor:pointer;
  -webkit-user-drag:none; -webkit-tap-highlight-color:transparent;
  filter: drop-shadow(0 20px 60px rgba(0,255,255,.12));
  transition: transform 90ms ease, filter 120ms ease;
}
.clicker__img.is-press{ transform:scale(.96); filter:drop-shadow(0 6px 24px rgba(0,255,255,.25)); }

.clicker__score{
  width:100%; max-width:520px; margin:12px auto 0;
  display:grid; grid-template-columns:1fr 1fr auto; align-items:center; gap:14px;
  padding:12px 16px; border-radius:18px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  visibility:hidden; opacity:0; transition:.2s ease;
}
.clicker__score.show{ visibility:visible; opacity:1; }
.score__cell{ display:grid; gap:4px; justify-items:center }
.score__val{ font:800 20px/1 Inter,system-ui }
.score__sub{ font:600 12px/1.1 Inter,system-ui; opacity:.8 }
.score__chev{ font:20px/1 Inter; opacity:.6 }

/* CTA (появляется после таймера) */
.clicker__cta{
  position:absolute; left:14px; right:14px;
  bottom: calc(env(safe-area-inset-bottom,0px) + 12px);
  display:none;
}
.clicker__cta .btn{
  width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter,system-ui;
  background:#fff; color:#000; border:1px solid #fff;
}
.clicker__cta.show{ display:block; }

/* эффекты */
.spark{ position:absolute; pointer-events:none; font-weight:900; font-size:22px; color:#6be3ff;
  transform:translate(-50%,-50%); animation:spark-rise .7s ease-out forwards; text-shadow:0 0 10px rgba(107,227,255,.55); }
@keyframes spark-rise{ 0%{opacity:1;transform:translate(-50%,-50%) scale(1)} 60%{opacity:.9;transform:translate(-50%,-110%) scale(1.05)} 100%{opacity:0;transform:translate(-50%,-170%) scale(.9)} }
.ripple{ position:absolute; width:14px; height:14px; border-radius:999px; border:2px solid rgba(255,255,255,.35);
  transform:translate(-50%,-50%); pointer-events:none; animation:ripple .45s ease-out forwards; }
@keyframes ripple{ to{ width:140px; height:140px; opacity:0; } }

@media (min-width:900px){ .clicker__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* === настройки отступа снизу для CTA === */
:root{
  --ctaGap: 44px; /* подними/опусти кнопку: 36–56px обычно идеально */
}

/* кнопка внизу — учёт палочки и safe-area */
.clicker__cta{
  position:absolute; left:14px; right:14px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + var(--ctaGap));
  display:none;
}
.clicker__cta.show{ display:block; }

/* === СЧЁТ БЕЗ ПИЛЛЫ/РАМКИ, ×3 крупнее === */
.clicker__counter{
  /* убираем «пиллу» */
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  /* компоновка и отступы */
  align-self:center;
  display:flex; align-items:center; gap:14px;
  padding: 0; min-height: 0;
}

/* мини-иконка у счёта — 3× от прежних ~26px (адаптивно) */
.counter__mini{
  width: clamp(60px, 18vw, 90px);
  height: clamp(60px, 18vw, 90px);
  border-radius: 14px;
  overflow: hidden;
  display:block;
}

#counter-val{
  font-weight: 900;
  font-size: clamp(36px, 8vw, 56px); /* было 48 / 10vw / 72 */
  line-height: 1;
  letter-spacing: .2px;
  text-shadow: 0 2px 10px rgba(0,0,0,.25);
}
 </style>

 <style>
  /* ===== GAMES CARD ===== */
.list-card.games .list__item{ background:transparent; border:0; box-shadow:none }
.list__btn{
  height:36px; padding:0 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.list__btn--primary{ background:#fff; color:#000; border-color:#fff }
.list__btn:active{ transform:translateY(1px) }

/* чуть плотнее сетка под кнопку справа */
.list-card.games.tight .list__item{
  grid-template-columns:36px 1fr auto;
}
:root{ --gap-block: 16px; }           /* подправь число при желании */
.card.list-card.games{ margin-top: var(--gap-block); }

 </style>

 <style>
  /* ===== LEADERBOARD (Clicker) ===== */
.lb-card { padding:12px; }
.lb-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.lb-title{ font-weight:900; font-size:18px; }
.lb-sub{ opacity:.75; font-weight:600; font-size:12px; }

.lb-seg{
  display:inline-grid; grid-auto-flow:column; gap:6px; padding:4px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
}
.lb-seg button{
  height:30px; min-width:86px; padding:0 12px; border-radius:999px; border:0; cursor:pointer;
  font-weight:800; color:#fff; background:transparent;
}
.lb-seg button[aria-pressed="true"]{ background:#fff; color:#000; }

.lb-you{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  margin-bottom:10px;
}
.lb-you__avatar{
  width:36px; height:36px; border-radius:10px; background:#222; display:grid; place-items:center; font-weight:900;
}
.lb-you__name{ font-weight:800; }
.lb-you__score{ margin-left:auto; font-weight:900; }

.lb-list{ display:flex; flex-direction:column; gap:8px; }
.lb-row{
  display:grid; grid-template-columns:28px 36px 1fr auto; align-items:center; gap:10px;
  padding:10px 12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03); border-radius:14px;
}
.lb-rank{ font-weight:900; opacity:.9; text-align:center; }
.lb-avatar{ width:36px; height:36px; border-radius:10px; background:#1b1c22; display:grid; place-items:center; font-weight:900; }
.lb-name{ font-weight:800; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.lb-score{ font-weight:900; }

.lb-medal-1 .lb-rank{ color:#ffd34d; }
.lb-medal-2 .lb-rank{ color:#cbd3ff; }
.lb-medal-3 .lb-rank{ color:#ffb27a; }

.lb-actions{ display:flex; gap:10px; margin-top:12px; }
.lb-btn{
  flex:1; height:42px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; font-weight:800; cursor:pointer;
}
.lb-btn--primary{ background:#fff; color:#000; border-color:#fff; }

@media (min-width:900px){
  #leaderboard .inner{ max-width: var(--appW, 428px); margin:0 auto; }
}

 </style>

 <style>
/* ===== TARGET POPPER v2 (overlay) ===== */
.popper{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.popper.is-open{ display:block; }
body.popper-open{ overflow:hidden; }

.popper__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* ENERGY (header) */
.pp-timer{ width:100%; max-width:520px; margin:0 auto 10px; }
.pp-timer__row{ display:grid; justify-items:center; gap:6px; }
.pp-timer__text{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.pp-timer__bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.pp-timer__bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* SCORE */
.pp-score{ align-self:center; display:flex; align-items:center; gap:12px; margin-bottom:6px; }
.pp-score__icon{ width:28px; height:28px; display:block; opacity:.9 }
#pp-score-val{
  font-weight:900; font-size: clamp(32px, 8vw, 56px);
  line-height:1; letter-spacing:.2px; text-shadow:0 2px 10px rgba(0,0,0,.25);
}

/* COMBO (скрыто по умолчанию) */
.pp-combo{ display:none !important; position:absolute; top:10px; right:10px; z-index:2;
  align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  font:800 13px/1 Inter,system-ui;
}
.pp-combo.show{ display:flex !important; }
.pp-combo__val{ font-weight:900; }
.pp-combo__mult{ opacity:.85; }

/* Stage */
.pp-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px; background:#07080b; }
.pp-stage__hint{ position:absolute; inset:auto 0 8px; text-align:center; opacity:.45; font:600 12px/1.1 Inter; pointer-events:none }

/* Targets */
.pp-target{
  position:absolute; border-radius:999px; cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.25), rgba(255,255,255,.06));
  border:2px solid rgba(255,255,255,.28);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
  transform:scale(.7); opacity:0; animation: pp-in .12s ease-out forwards;
}
.pp-target--gold{
  background: radial-gradient(circle at 35% 35%, rgba(255,230,100,.6), rgba(255,180,0,.18));
  border-color: rgba(255,210,90,.8);
  box-shadow: 0 10px 30px rgba(255,200,40,.45), inset 0 0 20px rgba(255,220,120,.35);
  animation: pp-in .12s ease-out forwards, gold-pulse 1.2s ease-in-out infinite;
}
@keyframes gold-pulse{ 0%,100%{ filter:none } 50%{ filter: drop-shadow(0 0 16px rgba(255,200,40,.55)); } }

@keyframes pp-in{ to{ transform:scale(1); opacity:1 } }
@keyframes pp-out{ to{ transform:scale(.6); opacity:0 } }

/* FX */
.pp-spark{
  position:absolute; pointer-events:none; font-weight:900; font-size:20px; color:#6be3ff;
  transform:translate(-50%,-50%); animation: pp-spark .7s ease-out forwards; text-shadow:0 0 10px rgba(107,227,255,.55);
}
.pp-spark--gold{ color:#ffdf6a; text-shadow:0 0 14px rgba(255,210,90,.8); }
.pp-spark--miss{ color:#ff7a7a; text-shadow:0 0 10px rgba(255,80,80,.55); }
@keyframes pp-spark{ 0%{opacity:1;transform:translate(-50%,-50%) scale(1)} 60%{opacity:.9;transform:translate(-50%,-110%) scale(1.05)} 100%{opacity:0;transform:translate(-50%,-170%) scale(.9)} }
.pp-ripple{
  position:absolute; width:14px; height:14px; border-radius:999px; border:2px solid rgba(255,255,255,.35);
  transform:translate(-50%,-50%); pointer-events:none; animation: pp-ripple .45s ease-out forwards;
}
@keyframes pp-ripple{ to{ width:120px; height:120px; opacity:0 } }

/* Result panel */
.pp-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.pp-result.show{ display:grid; }
.pp-result__card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.pp-result .score__cell{ display:grid; gap:4px; justify-items:center }
.pp-result .score__val{ font:800 20px/1 Inter }
.pp-result .score__sub{ font:600 12px/1.1 Inter; opacity:.8 }
.pp-result .score__chev{ font:20px/1 Inter; opacity:.6 }

/* CTA bottom */
:root{ --ctaGap: 44px; }
.pp-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.pp-cta.show{ display:block; }
.pp-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .popper__wrap{ max-width:var(--appW,428px); margin:0 auto } }



 </style>


<style>
/* ===== LANE RUNNER (overlay) ===== */
.runner{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.runner.is-open{ display:block; }
body.runner-open{ overflow:hidden; }

.runner__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.rn-hud{ width:100%; max-width:520px; margin:0 auto 10px; }
.rn-hud__row{ display:grid; justify-items:center; gap:6px; }
.rn-time{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.rn-bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.rn-bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }
.rn-score{ align-self:center; display:flex; align-items:center; gap:10px; margin:6px 0 4px; }
.rn-score__val{ font:900 clamp(28px,8vw,48px)/1 Inter; text-shadow:0 2px 10px rgba(0,0,0,.25) }

/* Stage */
.rn-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px; background:#07080b; }
.rn-lane{ position:absolute; inset:0; pointer-events:none; }
.rn-lane:before,.rn-lane:after{
  content:""; position:absolute; top:0; bottom:0; width:1px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
}
.rn-lane:before{ left:33.333%; } .rn-lane:after{ left:66.666%; }

/* ===== Sprites (размеры по переменным) ===== */
:root{
  --player-w: 56px; --player-h: 96px;
  --obs-w: 56px;    --obs-h: 96px;
  --coin-w: 38px;   --coin-h: 38px;
}

.rn-player, .rn-obstacle, .rn-coin{
  position:absolute; transform:translate(-50%,-50%); user-select:none; -webkit-tap-highlight-color:transparent;
  image-rendering:auto; will-change: left, transform, top;
}

/* Игрок — машина */
.rn-player{
  width:var(--player-w); height:var(--player-h);
  background:center / contain no-repeat;
  transition: left 160ms cubic-bezier(.2,.7,.2,1);
}
/* Поворот при смене полосы: короткая анимация, возвращается в 0° */
.rn-player.tilt-left{ animation: rn-tilt-left 220ms ease-out; }
.rn-player.tilt-right{ animation: rn-tilt-right 220ms ease-out; }

@keyframes rn-tilt-left{
  0%{ transform:translate(-50%,-50%) rotate(0deg) }
  35%{ transform:translate(-50%,-50%) rotate(-8deg) }
  100%{ transform:translate(-50%,-50%) rotate(0deg) }
}
@keyframes rn-tilt-right{
  0%{ transform:translate(-50%,-50%) rotate(0deg) }
  35%{ transform:translate(-50%,-50%) rotate(8deg) }
  100%{ transform:translate(-50%,-50%) rotate(0deg) }
}

/* Препятствия — машины */
.rn-obstacle{
  width:var(--obs-w); height:var(--obs-h);
  background:center / contain no-repeat;
}

/* Монетка */
.rn-coin{
  width:var(--coin-w); height:var(--coin-h);
  background:center / contain no-repeat;
}

/* Result */
.rn-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.rn-result.show{ display:grid; }
.rn-card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.rn-cell{ display:grid; gap:4px; justify-items:center }
.rn-val{ font:800 20px/1 Inter } .rn-sub{ font:600 12px/1.1 Inter; opacity:.8 } .rn-chev{ font:20px/1 Inter; opacity:.6 }

/* CTA (safe-area) */
:root{ --ctaGap: 44px; }
.rn-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.rn-cta.show{ display:block; }
.rn-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .runner__wrap{ max-width:var(--appW,428px); margin:0 auto } }


</style>

<style>
/* ===== FLAPPY LITE+ (overlay) ===== */
.flappy{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.flappy.is-open{ display:block; }
body.flappy-open{ overflow:hidden; }

.flappy__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.fl-hud{ width:100%; max-width:520px; margin:0 auto 8px; }
.fl-hud__row{ display:grid; justify-items:center; gap:6px; }
.fl-score{ font:900 clamp(28px,8vw,48px)/1 Inter,system-ui; text-shadow:0 2px 10px rgba(0,0,0,.25) }
.fl-bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* HUD: coins + shield */
.fl-stats{ display:flex; justify-content:center; gap:14px; margin-top:6px; }
.fl-stat{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); font:800 13px/1 Inter;
}
.fl-ico{ width:18px; height:18px; background:center/contain no-repeat; opacity:.95 }
#fl-coin-count{ font:800 14px/1 Inter }
.fl-shield-wrap{ display:flex; align-items:center; gap:8px; }
.fl-shield-bar{ width:88px; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-shield-bar>i{ display:block; height:100%; width:100%; background:#6be3ff; transform-origin:left center; }

/* Stage */
.fl-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px;
  background: linear-gradient(180deg,#0a0c14 0%, #0f1626 100%);
}
.fl-hint{
  position:absolute; left:0; right:0; top:18%;
  text-align:center; font:800 16px/1.2 Inter; opacity:.75; pointer-events:none;
}

/* Sprites sizes (override via JS) */
:root{ --bird-w: 48px; --bird-h: 36px; --pipe-w: 76px; --coin-w: 32px; --coin-h: 32px; --pow-w: 34px; --pow-h: 34px; }

/* Bird */
.fl-bird{
  position:absolute; width:var(--bird-w); height:var(--bird-h); transform:translate(-50%,-50%) rotate(0deg);
  background: radial-gradient(circle at 35% 35%, #ffdd66, #ff9a00);
  border-radius:14px; box-shadow:0 8px 18px rgba(255,154,0,.35), inset 0 0 10px rgba(255,255,255,.25);
  will-change: transform, top, left;
}
.fl-bird--sprite{ background:center/contain no-repeat; border-radius:0; box-shadow:none; }
.fl-bird--shield{ box-shadow:0 0 0 3px rgba(107,227,255,.8), 0 0 30px rgba(107,227,255,.55); }

/* Pipes */
.fl-pipe-part{
  position:absolute; width:var(--pipe-w);
  background: linear-gradient(180deg,#6BFF7A,#1ED760);
  border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 22px rgba(30,215,96,.25), inset 0 0 10px rgba(255,255,255,.15);
}
.fl-pipe--sprite{ background: center / 100% 100% no-repeat; border:none; box-shadow:none; }

/* Items: coin & shield power-up */
.fl-coin,.fl-power{
  position:absolute; transform:translate(-50%,-50%); will-change: left, top;
  width:var(--coin-w); height:var(--coin-h); background:center/contain no-repeat;
}
.fl-power{ width:var(--pow-w); height:var(--pow-h); }

/* Result */
.fl-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.fl-result.show{ display:grid; }
.fl-card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.fl-cell{ display:grid; gap:4px; justify-items:center }
.fl-val{ font:800 20px/1 Inter } .fl-sub{ font:600 12px/1.1 Inter; opacity:.8 } .fl-chev{ font:20px/1 Inter; opacity:.6 }

/* CTA bottom (safe-area) */
:root{ --ctaGap: 44px; }
.fl-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.fl-cta.show{ display:block; }
.fl-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .flappy__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* === ТЮНИНГ ЩИТА И РАДИУСОВ === */
:root{
  --bird-radius: 27px;                 /* скругление птички (в т.ч. со спрайтом) */
  --shield-ring: 1px;                  /* толщина «кольца» щита */
  --shield-ring-color: rgba(107,227,255,.95);
  --shield-glow-color: rgba(107,227,255,.55);
  --shield-glow-blur: 28px;            /* сила внешнего свечения */
  --shield-pulse: 1.6s;                /* скорость пульса ауры */
}

/* птичка всегда со скруглением через переменную */
.fl-bird{ border-radius: var(--bird-radius); }

/* если используешь спрайт — НЕ обнуляем радиус, пусть берёт var(--bird-radius) */
.fl-bird--sprite{ border-radius: var(--bird-radius); }

/* активный щит: кольцо + внешняя подсветка + мягкий пульс */
.fl-bird--shield{
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  position: relative;
}
.fl-bird--shield::after{
  content:"";
  position:absolute; inset: calc(-1*var(--shield-ring));
  border-radius: inherit;
  border: var(--shield-ring) solid var(--shield-ring-color);
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  animation: shieldPulse var(--shield-pulse) ease-in-out infinite;
  pointer-events: none;
}

@keyframes shieldPulse{
  0%  { box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,.35); }
  60% { box-shadow: 0 0 calc(var(--shield-glow-blur)*1.2) var(--shield-glow-color), 0 0 0 10px rgba(107,227,255,0); }
  100%{ box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,0); }
}


</style>

 <style>
  /* ===== MEMORY PAIRS (overlay) ===== */
.pairs{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.pairs.is-open{ display:block; }
body.pairs-open{ overflow:hidden; }

.pairs__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.mp-hud{ width:100%; max-width:520px; margin:0 auto 10px; }
.mp-stats{ display:flex; justify-content:center; gap:12px; }
.mp-pill{
  padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1);
  font:800 13px/1 Inter,system-ui; letter-spacing:.2px; display:flex; gap:6px; align-items:center
}
.mp-val{ font-weight:900; }

/* Stage */
.mp-stage{ flex:1; display:grid; place-items:center; }
.mp-grid{
  width:100%; max-width:520px;
  display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;
}

/* Card */
:root{
  --card-r: 14px;
  --card-back: rgba(255,255,255,.06);
}
.mp-card{
  position:relative; width:100%; aspect-ratio: 3/4;
  border:none; background:none; padding:0; cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  perspective: 800px;
}
.mp-card[disabled]{ pointer-events:none; }

.mp-in{
  position:absolute; inset:0; border-radius:var(--card-r);
  transform-style:preserve-3d; transition: transform .28s cubic-bezier(.2,.7,.2,1);
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
}
.mp-card.is-flipped .mp-in{ transform: rotateY(180deg); }

.mp-face{
  position:absolute; inset:0; display:grid; place-items:center; border-radius:var(--card-r);
  backface-visibility:hidden;
}

/* back */
.mp-face--back{
  background:var(--card-back);
  border:1px solid rgba(255,255,255,.10);
}
/* front (эмодзи по умолчанию) */
.mp-face--front{
  transform: rotateY(180deg);
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.18);
  font: 900 clamp(28px,7vw,42px)/1.1 Inter;
  text-shadow: 0 2px 10px rgba(0,0,0,.25);
}
/* когда фронт — картинка */
.mp-front-img{
  background: center / 80% no-repeat, rgba(255,255,255,.12);
  font-size:0;
}

/* matched / wrong FX */
.mp-card.is-matched .mp-in{
  box-shadow: 0 0 0 2px rgba(107,227,255,.9), 0 0 22px rgba(107,227,255,.45);
}
@keyframes mp-shake{
  0%{ transform: translateX(0) }
  25%{ transform: translateX(-6px) }
  50%{ transform: translateX(6px) }
  75%{ transform: translateX(-3px) }
  100%{ transform: translateX(0) }
}
.mp-card.is-wrong .mp-in{ animation: mp-shake .28s ease-out }

/* Result */
.mp-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.mp-result.show{ display:grid; }
.mp-card-res{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr; gap:14px; align-items:center;
}
.mp-cell{ display:grid; gap:4px; justify-items:center }
.mp-title{ grid-column:1/-1; text-align:center; font:800 16px/1.2 Inter; opacity:.9 }

/* CTA */
:root{ --ctaGap: 44px; }
.mp-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px)+var(--ctaGap)); display:none; }
.mp-cta.show{ display:block; }
.mp-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .pairs__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* ——— общие переменные ——— */
:root{
  --edgePad: 18px;            /* отступы слева/справа для сцены */
  --gridGap: 12px;            /* расстояние между карточками */
  --ctaH: 52px;               /* высота кнопки */
  --ctaGap: 44px;             /* зазор от нижней «палочки» */
}

/* обёртка делает “опорой” для абсолютных элементов */
.pairs__wrap{
  position: relative; /* было absolute/inset:0 — больше не нужно */
  inset: 0;
  display: flex; flex-direction: column;
  padding: calc(env(safe-area-inset-top,0px) + 8px)
           var(--edgePad)
           /* резерв под CTA, чтобы контент не заходил за кнопку */
           calc(env(safe-area-inset-bottom,0px) + var(--ctaH) + var(--ctaGap) + 8px);
}

/* сцена + сетка — безопасные отступы по краям */
.mp-stage{ flex:1; display:grid; place-items:center; }
.mp-grid{
  width:100%; max-width:520px;
  display:grid; grid-template-columns: repeat(3, 1fr);
  gap: var(--gridGap);
}

/* CTA всегда у нижней кромки с учётом safe-area */
.mp-cta{
  position: absolute;                 /* привязано к .pairs__wrap */
  left: var(--edgePad); right: var(--edgePad);
  bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap));
  display:none; z-index: 5;
}
.mp-cta.show{ display:block; }

.mp-cta{ position:fixed; left:14px; right:14px;
         bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); }


 </style>



</head>
<body>
  <div class="wrap">
    <nav id="btm-nav" class="btm-nav" aria-label="Навигация">
      <button class="tab" data-page="home"><img src="ic_home.png" alt=""><span>Главная</span></button>
      <button class="tab" data-page="leaderboard"><img src="ic_services.png" alt=""><span>Турнир</span></button>
      <button class="tab" data-page="consult"><img src="ic_consult.png" alt=""><span>Запись</span></button>
      <button class="tab" data-page="bonuses"><img src="ic_bonus.png" alt=""><span>Бонусы</span></button>
      <button class="tab" data-page="popper"><img src="ic_about.png" alt=""><span>Обо мне</span></button>
    </nav>

    <main>

 

      <!-- MEMORY PAIRS (overlay) -->
<div id="pairs" class="pairs" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="pairs__wrap">
    <!-- HUD -->
    <div class="mp-hud">
      <div class="mp-stats">
        <div class="mp-pill">Time <span id="mp-time" class="mp-val">00:00.0</span></div>
        <div class="mp-pill">Moves <span id="mp-moves" class="mp-val">0</span></div>
      </div>
    </div>

    <!-- STAGE -->
    <div class="mp-stage">
      <div id="mp-grid" class="mp-grid" aria-label="memory grid"></div>

      <!-- RESULT -->
      <div id="mp-result" class="mp-result" aria-hidden="true">
        <div class="mp-card-res">
          <div class="mp-title">Completed!</div>
          <div class="mp-cell">
            <div class="mp-val" id="mp-your-time">00:00.0</div>
            <div class="mp-sub">your time</div>
          </div>
          <div class="mp-cell">
            <div class="mp-val" id="mp-best-time">00:00.0</div>
            <div class="mp-sub">best time</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="mp-cta" class="mp-cta">
      <button class="btn" data-close-pairs>Play again</button>
    </div>
  </div>
</div>




      <!-- FLAPPY LITE (overlay) -->
<!-- FLAPPY LITE+ (overlay) -->
<div id="flappy" class="flappy" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="flappy__wrap">
    <!-- HUD -->
    <div class="fl-hud">
      <div class="fl-hud__row">
        <div id="fl-score" class="fl-score">0</div>
        <div class="fl-bar"><i id="fl-bar"></i></div>
      </div>
      <div class="fl-stats">
        <div class="fl-stat">
          <i id="fl-coin-ico" class="fl-ico"></i>
          <span id="fl-coin-count">0</span>
        </div>
        <div class="fl-stat fl-shield-wrap">
          <i id="fl-shield-ico" class="fl-ico"></i>
          <div class="fl-shield-bar"><i id="fl-shield-bar"></i></div>
        </div>
      </div>
    </div>

    <!-- STAGE -->
    <div id="fl-stage" class="fl-stage">
      <div id="fl-hint" class="fl-hint">tap to fly</div>
      <div id="fl-bird" class="fl-bird" aria-label="bird"></div>

      <!-- RESULT -->
      <div id="fl-result" class="fl-result" aria-hidden="true">
        <div class="fl-card">
          <div class="fl-cell"><div class="fl-val" id="fl-best">0</div><div class="fl-sub">your best</div></div>
          <div class="fl-cell"><div class="fl-val" id="fl-world">200</div><div class="fl-sub">world record</div></div>
          <div class="fl-chev">›</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="fl-cta" class="fl-cta">
      <button class="btn" data-close-flappy>Play again</button>
    </div>
  </div>
</div>







<!-- LANE RUNNER (overlay) -->
<div id="runner" class="runner" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="runner__wrap">
    <!-- HUD -->
    <div class="rn-hud">
      <div class="rn-hud__row">
        <div id="rn-time" class="rn-time">00:45</div>
        <div class="rn-bar"><i id="rn-bar"></i></div>
      </div>
    </div>
    <div class="rn-score">Score <span id="rn-score-val" class="rn-score__val">0</span></div>

    <!-- STAGE -->
    <div id="rn-stage" class="rn-stage">
      <div class="rn-lane"></div>
      <div id="rn-player" class="rn-player" aria-label="player"></div>

      <!-- RESULT -->
      <div id="rn-result" class="rn-result" aria-hidden="true">
        <div class="rn-card">
          <div class="rn-cell">
            <div class="rn-val" id="rn-best">0</div>
            <div class="rn-sub">your best</div>
          </div>
          <div class="rn-cell">
            <div class="rn-val" id="rn-world">5000</div>
            <div class="rn-sub">world record</div>
          </div>
          <div class="rn-chev">›</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="rn-cta" class="rn-cta">
      <button class="btn" data-close-runner>Play again</button>
    </div>
  </div>
</div>





<!-- TARGET POPPER v2 (overlay) -->
<!-- TARGET POPPER v2 (overlay) -->
<div id="popper" class="popper" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="popper__wrap">
    <!-- ENERGY -->
    <div class="pp-timer">
      <div class="pp-timer__row">
        <div id="pp-timer-text" class="pp-timer__text">Energy 100%</div>
        <div class="pp-timer__bar"><i id="pp-timer-bar"></i></div>
      </div>
    </div>

    <!-- SCORE -->
    <div class="pp-score">
      <img class="pp-score__icon" src="ic_about.png" onerror="this.style.display='none'" alt="">
      <span id="pp-score-val">0</span>
    </div>

    <!-- STAGE -->
    <div id="pp-stage" class="pp-stage">
      <!-- combo — по умолчанию пусто -->
      <div class="pp-combo" id="pp-combo">
        <span class="pp-combo__val" id="pp-combo-val"></span>
        <span class="pp-combo__mult" id="pp-combo-note"></span>
      </div>

      

      <!-- RESULT -->
      <div id="pp-result" class="pp-result" aria-hidden="true">
        <div class="pp-result__card">
          <div class="score__cell">
            <div class="score__val" id="pp-best">0</div>
            <div class="score__sub">your best</div>
          </div>
          <div class="score__cell">
            <div class="score__val" id="pp-world">120</div>
            <div class="score__sub">world record</div>
          </div>
          <div class="score__chev">›</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="pp-cta" class="pp-cta">
      <button class="btn" data-close-popper>Close</button>
    </div>
  </div>
</div>










<!-- FULLSCREEN CLICKER кликер-->
<div id="clicker" class="clicker" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="clicker__wrap">
    <!-- TIMER -->
    <div class="timer">
      <div class="timer__row">
        <div id="timer-text" class="timer__text">01:00</div>
        <div class="timer__bar"><i id="timer-bar"></i></div>
      </div>
    </div>

    <!-- COUNTER (иконка + число БЕЗ рамок/плашек; размер управляет CSS) -->
    <div id="clicker-counter" class="clicker__counter">
      <img class="counter__mini" src="sales_genius_aibot.png" alt="">
      <span id="counter-val">0</span>
    </div>

    <!-- СЦЕНА: кликаем только по IMG -->
    <div id="clicker-stage" class="clicker__stage">
      <img class="clicker__img" src="sales_genius_aibot.png" alt="Click target">

      <!-- ПАНЕЛЬ СЧЁТА (появляется по центру вместо IMG после таймера) -->
      <div id="clicker-score" class="clicker__score" aria-hidden="true">
        <div class="score__cell">
          <div class="score__val" id="score-best">0</div>
          <div class="score__sub">your best</div>
        </div>
        <div class="score__cell">
          <div class="score__val" id="score-world">93</div>
          <div class="score__sub">world record</div>
        </div>
        <div class="score__chev">›</div>
      </div>
    </div>

    <!-- CTA снизу (учитывает safe-area и твой зазор через CSS) -->
    <div id="clicker-cta" class="clicker__cta">
      <button class="btn" data-close-clicker>Try Again Tomorrow</button>
    </div>
  </div>
</div>








      <div id="sheet" class="sheet sheet-bottom" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sheet__overlay" data-close-sheet></div>
        <section class="sheet__panel" tabindex="-1">
          <div class="sheet__handle"></div>
          <header class="sheet__header">
            <h3 class="sheet__title">Заголовок</h3>
            <button class="sheet__close" aria-label="Закрыть" data-close-sheet>✕</button>
          </header>
          <div class="sheet__body" id="sheet-body"></div>
        </section>
      </div>

      <template id="tpl-example">
        <div class="card">
          <div class="h1">Демо‑страница</div>
          <p class="muted-sm">Любой HTML внутрь: формы, карточки, таблицы…</p>
        </div>
      </template>

<section class="page" id="home">
  <!-- HERO (gif/mp4) -->
  <div class="hero">
    <!-- GIF: -->
    <img class="hero__media" src="demo.gif" alt="Hero">
    <!-- Если тяжёлый GIF, замени на mp4 (тот же класс):
    <video class="hero__media" autoplay muted loop playsinline preload="metadata">
      <source src="assets/hero.mp4" type="video/mp4">
    </video>
    -->
  </div>

  <!-- Промо-плашка -->
  <div class="promo">
    <div class="promo__icon">
      <img src="ic_about.png" alt="">
    </div>
    <div>
      <div class="promo__title">Halloween Clicker</div>
      <div class="promo__sub">Play now</div>
    </div>
<button class="promo__btn" data-open-clicker>Clicker</button>
  </div>

  <!-- Start here -->
  <div class="card list-card tight">
    <div class="list-head">Start here</div>
    <div class="list">
      <div class="list__item">
        <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">What is Notcoin?</div>
          <div class="list__sub">Intro</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="What is Notcoin?"
                data-tpl="#tpl-example"
                aria-label="Открыть">
          ›
        </button>
      </div>

<div class="list__item">
  <div class="list__icon"><img src="ic_services.png" alt=""></div>
  <div class="list__text">
    <div class="list__title">Get $NOT</div>
    <div class="list__sub">Swap cash or crypto to $NOT</div>
  </div>

  <!-- Открывает только интро-слайдер -->
  <button class="list__chev-btn"
          data-open-intro
          aria-controls="intro"
          aria-label="Открыть онбординг">
    ›
  </button>
</div>

      <div class="list__item">
        <div class="list__icon"><img src="ic_about.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">Whitepaper</div>
          <div class="list__sub">Literally</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="Whitepaper"
                data-tpl="#tpl-example"
                aria-label="Открыть">
          ›
        </button>
      </div>
    </div>
  </div>

  

  <!-- Games -->
<div class="card list-card games tight">
  <div class="list-head">Games</div>
  <div class="list">
    <!-- Бонусы -->
    <div class="list__item">
      <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Daily bonus</div>
        <div class="list__sub">Забери подарок сегодня</div>
      </div>
<!-- Пример кнопки запуска на главной -->
<button class="list__btn list__btn--primary"
        data-open-popper
        data-cooldown-hours="24"
        data-game-key="popper">
  Play
</button>
    </div>

    <!-- Кликер -->
    <div class="list__item">
      <div class="list__icon"><img src="sales_genius_aibot.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Clicker</div>
        <div class="list__sub">1-minute challenge</div>
      </div>
      <!-- запустить кликер-оверлей (+ дневной лимит из прошлой версии: 24ч) -->
<!-- Кнопка запуска на главной -->
<button class="list__btn list__btn--primary" data-open-runner>Lane</button>
    </div>

       

    <!-- Кликер -->
    <div class="list__item">
      <div class="list__icon"><img src="sales_genius_aibot.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Clicker</div>
        <div class="list__sub">1-minute challenge</div>
      </div>
<!-- Кнопка запуска на главной -->
<button class="list__btn list__btn--primary" data-open-pairs>Pairs</button>
    </div>


    <!-- Бонусы -->
    <div class="list__item">
      <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Daily bonus</div>
        <div class="list__sub">Забери подарок сегодня</div>
      </div>
<!-- Кнопка запуска на главной -->
<button class="list__btn list__btn--primary" data-open-flappy>Flappy</button>
    </div>
      </div>
</div>

</section>




<!-- ЛИДЕР БОРД -->


<section id="leaderboard" class="page" style="display:none">
    <div class="promo">
    <div class="promo__icon">
      <img src="ic_about.png" alt="">
    </div>
    <div>
      <div class="promo__title">Halloween Clicker</div>
      <div class="promo__sub">Play now</div>
    </div>
<button class="promo__btn" data-open-clicker>Clicker</button>
  </div>


  <div class="card lb-card inner">
    <div class="lb-head">
      <div>
        <div class="lb-title">Leaderboard</div>
        <div class="lb-sub">Clicker · daily & all-time</div>
      </div>
      <div class="lb-seg" role="tablist" aria-label="Leaderboard period">
        <button type="button" class="js-lb-mode" data-mode="daily" aria-pressed="true">Daily</button>
        <button type="button" class="js-lb-mode" data-mode="all">All-time</button>
      </div>
    </div>

    <!-- Ты -->
    <div class="lb-you" id="lb-you">
      <div class="lb-you__avatar" id="lb-you-ava">YOU</div>
      <div class="lb-you__meta">
        <div class="lb-you__name" id="lb-you-name">You</div>
        <div class="lb-sub" id="lb-you-note">best score</div>
      </div>
      <div class="lb-you__score" id="lb-you-score">0</div>
    </div>

    <!-- Топ -->
    <div class="lb-list" id="lb-list">
      <!-- сюда JS рендерит строки -->
    </div>

    <div class="lb-actions">
      <button class="lb-btn" id="lb-refresh" type="button">Refresh</button>
      <button class="lb-btn lb-btn--primary" type="button"
              data-open-clicker data-cooldown-hours="24" data-clicker-key="pumpkin">Play</button>
    </div>
  </div>
</section>


      <section class="page" id="services">
        <div class="card page-title">
          <div class="h1">Услуги</div>
          <p class="muted-sm">Тарифы, переключатель месяц/год и т.д.</p>
          <button class="btn" data-open-sheet data-title="Прайс" data-tpl="#tpl-example" data-from="bottom">Показать прайс</button>
        </div>


      </section>

      <section class="page" id="consult">
        <div class="card page-title">
          <div class="h1">Запись на консультацию</div>
          <button class="btn btn-primary" data-open-sheet data-title="Подтверждение" data-tpl="#tpl-example" data-from="bottom">Открыть снизу</button>
        </div>
      </section>

      <section class="page" id="bonuses">
        <div class="card page-title">
          <div class="h1">Бонусы</div>
        </div>
      </section>

      <section class="page" id="about">
        <div class="card page-title">
          <div class="h1">Обо мне</div>
        </div>
      </section>

      <!-- FULLSCREEN INTRO -->
<!-- FULLSCREEN INTRO -->
<div id="intro" class="intro" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="intro__wrap">
    <div class="intro__progress" id="intro-progress"></div>

    <div class="intro__stage">
      <div class="intro__slides" id="intro-slides">
        <!-- 1 -->
        <section class="intro__slide active">
          <h2 class="intro__h1">Welcome fren</h2>
          <p class="intro__p">Короткий тизер, чем полезен мини-апп.</p>
        </section>
        <!-- 2 -->
        <section class="intro__slide">
          <h2 class="intro__h1">Вопрос</h2>
          <p class="intro__p">Продолжить сейчас?</p>
        </section>

        <!-- 3 -->
        <section class="intro__slide">
          <h2 class="intro__h1">Погнали!</h2>
          <p class="intro__p">Последний штрих — и начнём.</p>
        </section>
      </div>
    </div>

    <!-- сюда JS будет рендерить нужный набор кнопок -->
    <div id="intro-actions" class="intro__actions"></div>
  </div>
</div>


    </main>
  </div>

  <script>
  (function app(){
    const TG = window.Telegram && window.Telegram.WebApp;

    if (TG){
      try{
        TG.ready();
        TG.expand();
        TG.disableVerticalSwipes?.();
        TG.enableClosingConfirmation?.();
        TG.onEvent?.('viewportChanged', () => TG.disableVerticalSwipes?.());
      }catch(e){ console.warn('TG init error', e); }
    }

    const ROOT = 'home';
    const sheetRoot = document.getElementById('sheet');
    const sheetPanel= sheetRoot?.querySelector('.sheet__panel');
    const sheetBody = document.getElementById('sheet-body');
    const sheetTitle= sheetRoot?.querySelector('.sheet__title');

    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const isInDOM = id => !!document.getElementById(id);

    function currentId(){
      const url = new URL(location.href);
      const qp = (url.searchParams.get('page') || '').trim();
      if (qp && isInDOM(qp)) return qp;
      const h = (location.hash || '#'+ROOT).replace(/^#/, '');
      return isInDOM(h) ? h : ROOT;
    }

    function setActivePage(id){
      qsa('main > section, section.page').forEach(s => {
        const on = (s.id === id);
        s.classList.toggle('active', on);
        s.style.display = on ? 'block' : 'none';
      });
      qsa('[data-page]').forEach(t => t.classList.toggle('active', t.dataset.page === id));
      requestAnimationFrame(()=> window.scrollTo({ top: 0, behavior:'auto' }));
      syncBack();
    }

    function navigateTo(id){
      if (!id || !isInDOM(id)) return;
      const h = '#'+id;
      if (h !== (location.hash || '#'+ROOT)){ history.pushState({id}, '', h); }
      setActivePage(id);
    }

    function showBack(){ try{ TG?.BackButton?.show && TG.BackButton.show(); }catch(_){ } }
    function hideBack(){ try{ TG?.BackButton?.hide && TG.BackButton.hide(); }catch(_){ } }
    function syncBack(){
      if (!TG) return;
      const atRoot = (currentId() === ROOT);
      const sheetOpen = sheetRoot?.classList.contains('is-open');
      if (sheetOpen || !atRoot) showBack(); else hideBack();
    }

    TG?.BackButton?.onClick?.(()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });
    TG?.onEvent?.('backButtonClicked', ()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });

    window.addEventListener('popstate', ()=> setActivePage(currentId()));

    function haptic(level='light'){
      try{ TG?.HapticFeedback?.impactOccurred && TG.HapticFeedback.impactOccurred(level); }
      catch(_){ try{ navigator.vibrate && navigator.vibrate(level==='light'?10:16); }catch(_){} }
    }
    function openSheet({title='', html='', from='bottom'} = {}){
      if (!sheetRoot) return;
      sheetRoot.classList.toggle('sheet-bottom', from==='bottom');
      if (sheetTitle) sheetTitle.textContent = title || '';
      if (sheetBody && html != null) sheetBody.innerHTML = html;
      sheetRoot.classList.add('is-open'); document.body.classList.add('sheet-open');
      requestAnimationFrame(()=> sheetPanel?.focus({preventScroll:true}));
      haptic('light'); syncBack();
    }
    function closeSheet(){
      if (!sheetRoot) return;
      sheetRoot.classList.remove('is-open'); document.body.classList.remove('sheet-open');
      haptic('light'); syncBack();
    }
    window.openSheet = openSheet;
    window.closeSheet = closeSheet;

    sheetRoot?.addEventListener('click', (e)=>{ if (e.target.closest('[data-close-sheet]')) closeSheet(); });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && sheetRoot?.classList.contains('is-open')) closeSheet(); });

    let y0=0,y=0,drag=false;
    sheetPanel?.addEventListener('touchstart', e=>{ drag=true; y0=y=e.touches[0].clientY; sheetPanel.style.transition='none'; }, {passive:true});
    sheetPanel?.addEventListener('touchmove',  e=>{
      if(!drag) return; y=e.touches[0].clientY; const dy=Math.max(0,y-y0);
      if (TG && typeof TG.disableVerticalSwipes === 'function'){ e.preventDefault?.(); return; }
      sheetPanel.style.transform=`translateY(${dy}px)`;
    }, {passive:false});
    sheetPanel?.addEventListener('touchend',   ()=>{ if(!drag) return; drag=false; sheetPanel.style.transition=''; sheetPanel.style.transform=''; if (y-y0>100) closeSheet(); });

    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    if (isiOS && !(TG && typeof TG.disableVerticalSwipes === 'function')){
      let startY = 0;
      document.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, {passive:true});
      document.addEventListener('touchmove', e => {
        const dy = e.touches[0].clientY - startY;
        const atTop = (window.scrollY <= 0);
        if (dy > 0 && atTop){ e.preventDefault(); }
      }, {passive:false});
    }

    document.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('[data-open-sheet]');
      if (openBtn){
        e.preventDefault();
        const tplSel = openBtn.dataset.tpl || '';
        const tpl    = tplSel ? document.querySelector(tplSel) : null;
        const html   = tpl ? tpl.innerHTML : '';
        const ttl    = openBtn.getAttribute('title') || openBtn.dataset.title || openBtn.textContent.trim() || '';
        const from   = openBtn.dataset.from || 'bottom';
        openSheet({ title: ttl, html, from });
        return;
      }
      const tab = e.target.closest('[data-page]');
      if (tab){
        e.preventDefault();
        navigateTo(tab.dataset.page);
      }
    });

    const start = currentId();
    history.replaceState({id:start}, '', '#'+start);
    setActivePage(start);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 0);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 300);
  })();
  </script>

<script>
(function introSlider(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // ====== КОНФИГ КНОПОК ПО СЛАЙДАМ ======
  // Индексы соответствуют порядку секций .intro__slide в #intro-slides
  const INTRO_CFG = {
    actions: {
      0: [ // Слайд 0 — одна кнопка
        { label:'Продолжить', type:'primary', do:'next' }
      ],
      1: [ // Слайд 1 — две рядом
        { label:'Нет', type:'ghost', do:'answer', value:'no' },
        { label:'Да',  type:'primary', do:'navigate', to:'consult' } // перейти в раздел "Запись"
      ],
      2: [ // Слайд 2 — одна кнопка
        { label:'Продолжить', type:'primary', do:'done' }
      ],
      // Примеры для будущих слайдов:
      // 3: [
      //   { label:'Открыть сайт', type:'primary', do:'link', href:'https://example.com' }
      // ],
      // 4: [
      //   { label:'Показать окно', type:'primary', do:'sheet', title:'Демо', tpl:'#tpl-example', from:'bottom' }
      // ]
    },
    onAnswer: (index, value) => {
      // Твой хук на ответы "Да/Нет" и т.п.
      // Например: localStorage.setItem('intro_answer_'+index, value);
      // console.log('Answer on slide', index, '=>', value);
    }
  };

  // ====== DOM ======
  const root = document.getElementById('intro');
  if(!root) return;

  const slidesWrap = root.querySelector('#intro-slides');
  const slides = Array.from(root.querySelectorAll('.intro__slide'));
  const progress = root.querySelector('#intro-progress');
  const actions = root.querySelector('#intro-actions');

  // Прогресс
  progress.innerHTML = slides.map(()=>'<i class="intro__seg"></i>').join('');
  const segs = Array.from(progress.children);

  let idx = 0, touchX0=0, touchX=0, dragging=false, backHandler=null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };

  // Сервис: создать кнопку
  function btnHTML(cfg){
    const cls = ['intro__btn'];
    if (cfg.type === 'primary') cls.push('intro__btn--primary');
    if (cfg.type === 'ghost')   cls.push('intro__btn--ghost');
    const attrs = [];
    if (cfg.do) attrs.push(`data-act="${cfg.do}"`);
    if (cfg.value != null) attrs.push(`data-val="${String(cfg.value)}"`);
    if (cfg.to)    attrs.push(`data-to="${String(cfg.to)}"`);
    if (cfg.href)  attrs.push(`data-href="${String(cfg.href)}"`);
    if (cfg.title) attrs.push(`data-title="${String(cfg.title)}"`);
    if (cfg.tpl)   attrs.push(`data-tpl="${String(cfg.tpl)}"`);
    if (cfg.from)  attrs.push(`data-from="${String(cfg.from)}"`);
    return `<button class="${cls.join(' ')}" ${attrs.join(' ')}>${cfg.label}</button>`;
  }

  // Рендер низа (кнопок)
  function renderActions(){
    const set = INTRO_CFG.actions[idx] || defaultActions();
    // сетка: 1 / 2 / 3+
    actions.className = 'intro__actions';
    if (set.length === 1) actions.classList.add('intro__actions--one');
    else if (set.length === 2) actions.classList.add('intro__actions--two');
    else actions.classList.add('intro__actions--multi'); // см. CSS ниже
    actions.innerHTML = set.map(btnHTML).join('');
  }

  // Дефолт, если не задал для слайда: "Продолжить" или "Готово" на последнем
  function defaultActions(){
    const last = (idx === slides.length - 1);
    return [ { label: last ? 'Готово' : 'Продолжить', type:'primary', do: last ? 'done' : 'next' } ];
    // можно заменить на то, что тебе нужно по умолчанию
  }

  function apply(){
    slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
    segs.forEach((d,i)=> d.classList.toggle('active', i<=idx));
    renderActions();
  }

  // Открыть / закрыть
  function openIntro(startIndex){
    if (Number.isInteger(startIndex)) idx = Math.max(0, Math.min(startIndex, slides.length-1));
    root.classList.add('is-open');
    document.body.classList.add('intro-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeIntro();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
    }catch(_){}

    apply();
    window.syncBack?.();
  }
  function closeIntro(){
    root.classList.remove('is-open');
    document.body.classList.remove('intro-open');

    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  function next(){ if(idx<slides.length-1){ idx++; apply(); haptic(); } }
  function prev(){ if(idx>0){ idx--; apply(); haptic(); } }

  // Жесты перелистывания
  slidesWrap.addEventListener('touchstart', e=>{ dragging=true; touchX0=touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchmove',  e=>{ if(!dragging) return; touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchend',   ()=>{ if(!dragging) return; dragging=false;
    const dx = touchX - touchX0; if (Math.abs(dx)>50){ dx<0 ? next() : prev(); }
  });

  // Клики по кнопкам низа
  actions.addEventListener('click', (e)=>{
    const b = e.target.closest('[data-act]'); if(!b) return;
    const act  = b.getAttribute('data-act');
    const val  = b.getAttribute('data-val');
    const to   = b.getAttribute('data-to');
    const href = b.getAttribute('data-href');
    const title= b.getAttribute('data-title');
    const tpl  = b.getAttribute('data-tpl');
    const from = b.getAttribute('data-from') || 'bottom';

    switch(act){
      case 'next': next(); break;
      case 'prev': prev(); break;
      case 'done': haptic('medium'); closeIntro(); break;
      case 'answer':
        try{ INTRO_CFG.onAnswer && INTRO_CFG.onAnswer(idx, val); }catch(_){}
        next(); break;
      case 'navigate':
        closeIntro();
        if (typeof window.navigateTo === 'function') window.navigateTo(to);
        else if (to) location.hash = '#'+to;
        break;
      case 'link':
        try{ TG?.openLink ? TG.openLink(href) : window.open(href, '_blank'); }catch(_){}
        break;
      case 'sheet':
        closeIntro();
        if (typeof window.openSheet === 'function'){
          const tplNode = tpl ? document.querySelector(tpl) : null;
          const html = tplNode ? tplNode.innerHTML : '<div class="card"><b>Нет шаблона</b></div>';
          window.openSheet({ title, html, from });
        }
        break;
    }
  });

  // Открывать по кнопке: data-open-intro или data-open-intro="2" (старт слайд 2)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-intro]');
    if (!t) return;
    e.preventDefault();
    const start = parseInt(t.getAttribute('data-open-intro'), 10);
    openIntro(Number.isFinite(start) ? start : undefined);
  });

  // Экспорт (если захочешь открыть из кода)
  window.openIntro  = openIntro;
  window.closeIntro = closeIntro;
})();
</script>


<script>
/* ===== FULLSCREEN CLICKER (обновлённый) ===== */
(function(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root        = document.getElementById('clicker');
  if (!root) return;

  const stage       = document.getElementById('clicker-stage');
  const img         = root.querySelector('.clicker__img');

  const counterVal  = document.getElementById('counter-val');
  const timerText   = document.getElementById('timer-text');
  const timerBar    = document.getElementById('timer-bar');

  const scoreBox    = document.getElementById('clicker-score');
  const bestEl      = document.getElementById('score-best');
  const worldEl     = document.getElementById('score-world');
  const cta         = document.getElementById('clicker-cta');

  // Настройки
  const WORLD_RECORD = 93;       // можешь менять / подтягивать с бэка
  const TIMER_MS     = 60_000;   // 1 минута

  // Состояние
  let diamonds   = 0;
  let best       = Number(localStorage.getItem('clicker_best') || 0);
  let pressing   = false;
  let running    = false;
  let t0         = 0;
  let rafId      = 0;
  let backHandler= null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };
  const mmss   = (ms)=>{
    const s = Math.max(0, Math.ceil(ms/1000));
    const m = Math.floor(s/60);
    const ss = String(s%60).padStart(2,'0');
    return `${m}:${ss}`;
  };
  const updateCounter = ()=> { counterVal.textContent = diamonds; };

  function spawnAt(x, y){
    // ромбик
    const s = document.createElement('div');
    s.className = 'spark'; s.textContent = '◆';
    s.style.left = x+'px'; s.style.top = y+'px';
    stage.appendChild(s); s.addEventListener('animationend', ()=> s.remove());
    // рипл
    const r = document.createElement('i');
    r.className = 'ripple'; r.style.left = x+'px'; r.style.top = y+'px';
    stage.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
  }

  function registerHit(ev){
    if(!running) return;
    const rect = stage.getBoundingClientRect();
    const clientX = (ev.clientX ?? ev.touches?.[0]?.clientX);
    const clientY = (ev.clientY ?? ev.touches?.[0]?.clientY);
    if (clientX==null) return;
    spawnAt(clientX - rect.left, clientY - rect.top);
    diamonds += 1; updateCounter(); haptic('medium');
  }

  function pressOn(){ if(running && !pressing){ pressing=true; img.classList.add('is-press'); } }
  function pressOff(e){ if(!pressing) return; pressing=false; img.classList.remove('is-press'); if (e) registerHit(e); }

  // Кликаем ТОЛЬКО по IMG (Pointer Events, fallbacks)
  if (window.PointerEvent){
    img.addEventListener('pointerdown', pressOn);
    img.addEventListener('pointerup',   pressOff);
    img.addEventListener('pointercancel', ()=> pressOff());
    img.addEventListener('pointerleave',  ()=> pressOff());
  } else {
    img.addEventListener('touchstart', ()=> pressOn(), {passive:true});
    img.addEventListener('touchend',   (e)=> pressOff(e), {passive:true});
    img.addEventListener('mousedown',  ()=> pressOn());
    img.addEventListener('mouseup',    (e)=> pressOff(e));
    img.addEventListener('mouseleave', ()=> pressOff());
  }

  // ===== Таймер
  function tick(){
    const elapsed = Date.now() - t0;
    const left    = Math.max(0, TIMER_MS - elapsed);
    timerText.textContent = mmss(left);
    timerBar.style.transform = `scaleX(${Math.max(0, 1 - elapsed / TIMER_MS)})`;
    if (left <= 0){ finish(); return; }
    rafId = requestAnimationFrame(tick);
  }
  function startTimer(){
    cancelAnimationFrame(rafId);
    t0 = Date.now();
    timerBar.style.transform = 'scaleX(1)';
    timerText.textContent = mmss(TIMER_MS);
    rafId = requestAnimationFrame(tick);
  }

  // ===== Открыть / Закрыть
  function openClicker(){
    // reset счёт/интерфейс
    diamonds = 0; updateCounter();
    img.style.display = '';                // показать IMG
    scoreBox.classList.remove('show');     // скрыть панель со счётом
    cta.classList.remove('show');          // скрыть CTA

    root.classList.add('is-open');
    document.body.classList.add('clicker-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeClicker();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
      TG?.expand?.();
    }catch(_){}

    running = true;
    startTimer();
    window.syncBack?.();
  }
  function closeClicker(){
    running = false;
    cancelAnimationFrame(rafId);
    root.classList.remove('is-open');
    document.body.classList.remove('clicker-open');
    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  // ===== Финиш раунда
  function finish(){
    running = false;
    cancelAnimationFrame(rafId);

    // обновить best
    if (diamonds > best){
      best = diamonds;
      try{ localStorage.setItem('clicker_best', String(best)); }catch(_){}
    }
    bestEl.textContent  = best;
    worldEl.textContent = WORLD_RECORD;

    // заменить IMG на панель со счётом + показать CTA
    img.style.display = 'none';
    scoreBox.classList.add('show');
    cta.classList.add('show');

    haptic('medium');
  }

  // CTA: закрыть
  cta.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-clicker]')) closeClicker();
  });

  // Esc (desktop)
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeClicker(); });

  // Делегированное открытие: любая кнопка с data-open-clicker
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-clicker]');
    if (!t) return;
    e.preventDefault();
    openClicker();
  });

  // Экспорт (если захочешь звать программно)
  window.openClicker = openClicker;
  window.closeClicker = closeClicker;
})();
</script>

<script>
/* ===== TARGET POPPER v2 — smooth energy regen + time drain + gold + combos ===== */
(function targetPopperV2(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root = document.getElementById('popper'); if (!root) return;
  const stage = document.getElementById('pp-stage');
  const timerText = document.getElementById('pp-timer-text');
  const timerBar  = document.getElementById('pp-timer-bar');
  const scoreVal  = document.getElementById('pp-score-val');
  const result    = document.getElementById('pp-result');
  const bestEl    = document.getElementById('pp-best');
  const worldEl   = document.getElementById('pp-world');
  const cta       = document.getElementById('pp-cta');
  const comboEl   = document.getElementById('pp-combo');
  const comboValEl= document.getElementById('pp-combo-val');
  const comboNoteEl = document.getElementById('pp-combo-note');

  // CONFIG
  const GAME_NAME        = 'popper';
  const WORLD_RECORD     = 120;

  // targets жизнь цели
  const SPAWN_EVERY_MS   = 520;
  const LIFE_MIN_MS      = 1100;
  const LIFE_MAX_MS      = 1700;
  const SIZE_MIN         = 44;
  const SIZE_MAX         = 68;
  const GOLD_PROB        = 0.08;
  const GOLD_SCORE       = 5;
  const NORMAL_SCORE     = 1;

  // combo
  const COMBO_STEP       = 3;     // +1 множитель каждые 3 попадания
  const COMBO_MAX_MULT   = 5;     // максимум x5

  // energy (дефолты можно крутить)
  const ENERGY_MAX_DEFAULT = 100;
  const ENERGY_COST_HIT    = 0.1;
  const ENERGY_COST_MISS   = 0.3;
  const ENERGY_COST_EXPIRE = 0.2;
  const START_MIN_ENERGY   = 0.1;   // минимум, чтобы стартовать
  let   ENERGY_REGEN_MS    = 24 * 3600_000; // глобальный дефолт (полный бак за 24ч)

  // плавный ПОМИНУТНЫЙ расход во время игры (Variant 2)
  const DRAIN_PER_MIN     = 0.10;   // ед/мин; поставь меньше/больше
  let   lastDrainTs       = 0;

  // STATE
  let score = 0, best = 0;
  let running = false, spawnId = 0;
  let backHandler = null;
  let combo = 0;
  let sessionKey = 'default';
  let energyMax  = ENERGY_MAX_DEFAULT;
  let energyRafId = 0;
  let lockMode = false;

  // Utils
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const rnd  = (a,b)=> a + Math.random()*(b-a);
  const irnd = (a,b)=> Math.floor(rnd(a,b));
  const clamp= (v,a,b)=> Math.max(a, Math.min(b, v));

  // Storage helpers (per sessionKey)
  const k = (s)=> `${GAME_NAME}_${s}_${sessionKey}`;
  const getNum = (key, def=0)=> Number(localStorage.getItem(key) ?? def);
  const setNum = (key, v)=> { try{ localStorage.setItem(key, String(v)); }catch(_){} };

  // Energy model (value@ts + linear regen)
  function energyKeys(){ return { val: k('energy_val'), ts: k('energy_ts') }; }
  function energySnapshot(){
    const {val, ts} = energyKeys();
    let v = Number(localStorage.getItem(val));
    let t = Number(localStorage.getItem(ts));
    if (!Number.isFinite(v)) v = energyMax;
    if (!Number.isFinite(t)) t = Date.now();
    return { v, t };
  }
  function energyAt(now = Date.now()){
    const { v, t } = energySnapshot();
    const regenRate = energyMax / ENERGY_REGEN_MS; // ед/мс
    return clamp(v + regenRate * (now - t), 0, energyMax);
  }
  function energyWrite(newVal, now = Date.now()){
    const { val, ts } = energyKeys();
    setNum(val, clamp(newVal, 0, energyMax));
    setNum(ts, now);
  }
  function energyUse(cost){
    const now = Date.now();
    const cur = energyAt(now);
    const next = cur - cost;
    energyWrite(next, now);
    if (next <= 0){ energyWrite(0, now); finish(true); return false; }
    return true;
  }
  function energyPctFloat(v = energyAt()){ return (v / energyMax) * 100; }

  // Smooth UI (rAF) + time drain
  function energyUIFrame(){
    // плавный поминутный расход, пока игра идёт
    if (running && DRAIN_PER_MIN > 0){
      const nowPerf = performance.now();
      if (!lastDrainTs) lastDrainTs = nowPerf;
      const dtMin = (nowPerf - lastDrainTs) / 60000;
      if (dtMin > 0){
        const drain = dtMin * DRAIN_PER_MIN;
        const now   = Date.now();
        const cur   = energyAt(now);
        energyWrite(cur - drain, now);
        lastDrainTs = nowPerf;
      }
    }

    const pct = energyPctFloat();
    const pctText = Math.round(pct*10)/10;
    timerText.textContent = `Energy ${pctText}%`;
    timerBar.style.transform = `scaleX(${clamp(pct/100, 0, 1)})`;

    if (lockMode){
      const btn = cta.querySelector('.btn');
      if (btn) btn.textContent = (energyAt() >= START_MIN_ENERGY) ? 'Play' : 'Out of energy — Close';
    }
    energyRafId = requestAnimationFrame(energyUIFrame);
  }
  function startEnergyRaf(){ cancelAnimationFrame(energyRafId); energyRafId = requestAnimationFrame(energyUIFrame); }
  function stopEnergyRaf(){ cancelAnimationFrame(energyRafId); energyRafId = 0; }

  // Score / Combo (x1 скрыт)
  function updateScore(v){ score = v; scoreVal.textContent = v; }
  function setCombo(hitOk){
    if (hitOk){ combo += 1; } else { combo = 0; }
    const mult = 1 + Math.min(Math.floor(combo / COMBO_STEP), COMBO_MAX_MULT-1);
    if (mult > 1){
      comboValEl.textContent = `x${mult}`;
      comboNoteEl.textContent = 'combo';
      comboEl.classList.add('show');
    } else {
      comboEl.classList.remove('show');
      comboValEl.textContent = '';
      comboNoteEl.textContent = '';
    }
    return mult;
  }

  // FX
  function spark(x,y, text, cls){
    const s = document.createElement('div');
    s.className = 'pp-spark' + (cls?` ${cls}`:'');
    s.textContent = text;
    s.style.left = x+'px'; s.style.top = y+'px';
    stage.appendChild(s); s.addEventListener('animationend', ()=> s.remove());
  }
  function ripple(x,y){
    const r = document.createElement('i');
    r.className='pp-ripple'; r.style.left=x+'px'; r.style.top=y+'px';
    stage.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
  }

  // Spawn targets
  function spawn(){
    if(!running) return;
    const rect = stage.getBoundingClientRect();
    const pad = 16;
    const size = irnd(SIZE_MIN,SIZE_MAX);
    const x = irnd(pad, Math.max(pad, rect.width - size - pad));
    const y = irnd(pad, Math.max(pad, rect.height - size - pad));
    const life = irnd(LIFE_MIN_MS, LIFE_MAX_MS);
    const isGold = Math.random() < GOLD_PROB;

    const el = document.createElement('div');
    el.className = 'pp-target' + (isGold ? ' pp-target--gold' : '');
    el.style.width = el.style.height = size+'px';
    el.style.left = x+'px'; el.style.top = y+'px';
    el.dataset.base = String(isGold ? GOLD_SCORE : NORMAL_SCORE);
    let dead=false;

    function kill(){ if (dead) return; dead = true; el.style.animation = 'pp-out .12s ease-out forwards'; setTimeout(()=> el.remove(), 120); }

    el.addEventListener('pointerdown', (e)=>{
      if(!running) return;
      e.preventDefault(); e.stopPropagation();

      if (!energyUse(ENERGY_COST_HIT)) return;

      const base = Number(el.dataset.base||1);
      const mult = setCombo(true);
      const add  = base * mult;

      const cx = x + size/2, cy = y + size/2;
      updateScore(score + add);
      haptic('medium');
      spark(cx, cy, `+${add}` + (mult>1?` ×${mult}`:''), isGold? 'pp-spark--gold':'' );
      ripple(cx, cy);

      kill();

      if (isGold){
        const now = Date.now();
        const cur = energyAt(now);
        energyWrite(Math.min(energyMax, cur + 2), now); // +2 энергии
      }
    }, {passive:false});

    stage.appendChild(el);

    // истечение жизни цели = штраф
    setTimeout(()=>{
      if (!dead && running){
        const cx = x + size/2, cy = y + size/2;
        combo = 0; setCombo(false);
        if (energyUse(ENERGY_COST_EXPIRE)){
          updateScore(Math.max(0, score - 1));
          spark(cx, cy, '–1', 'pp-spark--miss'); ripple(cx, cy);
          haptic('light');
        }
        kill();
      }
    }, life);
  }

  // Miss по пустому месту
  stage.addEventListener('pointerdown', (e)=>{
    if(!running) return;
    if (e.target.closest('.pp-target')) return;
    e.preventDefault();
    const rect = stage.getBoundingClientRect();
    const cx = (e.clientX ?? 0) - rect.left, cy = (e.clientY ?? 0) - rect.top;

    combo = 0; setCombo(false);
    if (energyUse(ENERGY_COST_MISS)){
      updateScore(Math.max(0, score - 1));
      spark(cx, cy, '–1', 'pp-spark--miss'); ripple(cx, cy);
      haptic('light');
    }
  });

  // Open / Close / Lock
  function openLocked(){
    lockMode = true; running = false;
    result.classList.remove('show'); cta.classList.add('show');
    stage.style.pointerEvents='none';

    root.classList.add('is-open'); document.body.classList.add('popper-open');
    try{ TG?.BackButton?.show?.(); TG?.BackButton?.onClick?.(()=> closePopper()); TG?.disableVerticalSwipes?.(); TG?.expand?.(); }catch(_){}
    startEnergyRaf(); window.syncBack?.();
  }

  function openPopper(opts){
    sessionKey = opts?.key || 'default';
    ENERGY_REGEN_MS = Number.isFinite(opts?.regenMs) ? opts.regenMs : ENERGY_REGEN_MS; // Variant-B
    energyMax = ENERGY_MAX_DEFAULT;

    best = getNum(k('best'), 0);

    if (energyAt() < START_MIN_ENERGY) return openLocked();

    // reset
    lockMode = false; updateScore(0); combo = 0; setCombo(false);
    result.classList.remove('show'); cta.classList.remove('show');
    stage.style.pointerEvents='auto';
    stage.querySelectorAll('.pp-target,.pp-spark,.pp-ripple').forEach(n=>n.remove());

    root.classList.add('is-open'); document.body.classList.add('popper-open');
    try{
      TG?.BackButton?.show?.();
      TG?.BackButton?.onClick?.(()=> closePopper());
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    running = true;
    lastDrainTs = performance.now();
    clearInterval(spawnId);
    spawn();
    spawnId = setInterval(()=>{ if(running) spawn(); }, SPAWN_EVERY_MS);

    startEnergyRaf();
    window.syncBack?.();
  }

  function closePopper(){
    running = false; lockMode = false; lastDrainTs = 0;
    clearInterval(spawnId); stopEnergyRaf();
    root.classList.remove('is-open'); document.body.classList.remove('popper-open');
    try{ TG?.BackButton?.hide?.(); }catch(_){}
    window.syncBack?.();
  }

  // Finish
  async function finish(outOfEnergy=false){
    running = false; clearInterval(spawnId);
    if (score > best){ best = score; setNum(k('best'), best); }
    bestEl.textContent  = best; worldEl.textContent = WORLD_RECORD;

    result.classList.add('show'); cta.classList.add('show');
    const btn = cta.querySelector('.btn'); if (btn) btn.textContent = outOfEnergy ? 'Out of energy — Close' : 'Close';
    haptic('medium');

    try{
      const base = window.APP_CONFIG?.WORKER_BASE;
      if (base){
        await fetch(`${base}games/submit`, {
          method:'POST', headers:{'content-type':'application/json'},
          body: JSON.stringify({
            game: GAME_NAME, mode:'daily', key: sessionKey, score,
            user: TG?.initDataUnsafe?.user || null
          })
        });
      }
    }catch(_){}
  }

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    if (lockMode && energyAt() >= START_MIN_ENERGY){
      openPopper({ key: sessionKey }); // regenMs оставляем текущий
    } else {
      closePopper();
    }
  });

  // Delegated opener (Variant-B: не подставляем 24ч, если атрибут не указан)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-popper]'); if (!t) return;
    e.preventDefault();
    const key  = t.getAttribute('data-game-key') || 'default';
    const hrsAttr = t.getAttribute('data-energy-regen-hours');
    const regenMs = (hrsAttr !== null && hrsAttr !== '')
      ? parseFloat(hrsAttr) * 3600_000
      : undefined;
    openPopper({ key, regenMs });
  });

  // Esc (desktop)
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closePopper(); });

  // экспорт
  window.openPopper  = (opts)=> openPopper(opts);
  window.closePopper = closePopper;
})();
</script>


<script>
/* ===== Lane Runner — sprites + tilt on lane change ===== */
(function laneRunner(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root   = document.getElementById('runner'); if (!root) return;
  const stage  = document.getElementById('rn-stage');
  const player = document.getElementById('rn-player');
  const timeEl = document.getElementById('rn-time');
  const barEl  = document.getElementById('rn-bar');
  const scoreEl= document.getElementById('rn-score-val');
  const resBox = document.getElementById('rn-result');
  const bestEl = document.getElementById('rn-best');
  const worldEl= document.getElementById('rn-world');
  const cta    = document.getElementById('rn-cta');

  /* ===== Sprites config (поставь свои пути/размеры) ===== */
  const SPRITES = {
    player: { img: 'travel.png', w: 56, h: 96 },
    obstacles: [
      { img: 'car.png',    w: 56, h: 96 },
      { img: 'car.png', w: 56, h: 96 },
      { img: 'car.png',  w: 56, h: 96 }
    ],
    coin: { img: 'coin.png', w: 38, h: 38 }
  };
  function applyPlayerSprite(){
    document.documentElement.style.setProperty('--player-w', SPRITES.player.w + 'px');
    document.documentElement.style.setProperty('--player-h', SPRITES.player.h + 'px');
    player.style.backgroundImage = `url(${SPRITES.player.img})`;
  }
  function pickObstacleSprite(){
    return SPRITES.obstacles[Math.floor(Math.random()*SPRITES.obstacles.length)];
  }
  function applyCoinVars(){
    document.documentElement.style.setProperty('--coin-w', SPRITES.coin.w + 'px');
    document.documentElement.style.setProperty('--coin-h', SPRITES.coin.h + 'px');
  }

  // CONFIG (крути как нужно)
  const DURATION_MS     = 45_000;           // длительность забега
  const WORLD_RECORD    = 5000;
  const BASE_SPEED_PX_S = 260;              // базовая скорость падения, px/сек
  const SPEED_ACCEL_EACH= 8_000;            // каждые N мс — ускорение
  const SPEED_DELTA     = 40;               // шаг ускорения px/сек
  const SPAWN_MS        = 550;              // интервал спавна объектов
  const COIN_PROB       = 0.30;             // шанс монетки
  const COIN_SCORE      = 15;               // очки за монетку
  const DIST_SCORE_K    = 0.06;             // очки за каждый px
  const PLAYER_Y        = 0.82;             // высота игрока (0..1)
  const COLLIDE_PAD     = 16;               // «мягкость» коллизии, px

  // STATE
  let lane = 1;                              // 0/1/2
  let score= 0, best = Number(localStorage.getItem('runner_best')||0);
  let running=false, t0=0, raf=0, spawnTimer=0;
  let backOff=null;
  let entities=[]; // {type:'obs'|'coin', lane:0..2, x,y,el}

  // helpers
  const clamp = (v,a,b)=> Math.max(a,Math.min(b,v));
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const mmss = ms => { const s=Math.max(0,Math.ceil(ms/1000)); return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`; };
  const laneCenters = ()=>{
    const w = stage.clientWidth, laneW = w/3;
    return [laneW*0.5, laneW*1.5, laneW*2.5];
  };
  function placePlayer(){
    const x = laneCenters()[lane];
    const y = stage.clientHeight * PLAYER_Y;
    player.style.left = x+'px';
    player.style.top  = y+'px';
  }
  function tilt(dir){
    // перезапуск анимации: снимаем классы, рефлоу, снова навешиваем
    player.classList.remove('tilt-left','tilt-right');
    void player.offsetWidth; // reflow
    player.classList.add(dir==='right' ? 'tilt-right' : 'tilt-left');
    setTimeout(()=> player.classList.remove('tilt-left','tilt-right'), 260);
  }

  // swipe / keys
  let startX=0,startY=0;
  stage.addEventListener('pointerdown', e=>{ startX=e.clientX; startY=e.clientY; }, {passive:true});
  stage.addEventListener('pointerup', e=>{
    if(!running) return;
    const dx = e.clientX - startX, dy = e.clientY - startY;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 24){
      const prev = lane;
      if (dx>0) lane = clamp(lane+1,0,2); else lane = clamp(lane-1,0,2);
      if (lane!==prev){ placePlayer(); tilt(dx>0?'right':'left'); haptic('light'); }
    }
  }, {passive:true});
  document.addEventListener('keydown', e=>{
    if(!running) return;
    const prev = lane;
    if (e.key==='ArrowLeft')  lane=clamp(lane-1,0,2);
    if (e.key==='ArrowRight') lane=clamp(lane+1,0,2);
    if (lane!==prev){ placePlayer(); tilt(lane>prev?'right':'left'); haptic('light'); }
  });

  // entities
  function spawn(){
    const isCoin = Math.random()<COIN_PROB;
    const L = Math.floor(Math.random()*3);
    const el = document.createElement('div');
    const centers = laneCenters();

    if (isCoin){
      el.className = 'rn-coin';
      el.style.width  = SPRITES.coin.w + 'px';
      el.style.height = SPRITES.coin.h + 'px';
      el.style.backgroundImage = `url(${SPRITES.coin.img})`;
    } else {
      el.className = 'rn-obstacle';
      const s = pickObstacleSprite();
      el.style.width  = s.w + 'px';
      el.style.height = s.h + 'px';
      el.style.backgroundImage = `url(${s.img})`;
    }

    stage.appendChild(el);
    const e = { type:isCoin?'coin':'obs', lane:L, x:centers[L], y:-40, el };
    el.style.left = e.x+'px'; el.style.top = e.y+'px';
    entities.push(e);
  }

  function tick(){
    const t = Date.now();
    const dt = Math.min(32, t - (tick._prev||t)); tick._prev = t;

    // таймер
    const elapsed = t - t0;
    const left = Math.max(0, DURATION_MS - elapsed);
    timeEl.textContent = mmss(left);
    barEl.style.transform = `scaleX(${Math.max(0,1 - elapsed/DURATION_MS)})`;

    // скорость (ускоряемся со временем)
    let speed = BASE_SPEED_PX_S + Math.floor(elapsed / SPEED_ACCEL_EACH) * SPEED_DELTA;

    // движение, очки за дистанцию
    const sy = speed * dt/1000;
    entities.forEach(e=>{
      e.y += sy;
      e.el.style.top = e.y+'px';
    });

    // дистанция → очки
    score += Math.round(sy * DIST_SCORE_K);
    scoreEl.textContent = score;

    // проверка столкновений и сбор монет
    const px = laneCenters()[lane];
    const py = stage.clientHeight * PLAYER_Y;
    const dead=[];
    for (let i=0;i<entities.length;i++){
      const e=entities[i];
      // убрать вышедшие
      if (e.y > stage.clientHeight + 80){ e.el.remove(); dead.push(i); continue; }

      if (e.lane===lane){
        const halfHPlayer = player.clientHeight * 0.45;
        const halfHEnt    = e.el.clientHeight * 0.45;
        const dy = Math.abs(e.y - py);
        if (dy < (halfHPlayer + halfHEnt - COLLIDE_PAD)){
          if (e.type==='obs'){
            crash(); return;
          } else if (e.type==='coin'){
            score += COIN_SCORE; scoreEl.textContent=score;
            haptic('medium');
            e.el.remove(); dead.push(i);
          }
        }
      }
    }
    // удалить мёртвых с конца
    for (let i=dead.length-1;i>=0;i--) entities.splice(dead[i],1);

    if (left<=0){ finish(); return; }
    raf = requestAnimationFrame(tick);
  }

  function crash(){
    haptic('heavy');
    finish();
  }

  function finish(){
    running=false;
    cancelAnimationFrame(raf);
    clearInterval(spawnTimer);

    if (score>best){ best=score; try{ localStorage.setItem('runner_best', String(best)); }catch(_){ } }
    bestEl.textContent=best; worldEl.textContent=WORLD_RECORD;

    resBox.classList.add('show'); cta.classList.add('show');
  }

  function openRunner(){
    // reset
    entities.forEach(e=> e.el.remove()); entities = [];
    resBox.classList.remove('show'); cta.classList.remove('show');
    score=0; scoreEl.textContent='0';

    root.classList.add('is-open'); document.body.classList.add('runner-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closeRunner();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    // спрайты и позиция игрока
    applyPlayerSprite(); applyCoinVars();
    lane = 1; placePlayer();

    // старт
    running = true;
    t0 = Date.now();
    tick._prev = t0;
    tick();
    clearInterval(spawnTimer);
    spawn(); // мгновенно
    spawnTimer = setInterval(spawn, SPAWN_MS);
  }

  function closeRunner(){
    running=false;
    cancelAnimationFrame(raf);
    clearInterval(spawnTimer);
    root.classList.remove('is-open'); document.body.classList.remove('runner-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  // CTA
  cta.addEventListener('click', e=>{
    if (!e.target.closest('.btn')) return;
    closeRunner(); openRunner();
  });

  // Openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-runner]'); if (!t) return;
    e.preventDefault(); openRunner();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-runner]')) closeRunner();
  });

  // Esc desktop
  document.addEventListener('keydown', e=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeRunner(); });

  // адаптация при ресайзе (центр дорожек)
  const ro = new ResizeObserver(()=> placePlayer());
  ro.observe(stage);
})();
</script>

<script>
/* ===== Flappy-lite+ — coins, shield, custom sprites, BackButton ===== */
(function flappyLitePlus(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root   = document.getElementById('flappy'); if (!root) return;
  const stage  = document.getElementById('fl-stage');
  const birdEl = document.getElementById('fl-bird');
  const hintEl = document.getElementById('fl-hint');
  const scoreEl= document.getElementById('fl-score');
  const barEl  = document.getElementById('fl-bar');

  const coinIco= document.getElementById('fl-coin-ico');
  const coinCnt= document.getElementById('fl-coin-count');
  const shIco  = document.getElementById('fl-shield-ico');
  const shBar  = document.getElementById('fl-shield-bar');

  const resBox = document.getElementById('fl-result');
  const bestEl = document.getElementById('fl-best');
  const worldEl= document.getElementById('fl-world');
  const cta    = document.getElementById('fl-cta');

  /* ===== ASSETS: поменяй пути/размеры под свои картинки ===== */
 // ЗАМЕНИ на свои картинки и размеры (CSS-пиксели, не обязаны совпадать с реальным размером PNG)
const ASSETS = {
  bird:   { img: 'bird.png',  w: 56, h: 42 },        // птичка
  pipes:  {                                  // трубы: верх/низ (если одна картинка — укажи её в обоих)
    top:    'pipe_top.png',
    bottom: 'pipe_bottom.png',
    width:  54                                // ВАЖНО: видимая ширина трубы в px
  },
  coin:   { img: 'coin.png',   w: 32, h: 32, value: 5 },
  shield: { img: 'shield.png', w: 34, h: 34, dur_ms: 6000 }
};


  /* ===== TUNING ===== */
  const WORLD_RECORD     = 200;
  const GRAVITY          = 1800;      // px/s^2
  const FLAP_VELOCITY    = -520;      // px/s
  const SPEED_X          = 220;       // базовая скорость труб
  const ACCEL_EACH_MS    = 8000;      // автоускорение каждые N мс
  const SPEED_STEP       = 28;        // шаг ускорения
  const PIPE_SPAWN_MS    = 1300;      // частота спавна труб
  const GAP_MIN          = 150;       // мин. зазор
  const GAP_MAX          = 190;       // макс. зазор
  const GAP_TOP_PAD      = 80;        // отступ от краёв
  const BIRD_X_FACTOR    = 0.25;      // 25% ширины
  const ROT_UP           = -35, ROT_DOWN = 90;
  const SAFE_FLOOR_PAD   = 6;

  // items
  const COIN_IN_GAP_PROB = 0.9;      // шанс монетки в каждой щели
  const SHIELD_PROB      = 0.9;      // шанс щита (редкий)
  const SHIELD_COOLDOWN  = 9000;      // не чаще одного раз в N мс

  // === Magnet (coins attract to bird when shield is active) ===
const MAGNET_ENABLED   = true;  // можно выключить
const MAGNET_RADIUS    = 140;   // радиус захвата, px
const MAGNET_PULL_PX_S = 300;   // скорость притяжения, px/сек


  // STATE
  let best     = Number(localStorage.getItem('flappy_best')||0);
  let running  = false, started=false;
  let raf      = 0, spawnT=0, t0=0, backOff=null;
  let w=0,h=0, birdX=0, birdY=0, birdVY=0;

  let pipes=[];   // {x, gapY, gap, topEl, botEl, passed:false}
  let items=[];   // [{type:'coin'|'shield', x,y, el}]
  let lastShieldSpawn = 0;

  let score=0, coins=0;
  let shieldActive=false, shieldUntil=0;

  // helpers
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const clamp  = (v,a,b)=> Math.max(a, Math.min(b, v));
  const rand   = (a,b)=> a + Math.random()*(b-a);

  // apply assets → css vars & backgrounds
  function applyAssets(){
    // bird
    document.documentElement.style.setProperty('--bird-w', (ASSETS.bird.w||48)+'px');
    document.documentElement.style.setProperty('--bird-h', (ASSETS.bird.h||36)+'px');
    if (ASSETS.bird.img){
      birdEl.classList.add('fl-bird--sprite');
      birdEl.style.backgroundImage = `url(${ASSETS.bird.img})`;
    } else {
      birdEl.classList.remove('fl-bird--sprite'); birdEl.style.backgroundImage = '';
    }
    // pipes
    document.documentElement.style.setProperty('--pipe-w', (ASSETS.pipes.width||76)+'px');
    // hud icons
    if (ASSETS.coin.img) coinIco.style.backgroundImage = `url(${ASSETS.coin.img})`;
    if (ASSETS.shield.img) shIco.style.backgroundImage = `url(${ASSETS.shield.img})`;
    document.documentElement.style.setProperty('--coin-w', (ASSETS.coin.w||32)+'px');
    document.documentElement.style.setProperty('--coin-h', (ASSETS.coin.h||32)+'px');
    document.documentElement.style.setProperty('--pow-w',  (ASSETS.shield.w||34)+'px');
    document.documentElement.style.setProperty('--pow-h',  (ASSETS.shield.h||34)+'px');
  }

  // layout
  function layout(){
    w = stage.clientWidth; h = stage.clientHeight;
    birdX = w * BIRD_X_FACTOR;
    if (!started){ birdY = h * 0.45; applyBird(); }
  }
  function applyBird(){
    birdEl.style.left = birdX + 'px';
    birdEl.style.top  = birdY + 'px';
  }
  function setScore(v){ scoreEl.textContent = v; }
  function setCoins(v){ coinCnt.textContent = v; }

  // pipes
  function spawnPipe(){
    const gap = rand(GAP_MIN, GAP_MAX);
    const minY = GAP_TOP_PAD + gap/2;
    const maxY = h - GAP_TOP_PAD - gap/2;
    const gapY = rand(minY, maxY);

    const top = document.createElement('div');
    const bot = document.createElement('div');
    top.className = 'fl-pipe-part';
    bot.className = 'fl-pipe-part';
    if (ASSETS.pipes.top && ASSETS.pipes.bottom){
      top.classList.add('fl-pipe--sprite'); bot.classList.add('fl-pipe--sprite');
      top.style.backgroundImage = `url(${ASSETS.pipes.top})`;
      bot.style.backgroundImage = `url(${ASSETS.pipes.bottom})`;
    }
    stage.appendChild(top); stage.appendChild(bot);

    const p = { x: w + (ASSETS.pipes.width||76), gapY, gap, topEl: top, botEl: bot, passed:false };
    pipes.push(p);
    positionPipe(p);

    // coin in gap?
    if (Math.random() < COIN_IN_GAP_PROB){
      const c = document.createElement('div');
      c.className = 'fl-coin';
      if (ASSETS.coin.img) c.style.backgroundImage = `url(${ASSETS.coin.img})`;
      stage.appendChild(c);
      items.push({ type:'coin', x: p.x + 200, y: gapY, el: c }); // чуть правее появления трубы
      positionItem(items[items.length-1]);
    }

    // occasional shield (with cooldown)
    if (Date.now() - lastShieldSpawn > SHIELD_COOLDOWN && Math.random() < SHIELD_PROB){
      const s = document.createElement('div');
      s.className = 'fl-power';
      if (ASSETS.shield.img) s.style.backgroundImage = `url(${ASSETS.shield.img})`;
      stage.appendChild(s);
      items.push({ type:'shield', x: p.x + 300, y: gapY - gap*0.35, el: s });
      positionItem(items[items.length-1]);
      lastShieldSpawn = Date.now();
    }
  }

  function positionPipe(p){
    const pipeW = (ASSETS.pipes.width||76);
    const th = p.gapY - p.gap/2;   // height of top pipe
    const bt = p.gapY + p.gap/2;   // top of bottom pipe
    p.topEl.style.left = p.x + 'px';
    p.topEl.style.top  = '0px';
    p.topEl.style.height = th + 'px';
    p.topEl.style.width  = pipeW + 'px';
    p.botEl.style.left = p.x + 'px';
    p.botEl.style.top  = bt + 'px';
    p.botEl.style.height = (h - bt) + 'px';
    p.botEl.style.width  = pipeW + 'px';
  }

  function positionItem(it){
    it.el.style.left = it.x + 'px';
    it.el.style.top  = it.y + 'px';
  }

  function removePipe(p){ p.topEl.remove(); p.botEl.remove(); }
  function removeItem(it){ it.el.remove(); }

  // collisions
  function rectsOverlap(a,b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }
  function collidePipe(){
    const br = birdEl.getBoundingClientRect();
    for (const p of pipes){
      if (rectsOverlap(br, p.topEl.getBoundingClientRect()) || rectsOverlap(br, p.botEl.getBoundingClientRect())){
        return true;
      }
    }
    return false;
  }
  function collideItems(){
    const br = birdEl.getBoundingClientRect();
    const dead=[];
    for (let i=0;i<items.length;i++){
      const it = items[i];
      const ir = it.el.getBoundingClientRect();
      if (rectsOverlap(br, ir)){
        if (it.type==='coin'){
          coins += 1; setCoins(coins);
          score += (ASSETS.coin.value||5); setScore(score);
          haptic('medium');
        } else if (it.type==='shield'){
          activateShield();
          haptic('medium');
        }
        removeItem(it); dead.push(i);
      }
    }
    for (let i=dead.length-1;i>=0;i--) items.splice(dead[i],1);
  }

  // shield
  function activateShield(){
    shieldActive = true;
    shieldUntil  = Date.now() + (ASSETS.shield.dur_ms||6000);
    birdEl.classList.add('fl-bird--shield');
  }
  function updateShieldHud(){
    if (!shieldActive){ shBar.style.transform = 'scaleX(0)'; return; }
    const left = shieldUntil - Date.now();
    if (left <= 0){
      shieldActive = false; birdEl.classList.remove('fl-bird--shield');
      shBar.style.transform = 'scaleX(0)';
    } else {
      const pct = clamp(left / (ASSETS.shield.dur_ms||6000), 0, 1);
      shBar.style.transform = `scaleX(${pct})`;
    }
  }

  // control
  function flap(){
    if (!running) return;
    if (!started){
      started = true;
      hintEl.style.display = 'none';
      birdVY = FLAP_VELOCITY;
    } else {
      birdVY = FLAP_VELOCITY;
    }
    haptic('light');
  }

  // loop
  function tick(){
    const now = performance.now();
    const dt  = Math.min(32, now - (tick._prev||now)); tick._prev = now;

    // progress bar (просто «бежит»)
    const elapsed = now - t0;
    const prog = Math.min(1, elapsed / 45000);
    barEl.style.transform = `scaleX(${1-prog})`;

    // speed
    const speed = SPEED_X + Math.floor((now - t0) / ACCEL_EACH_MS) * SPEED_STEP;

    if (started){
      birdVY += GRAVITY * (dt/1000);
      birdY  += birdVY * (dt/1000);

      const ang = clamp((birdVY/600)*45, ROT_UP, ROT_DOWN);
      birdEl.style.transform = `translate(-50%,-50%) rotate(${ang}deg)`;

      const topLimit = 0 + 6;
      const botLimit = h - SAFE_FLOOR_PAD;
      if (birdY <= topLimit){ birdY = topLimit; birdVY = 0; }
      if (birdY >= botLimit){ birdY = botLimit; if (!shieldActive){ crash(); return; } else { /* мягко отталкиваемся */ birdVY = -200; } }
    } else {
      birdY += Math.sin(now/300) * 0.12;
    }

// move pipes/items (+ coin magnet when shieldActive)
const dx = speed * dt/1000;
for (const p of pipes){ 
  p.x -= dx; 
  positionPipe(p); 
}

for (const it of items){
  // обычный скролл сцены
  it.x -= dx;

  // магнит только для монет и только при активном щите
  if (MAGNET_ENABLED && shieldActive && it.type === 'coin'){
    const vx = birdX - it.x;
    const vy = birdY - it.y;
    const dist = Math.hypot(vx, vy);

    if (dist < MAGNET_RADIUS){
      // шаг притяжения (ограничиваем, чтобы не «перескакивало»)
      const pull = MAGNET_PULL_PX_S * (dt/1000);
      const step = Math.min(pull, dist || 0);
      const nx = vx / (dist || 1);
      const ny = vy / (dist || 1);

      it.x += nx * step;
      it.y += ny * step;

      // лёгкий визуальный намёк: чуть увеличим монетку, когда в зоне магнита
      it.el.style.transform = 'translate(-50%,-50%) scale(1.08)';
    } else {
      it.el.style.transform = 'translate(-50%,-50%)';
    }
  } else {
    // вне магнита — обычный размер
    it.el.style.transform = 'translate(-50%,-50%)';
  }

  positionItem(it);
}


    // passed score
    for (const p of pipes){
      if (!p.passed && p.x + (ASSETS.pipes.width||76) < birdX){
        p.passed = true; score += 1; setScore(score); haptic('light');
      }
    }

    // remove off-screen
    while (pipes.length && pipes[0].x < -(ASSETS.pipes.width||76)-2){ removePipe(pipes[0]); pipes.shift(); }
    while (items.length && items[0].x < -80){ removeItem(items[0]); items.shift(); }

    // collisions
    collideItems();
    if (started && collidePipe()){
      if (shieldActive){
        // гасим щит при касании трубы и даём микро-отдачу
        shieldActive = false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';
        birdVY = -260;
      } else {
        crash(); return;
      }
    }

    // spawn pipes
    if (now - spawnT > PIPE_SPAWN_MS){ spawnT = now; spawnPipe(); }

    // HUD
    applyBird();
    updateShieldHud();

    raf = requestAnimationFrame(tick);
  }

  function crash(){ haptic('heavy'); finish(); }
  function finish(){
    running=false; cancelAnimationFrame(raf);
    if (score > best){ best=score; try{ localStorage.setItem('flappy_best', String(best)); }catch(_){ } }
    document.getElementById('fl-best').textContent = best;
    document.getElementById('fl-world').textContent = WORLD_RECORD;
    resBox.classList.add('show'); cta.classList.add('show');
  }

  function resetScene(){
    // clear
    pipes.forEach(removePipe); pipes = [];
    items.forEach(removeItem); items = [];
    coins=0; setCoins(0);
    shieldActive=false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';
    // bird
    started=false; score=0; setScore(0);
    hintEl.style.display = '';
    birdVY = 0; birdEl.style.transform = 'translate(-50%,-50%) rotate(0deg)';
    layout();
    // spawn timer
    spawnT = performance.now() + 400;
    tick._prev = performance.now();
  }

  function openFlappy(){
    root.classList.add('is-open'); document.body.classList.add('flappy-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closeFlappy();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    resBox.classList.remove('show'); cta.classList.remove('show');

    applyAssets();
    layout(); resetScene();

    running = true; t0 = performance.now(); raf = requestAnimationFrame(tick);
  }

  function closeFlappy(){
    running=false; cancelAnimationFrame(raf);
    root.classList.remove('is-open'); document.body.classList.remove('flappy-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  // controls
  stage.addEventListener('pointerdown', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  document.addEventListener('keydown', (e)=>{
    if (!root.classList.contains('is-open')) return;
    if (e.code==='Space' || e.key==='ArrowUp'){ e.preventDefault(); flap(); }
    if (e.key==='Escape'){ closeFlappy(); }
  });

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closeFlappy(); openFlappy();
  });

  // openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-flappy]'); if (!t) return;
    e.preventDefault(); openFlappy();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-flappy]')) closeFlappy();
  });

  // resize
  const ro = new ResizeObserver(()=> layout());
  ro.observe(stage);
})();
</script>

<script>
/* ===== Memory Pairs 3×4 — flips, timer, moves, BackButton ===== */
(function memoryPairs(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root  = document.getElementById('pairs'); if (!root) return;
  const grid  = document.getElementById('mp-grid');
  const timeEl= document.getElementById('mp-time');
  const movesEl=document.getElementById('mp-moves');
  const resBox= document.getElementById('mp-result');
  const yourT = document.getElementById('mp-your-time');
  const bestT = document.getElementById('mp-best-time');
  const cta   = document.getElementById('mp-cta');

  // ===== ASSETS: эмодзи по умолчанию, можно заменить на картинки =====
  const ASSETS = {
    mode: 'emoji',  // 'emoji' | 'images'
    emoji: ['🎃','👻','🕸️','🍭','🧩','⭐'], // 6 пар → 12 карт
    images: [
      // 'assets/pairs/01.png','assets/pairs/02.png','assets/pairs/03.png',
      // 'assets/pairs/04.png','assets/pairs/05.png','assets/pairs/06.png'
    ]
  };

  // STATE
  let values = [];          // 12 значений (6×2)
  let first = null;         // {idx, val, el}
  let lock  = false;        // блок кликов во время проверки
  let matched = 0;          // совпавшие пары
  let moves = 0;

  // timer
  let running=false, t0=0, raf=0, backOff=null;
  let bestMs = Number(localStorage.getItem('pairs_best_ms')||0);

  // utils
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const shuffle = (a)=>{ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; };
  const fmt = (ms)=>{
    const s = Math.floor(ms/1000), m = Math.floor(s/60), sec = s%60, tenths = Math.floor((ms%1000)/100);
    return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}.${tenths}`;
  };

  // build deck
  function buildValues(){
    const src = (ASSETS.mode==='images' ? ASSETS.images : ASSETS.emoji).slice(0,6);
    const deck = shuffle([...src, ...src]); // 12 карт
    values = deck;
  }

  function cardTemplate(i, val){
    const isImg = (ASSETS.mode==='images');
    const frontStyle = isImg ? `class="mp-face mp-face--front mp-front-img" style="background-image:url('${val}');"` : `class="mp-face mp-face--front"`;
    const frontInner = isImg ? '' : val;
    return `
      <button class="mp-card" data-idx="${i}" aria-label="card">
        <span class="mp-in">
          <i class="mp-face mp-face--back"></i>
          <i ${frontStyle}>${frontInner}</i>
        </span>
      </button>
    `;
  }

  function drawGrid(){
    grid.innerHTML = values.map((v,i)=> cardTemplate(i,v)).join('');
  }

  function reset(){
    matched = 0; moves = 0; movesEl.textContent = '0';
    first = null; lock = false; running=false; cancelAnimationFrame(raf);
    timeEl.textContent = '00:00.0';
    resBox.classList.remove('show'); cta.classList.remove('show');
    buildValues(); drawGrid();
  }

  function startTimer(){
    if (running) return;
    running = true; t0 = performance.now();
    tick();
  }
  function tick(){
    if (!running){ cancelAnimationFrame(raf); return; }
    const ms = performance.now() - t0;
    timeEl.textContent = fmt(ms);
    raf = requestAnimationFrame(tick);
  }

  function finish(){
    running=false; cancelAnimationFrame(raf);
    const ms = performance.now() - t0;
    yourT.textContent = fmt(ms);

    if (bestMs===0 || ms < bestMs){ bestMs = ms; try{ localStorage.setItem('pairs_best_ms', String(bestMs)); }catch(_){} }
    bestT.textContent = fmt(bestMs || ms);

    resBox.classList.add('show'); cta.classList.add('show');
    haptic('medium');
  }

  // flip logic
  function onCardClick(btn){
    if (lock) return;
    const idx = Number(btn.getAttribute('data-idx'));
    const val = values[idx];

    if (btn.disabled) return;       // уже совпала
    if (!running) startTimer();     // первый клик запускает таймер

    // flip
    btn.classList.add('is-flipped'); haptic('light');

    if (!first){
      first = { idx, val, el: btn };
      return;
    }

    // второй клик
    moves += 1; movesEl.textContent = String(moves);
    lock = true;

    if (val === first.val && idx !== first.idx){
      // MATCH
      setTimeout(()=>{
        btn.disabled = true; first.el.disabled = true;
        btn.classList.add('is-matched'); first.el.classList.add('is-matched');
        matched += 1;
        first = null; lock = false;
        haptic('medium');
        if (matched === 6){ finish(); }
      }, 120);
    } else {
      // MISMATCH
      btn.classList.add('is-wrong'); first.el.classList.add('is-wrong');
      haptic('light');
      setTimeout(()=>{
        btn.classList.remove('is-flipped','is-wrong');
        first.el.classList.remove('is-flipped','is-wrong');
        first = null; lock = false;
      }, 650);
    }
  }

  // open/close
  function openPairs(){
    reset();

    root.classList.add('is-open'); document.body.classList.add('pairs-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closePairs();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    grid.addEventListener('click', gridHandler, { passive:true });
  }

  function closePairs(){
    running=false; cancelAnimationFrame(raf);
    grid.removeEventListener('click', gridHandler);
    root.classList.remove('is-open'); document.body.classList.remove('pairs-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  function gridHandler(e){
    const b = e.target.closest('.mp-card'); if (!b) return;
    if (!b.classList.contains('is-flipped')) onCardClick(b);
  }

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closePairs(); openPairs();
  });

  // openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-pairs]'); if (!t) return;
    e.preventDefault(); openPairs();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-pairs]')) closePairs();
  });

  // Esc desktop
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closePairs(); });
})();
</script>




</body>
</html>
