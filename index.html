<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Mini‚Äëapp | Router + BackButton + No-Swipe (robust)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
const tg = window.Telegram && window.Telegram.WebApp;

function openAsMainMiniApp(startParam = 'home'){
  const url = `https://t.me/serge_kamensky_bot/app?startapp=${encodeURIComponent(startParam)}`;
  // –µ—Å–ª–∏ –º—ã –≤–Ω—É—Ç—Ä–∏ Telegram ‚Äî –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ (—Ñ—É–ª–ª—Å–∫—Ä–∏–Ω)
  if (tg && typeof tg.openTelegramLink === 'function') {
    tg.openTelegramLink(url);
  } else {
    // –æ—Ç–∫—Ä—ã—Ç–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω–µ –≤ Telegram) ‚Üí –ø–æ–∫–∞–∂–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É t.me (–Ω–æ—Ä–º–∞–ª—å–Ω–æ)
    window.open(url, '_blank');
  }
}
</script>


  <style>
    :root{
      --tabH: 64px;
      --navGap: 12px;
      --bg:#0b0c15; --text:#f4f6fa; --border:rgba(255,255,255,.10);
      --appW: 428px;
    }
    *{ box-sizing:border-box }
    img{ max-width:100%; display:block }
    html,body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      overscroll-behavior: none;
    }
    @media (min-width:900px){ body{ display:grid; place-items:center; } }
    .wrap{
      width:100%; max-width:1080px; margin:0 auto;
      min-height:100svh;
      padding:16px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px);
    }
    @media (min-width:900px){
      .wrap{ max-width:var(--appW); padding:20px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px); }
    }
    main>section, section.page{ display:none }
    main>section.active, section.page.active{ display:block }
    .btm-nav{
      position:fixed; left:0; right:0;
      bottom: calc(var(--navGap) + env(safe-area-inset-bottom, 0px));
      height: var(--tabH);
      z-index: 9999;
      display:grid; grid-template-columns:repeat(5,1fr); align-items:center;
      padding: 6px 6px 6px;
      background: rgba(10,12,14,.72);
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      border-left:0; border-right:0; border-bottom:0;
      border-radius: 16px 16px 0 0;
    }
    .btm-nav .tab{
      height:100%; border:0; background:none; color:#dfe3e6; cursor:pointer;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
      font-size:11px; font-weight:700;
      filter: grayscale(.35) saturate(.8); opacity:.85;
      border-radius:14px; -webkit-tap-highlight-color:transparent;
    }
    .btm-nav .tab img{ width:24px; height:24px }
    .btm-nav .tab:active{ transform: translateY(1px) }
    .btm-nav .tab.active{ opacity:1; filter:none; color:#fff; position:relative }
    .btm-nav .tab.active::before{
      content:""; position:absolute; inset:6px 10px 18px 10px; z-index:-1;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    @media (min-width:900px){
      .btm-nav{ left:50%; right:auto; width: var(--appW); transform: translateX(-50%); }
    }
    .card{ background:rgba(255,255,255,.05); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .page-title{ margin:0 0 12px }
    .h1{ font-weight:800; font-size:20px; margin:0 0 8px }
    .muted-sm{ opacity:.8 }
    .sheet{ position:fixed; inset:0; z-index:9990; pointer-events:none; }
    .sheet.is-open{ pointer-events:auto; }
    .sheet__overlay{
      position:absolute; left:0; right:0; top:0;
      bottom: calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      background: rgba(0,0,0,.48); opacity:0; transition:opacity .2s ease;
      -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
    }
    .sheet.is-open .sheet__overlay{ opacity:1; }
    .sheet__panel{
      position:absolute; left:0; right:0; margin:0 auto;
      width:min(820px,100%); max-height:88vh; overflow:auto;
      background:linear-gradient(180deg, rgba(18,20,24,.98), rgba(18,20,24,.96));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 20px 40px rgba(0,0,0,.45);
      transition: transform .28s cubic-bezier(.2,.8,.2,1), opacity .2s ease;
      padding:12px 14px calc(16px + var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      will-change: transform;
      touch-action: pan-y;
    }
    .sheet.sheet-bottom .sheet__panel{ bottom:0; top:auto; border-radius: 16px 16px 0 0; transform: translateY(100%); }
    .sheet.is-open.sheet-bottom .sheet__panel{ transform: translateY(0); }
    .sheet__handle{ width:42px; height:4px; border-radius:999px; margin:6px auto 10px; background:rgba(255,255,255,.18) }
    .sheet__header{ display:flex; align-items:center; gap:10px; margin:0 0 8px }
    .sheet__title{ font-weight:800; font-size:18px; margin:0 }
    .sheet__close{ margin-left:auto; border:0; background:transparent; color:#fff; opacity:.85; width:36px; height:36px; border-radius:10px; display:grid; place-items:center }
    .sheet__close:active{ transform:translateY(1px); opacity:1 }
    .sheet__body{ display:grid; gap:10px }
    body.sheet-open{ overflow:hidden }
    @media (min-width:900px){ .sheet__panel{ width:min(var(--appW),92vw); } }
  </style>


<style>
/* ===== –ì–õ–ê–í–ù–ê–Ø HERO GIF (full-bleed) ===== */
:root{
  --wrapPadX: 14px;   /* –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞—Å—Ç—å —Å –±–æ–∫–æ–≤—ã–º–∏ –ø–∞–¥–¥–∏–Ω–≥–∞–º–∏ .wrap */
  --wrapPadTop: 16px; /* –≤–µ—Ä—Ö–Ω–∏–π –ø–∞–¥–¥–∏–Ω–≥ .wrap */
}
.hero{
  position: relative;
  margin: calc(-1 * var(--wrapPadTop)) calc(-1 * var(--wrapPadX)) 14px;
  padding-top: env(safe-area-inset-top, 0px);
  background:#000; overflow:hidden;
}
.hero__media{
  width:100%;
  height: clamp(260px, 42vh, 460px);
  object-fit: cover; display:block;
}
.hero::after{
  content:""; position:absolute; left:0; right:0; bottom:-1px; height:84px;
  pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 100%);
}

/* ===== PROMO (–æ–¥–Ω–∞ –ø–ª–∞—à–∫–∞, –±–µ–∑ .card-–æ–±—ë—Ä—Ç–∫–∏) ===== */
.promo{
  display:grid; grid-template-columns:48px 1fr auto; align-items:center; gap:12px;
  padding:10px 12px; margin:0 0 12px;
  background: rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
}
.promo__icon{ width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden }
.promo__icon img{ width:28px; height:28px; display:block }
.promo__title{ font-weight:800 }
.promo__sub{ opacity:.8; font-size:13px; margin-top:2px }
.promo__btn{
  height:36px; padding:0 14px; border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(180deg,#2d7cff,#0f56ff); color:#fff; font-weight:800; cursor:pointer;
}
.promo__btn:active{ transform: translateY(1px) }

/* ===== LIST CARD ("Start here") ===== */
.list-card .list-head{ font:800 16px/1.2 Inter,system-ui; margin-bottom:8px }
.list{ display:grid; gap:8px }

/* –£–±–∏—Ä–∞–µ–º —Ñ–æ–Ω –∏ —Ä–∞–º–∫–∏ —É –ø—É–Ω–∫—Ç–æ–≤ */
.list-card .list__item{ background:transparent; border:0; box-shadow:none }

/* –°–¥–≤–∏–≥–∞–µ–º –ª–µ–≤–µ–µ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–µ–º –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ä—Ç–æ—á–∫–∏ */
.list-card.tight .list{ margin-left:-16px; margin-right:-16px } /* 16 = padding .card */
.list-card.tight .list__item{
  padding:12px 16px; gap:10px;
  display:grid; grid-template-columns:36px 1fr auto; align-items:center;
}
.list-card.tight .list__icon{
  width:36px; height:36px; border-radius:10px;
  display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden
}
.list-card.tight .list__icon img{ width:22px; height:22px; display:block }
.list__text{ display:grid; gap:4px }
.list__title{ font-weight:800 }
.list__sub{ opacity:.8; font-size:13px }

/* –ö–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–µ–ª–∫–∞ */
.list__chev-btn{
  width:36px; height:36px; display:grid; place-items:center;
  border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:transparent; color:inherit; font-size:18px; cursor:pointer;
}
.list__chev-btn:active{ transform:translateY(1px) }

/* —Ö–æ–≤–µ—Ä –ø–æ –∂–µ–ª–∞–Ω–∏—é */
.list-card .list__item:hover{ background: rgba(255,255,255,.04) }

/* —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –ø–æ–¥ –º–æ–±–∏–ª—å–Ω–æ–µ –ø–æ–ª–æ—Ç–Ω–æ */
@media (min-width:900px){
  .hero{
    margin-left: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
    margin-right: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
  }
}


</style>

<style>
  /* ===== FULLSCREEN INTRO ===== */
/* ===== FULLSCREEN INTRO (–æ–±–Ω–æ–≤–ª–µ–Ω–æ) ===== */
:root{ --introBottomPad: 28px; } /* –Ω–∞—Å–∫–æ–ª—å–∫–æ –≤—ã—à–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç –Ω–∏–∂–Ω–µ–π –ø–µ—Ä–µ–∫–ª–∞–¥–∏–Ω—ã */

.intro{
  position:fixed; inset:0; z-index:10050;
  background:#000; color:#fff;
  display:none; pointer-events:auto;
}
.intro.is-open{ display:block; }
body.intro-open{ overflow:hidden; }

.intro__wrap{
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  padding:
    calc(env(safe-area-inset-top,0px) + 6px)
    14px
    calc(env(safe-area-inset-bottom,0px) + var(--introBottomPad));
}

.intro__progress{
  display:flex; gap:8px; justify-content:center;
  padding:8px 0 12px;
}
.intro__seg{ width:44px; height:4px; border-radius:999px; background:rgba(255,255,255,.28) }
.intro__seg.active{ background:#fff }

.intro__stage{
  flex:1; display:grid; place-items:center; padding:12px; text-align:center;
}
.intro__slides{ width:100% }
.intro__slide{ display:none }
.intro__slide.active{ display:block }

.intro__h1{ font-weight:900; font-size:28px; margin:0 0 10px }
.intro__p{ opacity:.85; font-size:15px; margin:0 auto; max-width:26ch }

/* –Ω–∏–∑ —ç–∫—Ä–∞–Ω–∞ ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ */
.intro__actions{
  margin-top:auto; display:grid; gap:10px;
  padding-top:8px;
}
.intro__actions--one{ grid-template-columns:1fr }
.intro__actions--two{ grid-template-columns:1fr 1fr }

.intro__btn{
  height:52px; padding:0 16px; border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.intro__btn--primary{ background:#fff; color:#000; border-color:#fff }
.intro__btn--ghost{ background:transparent }
.intro__btn:active{ transform:translateY(1px) }

@media (min-width:900px){
  .intro__wrap{ max-width: var(--appW,428px); margin:0 auto }
}
</style>
 <style>
/* ===== FULLSCREEN CLICKER v2 ===== */
.clicker{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.clicker.is-open{ display:block; }
body.clicker-open{ overflow:hidden; }

.clicker__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* TIMER */
.timer{ width:100%; max-width:520px; margin:0 auto 10px; }
.timer__row{ display:grid; justify-items:center; gap:6px; }
.timer__text{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.timer__bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.timer__bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* COUNTER (–º–∏–Ω–∏-–∏–∫–æ–Ω–∫–∞ + —á–∏—Å–ª–æ) */
.clicker__counter{
  align-self:center; display:flex; align-items:center; gap:10px;
  min-height:40px; padding:6px 12px; border-radius:999px;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  font:800 18px/1 Inter,system-ui;
}
.counter__mini{ width:26px; height:26px; border-radius:6px; overflow:hidden; display:block }

.clicker__stage{ flex:1; display:grid; place-items:center; position:relative; touch-action:manipulation; user-select:none; }
.clicker__img{
  width:min(84vw,520px); height:auto; display:block; cursor:pointer;
  -webkit-user-drag:none; -webkit-tap-highlight-color:transparent;
  filter: drop-shadow(0 20px 60px rgba(0,255,255,.12));
  transition: transform 90ms ease, filter 120ms ease;
}
.clicker__img.is-press{ transform:scale(.96); filter:drop-shadow(0 6px 24px rgba(0,255,255,.25)); }

.clicker__score{
  width:100%; max-width:520px; margin:12px auto 0;
  display:grid; grid-template-columns:1fr 1fr auto; align-items:center; gap:14px;
  padding:12px 16px; border-radius:18px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  visibility:hidden; opacity:0; transition:.2s ease;
}
.clicker__score.show{ visibility:visible; opacity:1; }
.score__cell{ display:grid; gap:4px; justify-items:center }
.score__val{ font:800 20px/1 Inter,system-ui }
.score__sub{ font:600 12px/1.1 Inter,system-ui; opacity:.8 }
.score__chev{ font:20px/1 Inter; opacity:.6 }

/* CTA (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞) */
.clicker__cta{
  position:absolute; left:14px; right:14px;
  bottom: calc(env(safe-area-inset-bottom,0px) + 12px);
  display:none;
}
.clicker__cta .btn{
  width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter,system-ui;
  background:#fff; color:#000; border:1px solid #fff;
}
.clicker__cta.show{ display:block; }

/* —ç—Ñ—Ñ–µ–∫—Ç—ã */
.spark{ position:absolute; pointer-events:none; font-weight:900; font-size:22px; color:#6be3ff;
  transform:translate(-50%,-50%); animation:spark-rise .7s ease-out forwards; text-shadow:0 0 10px rgba(107,227,255,.55); }
@keyframes spark-rise{ 0%{opacity:1;transform:translate(-50%,-50%) scale(1)} 60%{opacity:.9;transform:translate(-50%,-110%) scale(1.05)} 100%{opacity:0;transform:translate(-50%,-170%) scale(.9)} }
.ripple{ position:absolute; width:14px; height:14px; border-radius:999px; border:2px solid rgba(255,255,255,.35);
  transform:translate(-50%,-50%); pointer-events:none; animation:ripple .45s ease-out forwards; }
@keyframes ripple{ to{ width:140px; height:140px; opacity:0; } }

@media (min-width:900px){ .clicker__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* === –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—Å—Ç—É–ø–∞ —Å–Ω–∏–∑—É –¥–ª—è CTA === */
:root{
  --ctaGap: 44px; /* –ø–æ–¥–Ω–∏–º–∏/–æ–ø—É—Å—Ç–∏ –∫–Ω–æ–ø–∫—É: 36‚Äì56px –æ–±—ã—á–Ω–æ –∏–¥–µ–∞–ª—å–Ω–æ */
}

/* –∫–Ω–æ–ø–∫–∞ –≤–Ω–∏–∑—É ‚Äî —É—á—ë—Ç –ø–∞–ª–æ—á–∫–∏ –∏ safe-area */
.clicker__cta{
  position:absolute; left:14px; right:14px;
  bottom: calc(env(safe-area-inset-bottom, 0px) + var(--ctaGap));
  display:none;
}
.clicker__cta.show{ display:block; }

/* === –°–ß–Å–¢ –ë–ï–ó –ü–ò–õ–õ–´/–†–ê–ú–ö–ò, √ó3 –∫—Ä—É–ø–Ω–µ–µ === */
.clicker__counter{
  /* —É–±–∏—Ä–∞–µ–º ¬´–ø–∏–ª–ª—É¬ª */
  background: transparent !important;
  border: 0 !important;
  box-shadow: none !important;
  /* –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞ –∏ –æ—Ç—Å—Ç—É–ø—ã */
  align-self:center;
  display:flex; align-items:center; gap:14px;
  padding: 0; min-height: 0;
}

/* –º–∏–Ω–∏-–∏–∫–æ–Ω–∫–∞ —É —Å—á—ë—Ç–∞ ‚Äî 3√ó –æ—Ç –ø—Ä–µ–∂–Ω–∏—Ö ~26px (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ) */
.counter__mini{
  width: clamp(60px, 18vw, 90px);
  height: clamp(60px, 18vw, 90px);
  border-radius: 14px;
  overflow: hidden;
  display:block;
}

#counter-val{
  font-weight: 900;
  font-size: clamp(36px, 8vw, 56px); /* –±—ã–ª–æ 48 / 10vw / 72 */
  line-height: 1;
  letter-spacing: .2px;
  text-shadow: 0 2px 10px rgba(0,0,0,.25);
}
 </style>

 <style>
  /* ===== GAMES CARD ===== */
.list-card.games .list__item{ background:transparent; border:0; box-shadow:none }
.list__btn{
  height:36px; padding:0 14px; border-radius:999px;
  border:1px solid rgba(255,255,255,.10);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.list__btn--primary{ background:#fff; color:#000; border-color:#fff }
.list__btn:active{ transform:translateY(1px) }

/* —á—É—Ç—å –ø–ª–æ—Ç–Ω–µ–µ —Å–µ—Ç–∫–∞ –ø–æ–¥ –∫–Ω–æ–ø–∫—É —Å–ø—Ä–∞–≤–∞ */
.list-card.games.tight .list__item{
  grid-template-columns:36px 1fr auto;
}
:root{ --gap-block: 16px; }           /* –ø–æ–¥–ø—Ä–∞–≤—å —á–∏—Å–ª–æ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ */
.card.list-card.games{ margin-top: var(--gap-block); }

 </style>

 <style>
  /* ===== LEADERBOARD (Clicker) ===== */
.lb-card { padding:12px; }
.lb-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.lb-title{ font-weight:900; font-size:18px; }
.lb-sub{ opacity:.75; font-weight:600; font-size:12px; }

.lb-seg{
  display:inline-grid; grid-auto-flow:column; gap:6px; padding:4px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
}
.lb-seg button{
  height:30px; min-width:86px; padding:0 12px; border-radius:999px; border:0; cursor:pointer;
  font-weight:800; color:#fff; background:transparent;
}
.lb-seg button[aria-pressed="true"]{ background:#fff; color:#000; }

.lb-you{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:14px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  margin-bottom:10px;
}
.lb-you__avatar{
  width:36px; height:36px; border-radius:10px; background:#222; display:grid; place-items:center; font-weight:900;
}
.lb-you__name{ font-weight:800; }
.lb-you__score{ margin-left:auto; font-weight:900; }

.lb-list{ display:flex; flex-direction:column; gap:8px; }
.lb-row{
  display:grid; grid-template-columns:28px 36px 1fr auto; align-items:center; gap:10px;
  padding:10px 12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.03); border-radius:14px;
}
.lb-rank{ font-weight:900; opacity:.9; text-align:center; }
.lb-avatar{ width:36px; height:36px; border-radius:10px; background:#1b1c22; display:grid; place-items:center; font-weight:900; }
.lb-name{ font-weight:800; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.lb-score{ font-weight:900; }

.lb-medal-1 .lb-rank{ color:#ffd34d; }
.lb-medal-2 .lb-rank{ color:#cbd3ff; }
.lb-medal-3 .lb-rank{ color:#ffb27a; }

.lb-actions{ display:flex; gap:10px; margin-top:12px; }
.lb-btn{
  flex:1; height:42px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.06); color:#fff; font-weight:800; cursor:pointer;
}
.lb-btn--primary{ background:#fff; color:#000; border-color:#fff; }

@media (min-width:900px){
  #leaderboard .inner{ max-width: var(--appW, 428px); margin:0 auto; }
}

 </style>

 <style>
/* ===== TARGET POPPER v2 (overlay) ===== */
.popper{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.popper.is-open{ display:block; }
body.popper-open{ overflow:hidden; }

.popper__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* ENERGY (header) */
.pp-timer{ width:100%; max-width:520px; margin:0 auto 10px; }
.pp-timer__row{ display:grid; justify-items:center; gap:6px; }
.pp-timer__text{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.pp-timer__bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.pp-timer__bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* SCORE */
.pp-score{ align-self:center; display:flex; align-items:center; gap:12px; margin-bottom:6px; }
.pp-score__icon{ width:28px; height:28px; display:block; opacity:.9 }
#pp-score-val{
  font-weight:900; font-size: clamp(32px, 8vw, 56px);
  line-height:1; letter-spacing:.2px; text-shadow:0 2px 10px rgba(0,0,0,.25);
}

/* COMBO (—Å–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
.pp-combo{ display:none !important; position:absolute; top:10px; right:10px; z-index:2;
  align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12);
  font:800 13px/1 Inter,system-ui;
}
.pp-combo.show{ display:flex !important; }
.pp-combo__val{ font-weight:900; }
.pp-combo__mult{ opacity:.85; }

/* Stage */
.pp-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px; background:#07080b; }
.pp-stage__hint{ position:absolute; inset:auto 0 8px; text-align:center; opacity:.45; font:600 12px/1.1 Inter; pointer-events:none }

/* Targets */
.pp-target{
  position:absolute; border-radius:999px; cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,.25), rgba(255,255,255,.06));
  border:2px solid rgba(255,255,255,.28);
  box-shadow:0 10px 24px rgba(0,0,0,.35);
  transform:scale(.7); opacity:0; animation: pp-in .12s ease-out forwards;
}
.pp-target--gold{
  background: radial-gradient(circle at 35% 35%, rgba(255,230,100,.6), rgba(255,180,0,.18));
  border-color: rgba(255,210,90,.8);
  box-shadow: 0 10px 30px rgba(255,200,40,.45), inset 0 0 20px rgba(255,220,120,.35);
  animation: pp-in .12s ease-out forwards, gold-pulse 1.2s ease-in-out infinite;
}
@keyframes gold-pulse{ 0%,100%{ filter:none } 50%{ filter: drop-shadow(0 0 16px rgba(255,200,40,.55)); } }

@keyframes pp-in{ to{ transform:scale(1); opacity:1 } }
@keyframes pp-out{ to{ transform:scale(.6); opacity:0 } }

/* FX */
.pp-spark{
  position:absolute; pointer-events:none; font-weight:900; font-size:20px; color:#6be3ff;
  transform:translate(-50%,-50%); animation: pp-spark .7s ease-out forwards; text-shadow:0 0 10px rgba(107,227,255,.55);
}
.pp-spark--gold{ color:#ffdf6a; text-shadow:0 0 14px rgba(255,210,90,.8); }
.pp-spark--miss{ color:#ff7a7a; text-shadow:0 0 10px rgba(255,80,80,.55); }
@keyframes pp-spark{ 0%{opacity:1;transform:translate(-50%,-50%) scale(1)} 60%{opacity:.9;transform:translate(-50%,-110%) scale(1.05)} 100%{opacity:0;transform:translate(-50%,-170%) scale(.9)} }
.pp-ripple{
  position:absolute; width:14px; height:14px; border-radius:999px; border:2px solid rgba(255,255,255,.35);
  transform:translate(-50%,-50%); pointer-events:none; animation: pp-ripple .45s ease-out forwards;
}
@keyframes pp-ripple{ to{ width:120px; height:120px; opacity:0 } }

/* Result panel */
.pp-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.pp-result.show{ display:grid; }
.pp-result__card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.pp-result .score__cell{ display:grid; gap:4px; justify-items:center }
.pp-result .score__val{ font:800 20px/1 Inter }
.pp-result .score__sub{ font:600 12px/1.1 Inter; opacity:.8 }
.pp-result .score__chev{ font:20px/1 Inter; opacity:.6 }

/* CTA bottom */
:root{ --ctaGap: 44px; }
.pp-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.pp-cta.show{ display:block; }
.pp-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .popper__wrap{ max-width:var(--appW,428px); margin:0 auto } }



 </style>


<style>
/* ===== LANE RUNNER (overlay) ===== */
.runner{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.runner.is-open{ display:block; }
body.runner-open{ overflow:hidden; }

.runner__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.rn-hud{ width:100%; max-width:520px; margin:0 auto 10px; }
.rn-hud__row{ display:grid; justify-items:center; gap:6px; }
.rn-time{ font:800 16px/1 Inter,system-ui; letter-spacing:.4px; }
.rn-bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.rn-bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }
.rn-score{ align-self:center; display:flex; align-items:center; gap:10px; margin:6px 0 4px; }
.rn-score__val{ font:900 clamp(28px,8vw,48px)/1 Inter; text-shadow:0 2px 10px rgba(0,0,0,.25) }

/* Stage */
.rn-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px; background:#07080b; }
.rn-lane{ position:absolute; inset:0; pointer-events:none; }
.rn-lane:before,.rn-lane:after{
  content:""; position:absolute; top:0; bottom:0; width:1px; background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
}
.rn-lane:before{ left:33.333%; } .rn-lane:after{ left:66.666%; }

/* ===== Sprites (—Ä–∞–∑–º–µ—Ä—ã –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º) ===== */
:root{
  --player-w: 56px; --player-h: 96px;
  --obs-w: 56px;    --obs-h: 96px;
  --coin-w: 38px;   --coin-h: 38px;
}

.rn-player, .rn-obstacle, .rn-coin{
  position:absolute; transform:translate(-50%,-50%); user-select:none; -webkit-tap-highlight-color:transparent;
  image-rendering:auto; will-change: left, transform, top;
}

/* –ò–≥—Ä–æ–∫ ‚Äî –º–∞—à–∏–Ω–∞ */
.rn-player{
  width:var(--player-w); height:var(--player-h);
  background:center / contain no-repeat;
  transition: left 160ms cubic-bezier(.2,.7,.2,1);
}
/* –ü–æ–≤–æ—Ä–æ—Ç –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–æ–ª–æ—Å—ã: –∫–æ—Ä–æ—Ç–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ 0¬∞ */
.rn-player.tilt-left{ animation: rn-tilt-left 220ms ease-out; }
.rn-player.tilt-right{ animation: rn-tilt-right 220ms ease-out; }

@keyframes rn-tilt-left{
  0%{ transform:translate(-50%,-50%) rotate(0deg) }
  35%{ transform:translate(-50%,-50%) rotate(-8deg) }
  100%{ transform:translate(-50%,-50%) rotate(0deg) }
}
@keyframes rn-tilt-right{
  0%{ transform:translate(-50%,-50%) rotate(0deg) }
  35%{ transform:translate(-50%,-50%) rotate(8deg) }
  100%{ transform:translate(-50%,-50%) rotate(0deg) }
}

/* –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è ‚Äî –º–∞—à–∏–Ω—ã */
.rn-obstacle{
  width:var(--obs-w); height:var(--obs-h);
  background:center / contain no-repeat;
}

/* –ú–æ–Ω–µ—Ç–∫–∞ */
.rn-coin{
  width:var(--coin-w); height:var(--coin-h);
  background:center / contain no-repeat;
}

/* Result */
.rn-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.rn-result.show{ display:grid; }
.rn-card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.rn-cell{ display:grid; gap:4px; justify-items:center }
.rn-val{ font:800 20px/1 Inter } .rn-sub{ font:600 12px/1.1 Inter; opacity:.8 } .rn-chev{ font:20px/1 Inter; opacity:.6 }

/* CTA (safe-area) */
:root{ --ctaGap: 44px; }
.rn-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.rn-cta.show{ display:block; }
.rn-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .runner__wrap{ max-width:var(--appW,428px); margin:0 auto } }


</style>

<style>
/* ===== FLAPPY LITE+ (overlay) ===== */
.flappy{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.flappy.is-open{ display:block; }
body.flappy-open{ overflow:hidden; }

.flappy__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.fl-hud{ width:100%; max-width:520px; margin:0 auto 8px; }
.fl-hud__row{ display:grid; justify-items:center; gap:6px; }
.fl-score{ font:900 clamp(28px,8vw,48px)/1 Inter,system-ui; text-shadow:0 2px 10px rgba(0,0,0,.25) }
.fl-bar{ width:100%; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-bar>i{ display:block; height:100%; width:100%; background:#fff; transform-origin:left center; }

/* HUD: coins + shield */
.fl-stats{ display:flex; justify-content:center; gap:14px; margin-top:6px; }
.fl-stat{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); font:800 13px/1 Inter;
}
.fl-ico{ width:18px; height:18px; background:center/contain no-repeat; opacity:.95 }
#fl-coin-count{ font:800 14px/1 Inter }
.fl-shield-wrap{ display:flex; align-items:center; gap:8px; }
.fl-shield-bar{ width:88px; height:4px; border-radius:999px; background:rgba(255,255,255,.18); overflow:hidden }
.fl-shield-bar>i{ display:block; height:100%; width:100%; background:#6be3ff; transform-origin:left center; }

/* Stage */
.fl-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px;
  background: linear-gradient(180deg,#0a0c14 0%, #0f1626 100%);
}
.fl-hint{
  position:absolute; left:0; right:0; top:18%;
  text-align:center; font:800 16px/1.2 Inter; opacity:.75; pointer-events:none;
}

/* Sprites sizes (override via JS) */
:root{ --bird-w: 48px; --bird-h: 36px; --pipe-w: 76px; --coin-w: 32px; --coin-h: 32px; --pow-w: 34px; --pow-h: 34px; }

/* Bird */
.fl-bird{
  position:absolute; width:var(--bird-w); height:var(--bird-h); transform:translate(-50%,-50%) rotate(0deg);
  background: radial-gradient(circle at 35% 35%, #ffdd66, #ff9a00);
  border-radius:14px; box-shadow:0 8px 18px rgba(255,154,0,.35), inset 0 0 10px rgba(255,255,255,.25);
  will-change: transform, top, left;
}
.fl-bird--sprite{ background:center/contain no-repeat; border-radius:0; box-shadow:none; }
.fl-bird--shield{ box-shadow:0 0 0 3px rgba(107,227,255,.8), 0 0 30px rgba(107,227,255,.55); }

/* Pipes */
.fl-pipe-part{
  position:absolute; width:var(--pipe-w);
  background: linear-gradient(180deg,#6BFF7A,#1ED760);
  border:1px solid rgba(255,255,255,.08); box-shadow:0 10px 22px rgba(30,215,96,.25), inset 0 0 10px rgba(255,255,255,.15);
}
.fl-pipe--sprite{ background: center / 100% 100% no-repeat; border:none; box-shadow:none; }

/* Items: coin & shield power-up */
.fl-coin,.fl-power{
  position:absolute; transform:translate(-50%,-50%); will-change: left, top;
  width:var(--coin-w); height:var(--coin-h); background:center/contain no-repeat;
}
.fl-power{ width:var(--pow-w); height:var(--pow-h); }

/* Result */
.fl-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.fl-result.show{ display:grid; }
.fl-card{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr auto; gap:14px; align-items:center;
}
.fl-cell{ display:grid; gap:4px; justify-items:center }
.fl-val{ font:800 20px/1 Inter } .fl-sub{ font:600 12px/1.1 Inter; opacity:.8 } .fl-chev{ font:20px/1 Inter; opacity:.6 }

/* CTA bottom (safe-area) */
:root{ --ctaGap: 44px; }
.fl-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); display:none; }
.fl-cta.show{ display:block; }
.fl-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .flappy__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* === –¢–Æ–ù–ò–ù–ì –©–ò–¢–ê –ò –†–ê–î–ò–£–°–û–í === */
:root{
  --bird-radius: 27px;                 /* —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –ø—Ç–∏—á–∫–∏ (–≤ —Ç.—á. —Å–æ —Å–ø—Ä–∞–π—Ç–æ–º) */
  --shield-ring: 1px;                  /* —Ç–æ–ª—â–∏–Ω–∞ ¬´–∫–æ–ª—å—Ü–∞¬ª —â–∏—Ç–∞ */
  --shield-ring-color: rgba(107,227,255,.95);
  --shield-glow-color: rgba(107,227,255,.55);
  --shield-glow-blur: 28px;            /* —Å–∏–ª–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–≤–µ—á–µ–Ω–∏—è */
  --shield-pulse: 1.6s;                /* —Å–∫–æ—Ä–æ—Å—Ç—å –ø—É–ª—å—Å–∞ –∞—É—Ä—ã */
}

/* –ø—Ç–∏—á–∫–∞ –≤—Å–µ–≥–¥–∞ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é */
.fl-bird{ border-radius: var(--bird-radius); }

/* –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–ø—Ä–∞–π—Ç ‚Äî –ù–ï –æ–±–Ω—É–ª—è–µ–º —Ä–∞–¥–∏—É—Å, –ø—É—Å—Ç—å –±–µ—Ä—ë—Ç var(--bird-radius) */
.fl-bird--sprite{ border-radius: var(--bird-radius); }

/* –∞–∫—Ç–∏–≤–Ω—ã–π —â–∏—Ç: –∫–æ–ª—å—Ü–æ + –≤–Ω–µ—à–Ω—è—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ + –º—è–≥–∫–∏–π –ø—É–ª—å—Å */
.fl-bird--shield{
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  position: relative;
}
.fl-bird--shield::after{
  content:"";
  position:absolute; inset: calc(-1*var(--shield-ring));
  border-radius: inherit;
  border: var(--shield-ring) solid var(--shield-ring-color);
  box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color);
  animation: shieldPulse var(--shield-pulse) ease-in-out infinite;
  pointer-events: none;
}

@keyframes shieldPulse{
  0%  { box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,.35); }
  60% { box-shadow: 0 0 calc(var(--shield-glow-blur)*1.2) var(--shield-glow-color), 0 0 0 10px rgba(107,227,255,0); }
  100%{ box-shadow: 0 0 var(--shield-glow-blur) var(--shield-glow-color), 0 0 0 0 rgba(107,227,255,0); }
}


</style>

 <style>
  /* ===== MEMORY PAIRS (overlay) ===== */
.pairs{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.pairs.is-open{ display:block; }
body.pairs-open{ overflow:hidden; }

.pairs__wrap{
  position:absolute; inset:0; display:flex; flex-direction:column;
  padding: calc(env(safe-area-inset-top,0px)+8px) 14px calc(env(safe-area-inset-bottom,0px)+14px);
}

/* HUD */
.mp-hud{ width:100%; max-width:520px; margin:0 auto 10px; }
.mp-stats{ display:flex; justify-content:center; gap:12px; }
.mp-pill{
  padding:6px 10px; border-radius:999px;
  background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1);
  font:800 13px/1 Inter,system-ui; letter-spacing:.2px; display:flex; gap:6px; align-items:center
}
.mp-val{ font-weight:900; }

/* Stage */
.mp-stage{ flex:1; display:grid; place-items:center; }
.mp-grid{
  width:100%; max-width:520px;
  display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;
}

/* Card */
:root{
  --card-r: 14px;
  --card-back: rgba(255,255,255,.06);
}
.mp-card{
  position:relative; width:100%; aspect-ratio: 3/4;
  border:none; background:none; padding:0; cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  perspective: 800px;
}
.mp-card[disabled]{ pointer-events:none; }

.mp-in{
  position:absolute; inset:0; border-radius:var(--card-r);
  transform-style:preserve-3d; transition: transform .28s cubic-bezier(.2,.7,.2,1);
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
}
.mp-card.is-flipped .mp-in{ transform: rotateY(180deg); }

.mp-face{
  position:absolute; inset:0; display:grid; place-items:center; border-radius:var(--card-r);
  backface-visibility:hidden;
}

/* back */
.mp-face--back{
  background:var(--card-back);
  border:1px solid rgba(255,255,255,.10);
}
/* front (—ç–º–æ–¥–∑–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
.mp-face--front{
  transform: rotateY(180deg);
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.18);
  font: 900 clamp(28px,7vw,42px)/1.1 Inter;
  text-shadow: 0 2px 10px rgba(0,0,0,.25);
}
/* –∫–æ–≥–¥–∞ —Ñ—Ä–æ–Ω—Ç ‚Äî –∫–∞—Ä—Ç–∏–Ω–∫–∞ */
.mp-front-img{
  background: center / 80% no-repeat, rgba(255,255,255,.12);
  font-size:0;
}

/* matched / wrong FX */
.mp-card.is-matched .mp-in{
  box-shadow: 0 0 0 2px rgba(107,227,255,.9), 0 0 22px rgba(107,227,255,.45);
}
@keyframes mp-shake{
  0%{ transform: translateX(0) }
  25%{ transform: translateX(-6px) }
  50%{ transform: translateX(6px) }
  75%{ transform: translateX(-3px) }
  100%{ transform: translateX(0) }
}
.mp-card.is-wrong .mp-in{ animation: mp-shake .28s ease-out }

/* Result */
.mp-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.mp-result.show{ display:grid; }
.mp-card-res{
  width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr; gap:14px; align-items:center;
}
.mp-cell{ display:grid; gap:4px; justify-items:center }
.mp-title{ grid-column:1/-1; text-align:center; font:800 16px/1.2 Inter; opacity:.9 }

/* CTA */
:root{ --ctaGap: 44px; }
.mp-cta{ position:absolute; left:14px; right:14px; bottom: calc(env(safe-area-inset-bottom,0px)+var(--ctaGap)); display:none; }
.mp-cta.show{ display:block; }
.mp-cta .btn{ width:100%; height:52px; border-radius:16px; font:800 16px/1 Inter; background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .pairs__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* ‚Äî‚Äî‚Äî –æ–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî‚Äî‚Äî */
:root{
  --edgePad: 18px;            /* –æ—Ç—Å—Ç—É–ø—ã —Å–ª–µ–≤–∞/—Å–ø—Ä–∞–≤–∞ –¥–ª—è —Å—Ü–µ–Ω—ã */
  --gridGap: 12px;            /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ */
  --ctaH: 52px;               /* –≤—ã—Å–æ—Ç–∞ –∫–Ω–æ–ø–∫–∏ */
  --ctaGap: 44px;             /* –∑–∞–∑–æ—Ä –æ—Ç –Ω–∏–∂–Ω–µ–π ¬´–ø–∞–ª–æ—á–∫–∏¬ª */
}

/* –æ–±—ë—Ä—Ç–∫–∞ –¥–µ–ª–∞–µ—Ç ‚Äú–æ–ø–æ—Ä–æ–π‚Äù –¥–ª—è –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.pairs__wrap{
  position: relative; /* –±—ã–ª–æ absolute/inset:0 ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ */
  inset: 0;
  display: flex; flex-direction: column;
  padding: calc(env(safe-area-inset-top,0px) + 8px)
           var(--edgePad)
           /* —Ä–µ–∑–µ—Ä–≤ –ø–æ–¥ CTA, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –∑–∞—Ö–æ–¥–∏–ª –∑–∞ –∫–Ω–æ–ø–∫—É */
           calc(env(safe-area-inset-bottom,0px) + var(--ctaH) + var(--ctaGap) + 8px);
}

/* —Å—Ü–µ–Ω–∞ + —Å–µ—Ç–∫–∞ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –ø–æ –∫—Ä–∞—è–º */
.mp-stage{ flex:1; display:grid; place-items:center; }
.mp-grid{
  width:100%; max-width:520px;
  display:grid; grid-template-columns: repeat(3, 1fr);
  gap: var(--gridGap);
}

/* CTA –≤—Å–µ–≥–¥–∞ —É –Ω–∏–∂–Ω–µ–π –∫—Ä–æ–º–∫–∏ —Å —É—á—ë—Ç–æ–º safe-area */
.mp-cta{
  position: absolute;                 /* –ø—Ä–∏–≤—è–∑–∞–Ω–æ –∫ .pairs__wrap */
  left: var(--edgePad); right: var(--edgePad);
  bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap));
  display:none; z-index: 5;
}
.mp-cta.show{ display:block; }

.mp-cta{ position:fixed; left:14px; right:14px;
         bottom: calc(env(safe-area-inset-bottom,0px) + var(--ctaGap)); }


 </style>

 <style>
  /* ===== FLICK COIN (overlay) ===== */
.flick{ position:fixed; inset:0; z-index:10060; background:#000; color:#fff; display:none; }
.flick.is-open{ display:block; }
body.flick-open{ overflow:hidden; }

.flick__wrap{
  position:relative; inset:0; display:flex; flex-direction:column;
  --edgePad: 18px; --ctaGap: 44px; --ctaH: 52px;
  padding: calc(env(safe-area-inset-top,0px)+8px)
           var(--edgePad)
           calc(env(safe-area-inset-bottom,0px)+var(--ctaGap)+var(--ctaH)+8px);
}

/* HUD */
.fk-hud{ width:100%; max-width:520px; margin:0 auto 8px; display:grid; gap:8px; }
.fk-stats{ display:flex; justify-content:center; gap:12px; }
.fk-pill{ padding:6px 10px; border-radius:999px; background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.1); font:800 13px/1 Inter; letter-spacing:.2px; display:flex; gap:6px; align-items:center; }
.fk-powers{ display:flex; justify-content:center; gap:10px; }
.fk-power{ height:36px; padding:0 12px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06); color:#fff; font:800 12px/1 Inter; }
.fk-power.is-on{ box-shadow:0 0 18px rgba(100,220,255,.45), inset 0 0 0 2px rgba(100,220,255,.9); }

/* Stage */
.fk-stage{ flex:1; position:relative; overflow:hidden; border-radius:16px;
  background: radial-gradient(120% 100% at 50% 0%, #0e1524 0%, #0a0c14 60%, #07080b 100%);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
}

/* Holes */
.fk-hole{ position:absolute; width:84px; height:84px; border-radius:50%;
  display:grid; place-items:center; }
.fk-hole__ring{ position:absolute; inset:-8px; border-radius:50%;
  box-shadow:0 0 0 2px rgba(107,227,255,.9), 0 0 22px rgba(107,227,255,.45); }
.fk-hole__core{ width:70%; height:70%; border-radius:50%;
  background: radial-gradient(circle at 35% 35%, #0b0f18, #000); box-shadow: inset 0 6px 14px rgba(0,0,0,.75); }
.fk-hole__lbl{ position:absolute; top:-20px; font:800 12px/1 Inter; opacity:.85; }

/* Coin */
.fk-coin{ position:absolute; width:56px; height:56px; border-radius:50%;
  background: radial-gradient(circle at 35% 35%, #ffe28a, #ffac33);
  box-shadow:0 8px 18px rgba(255,172,51,.35), inset 0 0 12px rgba(255,255,255,.35);
  transform:translate(-50%,-50%); will-change: transform, left, top; }
.fk-coin.is-aim{ outline:2px dashed rgba(255,255,255,.35); outline-offset:6px; }

/* Bumpers */
.fk-bumper{ position:absolute; width:90px; height:14px; border-radius:999px;
  background:linear-gradient(90deg, #00d2ff, #3a7bd5);
  box-shadow:0 12px 22px rgba(0, 150, 255, .25), inset 0 0 10px rgba(255,255,255,.25); }

/* Guide path */
.fk-guide{ position:absolute; inset:0; pointer-events:none; }
.fk-guide svg{ width:100%; height:100%; }
.fk-guide polyline{ fill:none; stroke:rgba(255,255,255,.7); stroke-width:2; stroke-dasharray:4 6; }

/* Result */
.fk-result{ position:absolute; inset:0; display:none; place-items:center; padding:16px; }
.fk-result.show{ display:grid; }
.fk-card{ width:min(100%,520px); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10);
  border-radius:18px; padding:12px 16px; display:grid; grid-template-columns:1fr 1fr; gap:14px; align-items:center; }
.fk-title{ grid-column:1/-1; text-align:center; font:800 16px/1.2 Inter; opacity:.9 }
.fk-cell{ display:grid; gap:4px; justify-items:center }
.fk-val{ font:800 20px/1 Inter }

/* CTA */
.fk-cta{ position:absolute; left:var(--edgePad); right:var(--edgePad);
  bottom:calc(env(safe-area-inset-bottom,0px)+var(--ctaGap)); display:none; }
.fk-cta.show{ display:block; }
.fk-cta .btn{ width:100%; height:var(--ctaH); border-radius:16px; font:800 16px/1 Inter;
  background:#fff; color:#000; border:1px solid #fff; }

@media (min-width:900px){ .flick__wrap{ max-width:var(--appW,428px); margin:0 auto } }

/* —Å–¥–µ–ª–∞–µ–º –∫–æ–ª—å—Ü–æ/–ª–µ–π–±–ª —Ö–æ—Ä–æ—à–æ –≤–∏–¥–∏–º—ã–º–∏ */
.fk-hole__ring{
  box-shadow:
    0 0 0 2px rgba(0,200,255,.95),
    0 0 28px rgba(0,200,255,.55),
    inset 0 0 18px rgba(0,200,255,.35);
}
.fk-hole__lbl{ color:#7de2ff; text-shadow:0 2px 10px rgba(0,0,0,.5); }


 </style>

</head>
<body>
  <div class="wrap">
    <nav id="btm-nav" class="btm-nav" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <button class="tab" data-page="home"><img src="ic_home.png" alt=""><span>–ì–ª–∞–≤–Ω–∞—è</span></button>
      <button class="tab" data-page="leaderboard"><img src="ic_services.png" alt=""><span>–¢—É—Ä–Ω–∏—Ä</span></button>
      <button class="tab" data-page="consult"><img src="ic_consult.png" alt=""><span>–ó–∞–ø–∏—Å—å</span></button>
      <button class="tab" data-page="bonuses"><img src="ic_bonus.png" alt=""><span>–ë–æ–Ω—É—Å—ã</span></button>
      <button class="tab" data-page="popper"><img src="ic_about.png" alt=""><span>–û–±–æ –º–Ω–µ</span></button>
    </nav>

    <main>

      <!-- FLICK COIN (overlay) -->
<div id="flick" class="flick" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="flick__wrap">
    <!-- HUD -->
    <div class="fk-hud">
      <div class="fk-stats">
        <div class="fk-pill">Score <span id="fk-score" class="fk-val">0</span></div>
        <div class="fk-pill">Shots <span id="fk-shots" class="fk-val">0/5</span></div>
      </div>
      <div class="fk-powers">
        <button class="fk-power" data-power="guide">üéØ Guide</button>
        <button class="fk-power" data-power="magnet">üß≤ Magnet</button>
      </div>
    </div>

    <!-- STAGE -->
    <div id="fk-stage" class="fk-stage">
      <div class="fk-guide"><svg viewBox="0 0 100 100" preserveAspectRatio="none"><polyline id="fk-poly" points=""/></svg></div>
      <div id="fk-coin" class="fk-coin" aria-label="coin"></div>

      <!-- RESULT -->
      <div id="fk-result" class="fk-result" aria-hidden="true">
        <div class="fk-card">
          <div class="fk-title">Round finished</div>
          <div class="fk-cell"><div class="fk-val" id="fk-best">0</div><div>best</div></div>
          <div class="fk-cell"><div class="fk-val" id="fk-total">0</div><div>your score</div></div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="fk-cta" class="fk-cta">
      <button class="btn" data-close-flick>Play again</button>
    </div>
  </div>
</div>




      <!-- MEMORY PAIRS (overlay) -->
<div id="pairs" class="pairs" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="pairs__wrap">
    <!-- HUD -->
    <div class="mp-hud">
      <div class="mp-stats">
        <div class="mp-pill">Time <span id="mp-time" class="mp-val">00:00.0</span></div>
        <div class="mp-pill">Moves <span id="mp-moves" class="mp-val">0</span></div>
      </div>
    </div>

    <!-- STAGE -->
    <div class="mp-stage">
      <div id="mp-grid" class="mp-grid" aria-label="memory grid"></div>

      <!-- RESULT -->
      <div id="mp-result" class="mp-result" aria-hidden="true">
        <div class="mp-card-res">
          <div class="mp-title">Completed!</div>
          <div class="mp-cell">
            <div class="mp-val" id="mp-your-time">00:00.0</div>
            <div class="mp-sub">your time</div>
          </div>
          <div class="mp-cell">
            <div class="mp-val" id="mp-best-time">00:00.0</div>
            <div class="mp-sub">best time</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="mp-cta" class="mp-cta">
      <button class="btn" data-close-pairs>Play again</button>
    </div>
  </div>
</div>




      <!-- FLAPPY LITE (overlay) -->
<!-- FLAPPY LITE+ (overlay) -->
<div id="flappy" class="flappy" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="flappy__wrap">
    <!-- HUD -->
    <div class="fl-hud">
      <div class="fl-hud__row">
        <div id="fl-score" class="fl-score">0</div>
        <div class="fl-bar"><i id="fl-bar"></i></div>
      </div>
      <div class="fl-stats">
        <div class="fl-stat">
          <i id="fl-coin-ico" class="fl-ico"></i>
          <span id="fl-coin-count">0</span>
        </div>
        <div class="fl-stat fl-shield-wrap">
          <i id="fl-shield-ico" class="fl-ico"></i>
          <div class="fl-shield-bar"><i id="fl-shield-bar"></i></div>
        </div>
      </div>
    </div>

    <!-- STAGE -->
    <div id="fl-stage" class="fl-stage">
      <div id="fl-hint" class="fl-hint">tap to fly</div>
      <div id="fl-bird" class="fl-bird" aria-label="bird"></div>

      <!-- RESULT -->
      <div id="fl-result" class="fl-result" aria-hidden="true">
        <div class="fl-card">
          <div class="fl-cell"><div class="fl-val" id="fl-best">0</div><div class="fl-sub">your best</div></div>
          <div class="fl-cell"><div class="fl-val" id="fl-world">200</div><div class="fl-sub">world record</div></div>
          <div class="fl-chev">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="fl-cta" class="fl-cta">
      <button class="btn" data-close-flappy>Play again</button>
    </div>
  </div>
</div>







<!-- LANE RUNNER (overlay) -->
<div id="runner" class="runner" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="runner__wrap">
    <!-- HUD -->
    <div class="rn-hud">
      <div class="rn-hud__row">
        <div id="rn-time" class="rn-time">00:45</div>
        <div class="rn-bar"><i id="rn-bar"></i></div>
      </div>
    </div>
    <div class="rn-score">Score <span id="rn-score-val" class="rn-score__val">0</span></div>

    <!-- STAGE -->
    <div id="rn-stage" class="rn-stage">
      <div class="rn-lane"></div>
      <div id="rn-player" class="rn-player" aria-label="player"></div>

      <!-- RESULT -->
      <div id="rn-result" class="rn-result" aria-hidden="true">
        <div class="rn-card">
          <div class="rn-cell">
            <div class="rn-val" id="rn-best">0</div>
            <div class="rn-sub">your best</div>
          </div>
          <div class="rn-cell">
            <div class="rn-val" id="rn-world">5000</div>
            <div class="rn-sub">world record</div>
          </div>
          <div class="rn-chev">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="rn-cta" class="rn-cta">
      <button class="btn" data-close-runner>Play again</button>
    </div>
  </div>
</div>





<!-- TARGET POPPER v2 (overlay) -->
<!-- TARGET POPPER v2 (overlay) -->
<div id="popper" class="popper" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="popper__wrap">
    <!-- ENERGY -->
    <div class="pp-timer">
      <div class="pp-timer__row">
        <div id="pp-timer-text" class="pp-timer__text">Energy 100%</div>
        <div class="pp-timer__bar"><i id="pp-timer-bar"></i></div>
      </div>
    </div>

    <!-- SCORE -->
    <div class="pp-score">
      <img class="pp-score__icon" src="ic_about.png" onerror="this.style.display='none'" alt="">
      <span id="pp-score-val">0</span>
    </div>

    <!-- STAGE -->
    <div id="pp-stage" class="pp-stage">
      <!-- combo ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—É—Å—Ç–æ -->
      <div class="pp-combo" id="pp-combo">
        <span class="pp-combo__val" id="pp-combo-val"></span>
        <span class="pp-combo__mult" id="pp-combo-note"></span>
      </div>

      

      <!-- RESULT -->
      <div id="pp-result" class="pp-result" aria-hidden="true">
        <div class="pp-result__card">
          <div class="score__cell">
            <div class="score__val" id="pp-best">0</div>
            <div class="score__sub">your best</div>
          </div>
          <div class="score__cell">
            <div class="score__val" id="pp-world">120</div>
            <div class="score__sub">world record</div>
          </div>
          <div class="score__chev">‚Ä∫</div>
        </div>
      </div>
    </div>

    <!-- CTA -->
    <div id="pp-cta" class="pp-cta">
      <button class="btn" data-close-popper>Close</button>
    </div>
  </div>
</div>










<!-- FULLSCREEN CLICKER –∫–ª–∏–∫–µ—Ä-->
<div id="clicker" class="clicker" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="clicker__wrap">
    <!-- TIMER -->
    <div class="timer">
      <div class="timer__row">
        <div id="timer-text" class="timer__text">01:00</div>
        <div class="timer__bar"><i id="timer-bar"></i></div>
      </div>
    </div>

    <!-- COUNTER (–∏–∫–æ–Ω–∫–∞ + —á–∏—Å–ª–æ –ë–ï–ó —Ä–∞–º–æ–∫/–ø–ª–∞—à–µ–∫; —Ä–∞–∑–º–µ—Ä —É–ø—Ä–∞–≤–ª—è–µ—Ç CSS) -->
    <div id="clicker-counter" class="clicker__counter">
      <img class="counter__mini" src="sales_genius_aibot.png" alt="">
      <span id="counter-val">0</span>
    </div>

    <!-- –°–¶–ï–ù–ê: –∫–ª–∏–∫–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ IMG -->
    <div id="clicker-stage" class="clicker__stage">
      <img class="clicker__img" src="sales_genius_aibot.png" alt="Click target">

      <!-- –ü–ê–ù–ï–õ–¨ –°–ß–Å–¢–ê (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–º–µ—Å—Ç–æ IMG –ø–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞) -->
      <div id="clicker-score" class="clicker__score" aria-hidden="true">
        <div class="score__cell">
          <div class="score__val" id="score-best">0</div>
          <div class="score__sub">your best</div>
        </div>
        <div class="score__cell">
          <div class="score__val" id="score-world">93</div>
          <div class="score__sub">world record</div>
        </div>
        <div class="score__chev">‚Ä∫</div>
      </div>
    </div>

    <!-- CTA —Å–Ω–∏–∑—É (—É—á–∏—Ç—ã–≤–∞–µ—Ç safe-area –∏ —Ç–≤–æ–π –∑–∞–∑–æ—Ä —á–µ—Ä–µ–∑ CSS) -->
    <div id="clicker-cta" class="clicker__cta">
      <button class="btn" data-close-clicker>Try Again Tomorrow</button>
    </div>
  </div>
</div>








      <div id="sheet" class="sheet sheet-bottom" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sheet__overlay" data-close-sheet></div>
        <section class="sheet__panel" tabindex="-1">
          <div class="sheet__handle"></div>
          <header class="sheet__header">
            <h3 class="sheet__title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h3>
            <button class="sheet__close" aria-label="–ó–∞–∫—Ä—ã—Ç—å" data-close-sheet>‚úï</button>
          </header>
          <div class="sheet__body" id="sheet-body"></div>
        </section>
      </div>

      <template id="tpl-example">
        <div class="card">
          <div class="h1">–î–µ–º–æ‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü–∞</div>
          <p class="muted-sm">–õ—é–±–æ–π HTML –≤–Ω—É—Ç—Ä—å: —Ñ–æ—Ä–º—ã, –∫–∞—Ä—Ç–æ—á–∫–∏, —Ç–∞–±–ª–∏—Ü—ã‚Ä¶</p>
        </div>
      </template>

<section class="page" id="home">
  <!-- HERO (gif/mp4) -->
  <div class="hero">
    <!-- GIF: -->
    <img class="hero__media" src="demo.gif" alt="Hero">
    <!-- –ï—Å–ª–∏ —Ç—è–∂—ë–ª—ã–π GIF, –∑–∞–º–µ–Ω–∏ –Ω–∞ mp4 (—Ç–æ—Ç –∂–µ –∫–ª–∞—Å—Å):
    <video class="hero__media" autoplay muted loop playsinline preload="metadata">
      <source src="assets/hero.mp4" type="video/mp4">
    </video>
    -->
  </div>

  <!-- –ü—Ä–æ–º–æ-–ø–ª–∞—à–∫–∞ -->
  <div class="promo">
    <div class="promo__icon">
      <img src="ic_about.png" alt="">
    </div>
    <div>
      <div class="promo__title">Halloween Clicker</div>
      <div class="promo__sub">Play now</div>
    </div>
<button class="promo__btn" data-open-clicker>Clicker</button>
  </div>

  <!-- Start here -->
  <div class="card list-card tight">
    <div class="list-head">Start here</div>
    <div class="list">
      <div class="list__item">
        <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">What is Notcoin?</div>
          <div class="list__sub">Intro</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="What is Notcoin?"
                data-tpl="#tpl-example"
                aria-label="–û—Ç–∫—Ä—ã—Ç—å">
          ‚Ä∫
        </button>
      </div>

<div class="list__item">
  <div class="list__icon"><img src="ic_services.png" alt=""></div>
  <div class="list__text">
    <div class="list__title">Get $NOT</div>
    <div class="list__sub">Swap cash or crypto to $NOT</div>
  </div>

  <!-- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–Ω—Ç—Ä–æ-—Å–ª–∞–π–¥–µ—Ä -->
  <button class="list__chev-btn"
          data-open-intro
          aria-controls="intro"
          aria-label="–û—Ç–∫—Ä—ã—Ç—å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥">
    ‚Ä∫
  </button>
</div>

      <div class="list__item">
        <div class="list__icon"><img src="ic_about.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">Whitepaper</div>
          <div class="list__sub">Literally</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="Whitepaper"
                data-tpl="#tpl-example"
                aria-label="–û—Ç–∫—Ä—ã—Ç—å">
          ‚Ä∫
        </button>
      </div>
    </div>
  </div>

  

  <!-- Games -->
<div class="card list-card games tight">
  <div class="list-head">Games</div>
  <div class="list">
    <!-- –ë–æ–Ω—É—Å—ã -->
    <div class="list__item">
      <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Daily bonus</div>
        <div class="list__sub">–ó–∞–±–µ—Ä–∏ –ø–æ–¥–∞—Ä–æ–∫ —Å–µ–≥–æ–¥–Ω—è</div>
      </div>
<!-- –ü—Ä–∏–º–µ—Ä –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary"
        data-open-popper
        data-cooldown-hours="24"
        data-game-key="popper">
  Play
</button>
    </div>

    <!-- –ö–ª–∏–∫–µ—Ä -->
    <div class="list__item">
      <div class="list__icon"><img src="sales_genius_aibot.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Clicker</div>
        <div class="list__sub">1-minute challenge</div>
      </div>
      <!-- –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∏–∫–µ—Ä-–æ–≤–µ—Ä–ª–µ–π (+ –¥–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç –∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏: 24—á) -->
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-runner>Lane</button>
    </div>

       

    <!-- –ö–ª–∏–∫–µ—Ä -->
    <div class="list__item">
      <div class="list__icon"><img src="sales_genius_aibot.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Clicker</div>
        <div class="list__sub">1-minute challenge</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-pairs>Pairs</button>
    </div>

        <!-- –ö–ª–∏–∫–µ—Ä -->
    <div class="list__item">
      <div class="list__icon"><img src="sales_genius_aibot.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Clicker</div>
        <div class="list__sub">1-minute challenge</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-flick>Coin</button>
    </div>


    <!-- –ë–æ–Ω—É—Å—ã -->
    <div class="list__item">
      <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
      <div class="list__text">
        <div class="list__title">Daily bonus</div>
        <div class="list__sub">–ó–∞–±–µ—Ä–∏ –ø–æ–¥–∞—Ä–æ–∫ —Å–µ–≥–æ–¥–Ω—è</div>
      </div>
<!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π -->
<button class="list__btn list__btn--primary" data-open-flappy>Flappy</button>
    </div>
      </div>
</div>

</section>




<!-- –õ–ò–î–ï–† –ë–û–†–î -->


<section id="leaderboard" class="page" style="display:none">
    <div class="promo">
    <div class="promo__icon">
      <img src="ic_about.png" alt="">
    </div>
    <div>
      <div class="promo__title">Halloween Clicker</div>
      <div class="promo__sub">Play now</div>
    </div>
<button class="promo__btn" data-open-clicker>Clicker</button>
  </div>


  <div class="card lb-card inner">
    <div class="lb-head">
      <div>
        <div class="lb-title">Leaderboard</div>
        <div class="lb-sub">Clicker ¬∑ daily & all-time</div>
      </div>
      <div class="lb-seg" role="tablist" aria-label="Leaderboard period">
        <button type="button" class="js-lb-mode" data-mode="daily" aria-pressed="true">Daily</button>
        <button type="button" class="js-lb-mode" data-mode="all">All-time</button>
      </div>
    </div>

    <!-- –¢—ã -->
    <div class="lb-you" id="lb-you">
      <div class="lb-you__avatar" id="lb-you-ava">YOU</div>
      <div class="lb-you__meta">
        <div class="lb-you__name" id="lb-you-name">You</div>
        <div class="lb-sub" id="lb-you-note">best score</div>
      </div>
      <div class="lb-you__score" id="lb-you-score">0</div>
    </div>

    <!-- –¢–æ–ø -->
    <div class="lb-list" id="lb-list">
      <!-- —Å—é–¥–∞ JS —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å—Ç—Ä–æ–∫–∏ -->
    </div>

    <div class="lb-actions">
      <button class="lb-btn" id="lb-refresh" type="button">Refresh</button>
      <button class="lb-btn lb-btn--primary" type="button"
              data-open-clicker data-cooldown-hours="24" data-clicker-key="pumpkin">Play</button>
    </div>
  </div>
</section>


      <section class="page" id="services">
        <div class="card page-title">
          <div class="h1">–£—Å–ª—É–≥–∏</div>
          <p class="muted-sm">–¢–∞—Ä–∏—Ñ—ã, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ—Å—è—Ü/–≥–æ–¥ –∏ —Ç.–¥.</p>
          <button class="btn" data-open-sheet data-title="–ü—Ä–∞–π—Å" data-tpl="#tpl-example" data-from="bottom">–ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∞–π—Å</button>
        </div>


      </section>

      <section class="page" id="consult">
        <div class="card page-title">
          <div class="h1">–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</div>
          <button class="btn btn-primary" data-open-sheet data-title="–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ" data-tpl="#tpl-example" data-from="bottom">–û—Ç–∫—Ä—ã—Ç—å —Å–Ω–∏–∑—É</button>
        </div>
      </section>

      <section class="page" id="bonuses">
        <div class="card page-title">
          <div class="h1">–ë–æ–Ω—É—Å—ã</div>
        </div>
      </section>

      <section class="page" id="about">
        <div class="card page-title">
          <div class="h1">–û–±–æ –º–Ω–µ</div>
        </div>
      </section>

      <!-- FULLSCREEN INTRO -->
<!-- FULLSCREEN INTRO -->
<div id="intro" class="intro" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="intro__wrap">
    <div class="intro__progress" id="intro-progress"></div>

    <div class="intro__stage">
      <div class="intro__slides" id="intro-slides">
        <!-- 1 -->
        <section class="intro__slide active">
          <h2 class="intro__h1">Welcome fren</h2>
          <p class="intro__p">–ö–æ—Ä–æ—Ç–∫–∏–π —Ç–∏–∑–µ—Ä, —á–µ–º –ø–æ–ª–µ–∑–µ–Ω –º–∏–Ω–∏-–∞–ø–ø.</p>
        </section>
        <!-- 2 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–í–æ–ø—Ä–æ—Å</h2>
          <p class="intro__p">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–µ–π—á–∞—Å?</p>
        </section>

        <!-- 3 -->
        <section class="intro__slide">
          <h2 class="intro__h1">–ü–æ–≥–Ω–∞–ª–∏!</h2>
          <p class="intro__p">–ü–æ—Å–ª–µ–¥–Ω–∏–π —à—Ç—Ä–∏—Ö ‚Äî –∏ –Ω–∞—á–Ω—ë–º.</p>
        </section>
      </div>
    </div>

    <!-- —Å—é–¥–∞ JS –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å –Ω—É–∂–Ω—ã–π –Ω–∞–±–æ—Ä –∫–Ω–æ–ø–æ–∫ -->
    <div id="intro-actions" class="intro__actions"></div>
  </div>
</div>


    </main>
  </div>

  <script>
  (function app(){
    const TG = window.Telegram && window.Telegram.WebApp;

    if (TG){
      try{
        TG.ready();
        TG.expand();
        TG.disableVerticalSwipes?.();
        TG.enableClosingConfirmation?.();
        TG.onEvent?.('viewportChanged', () => TG.disableVerticalSwipes?.());
      }catch(e){ console.warn('TG init error', e); }
    }

    const ROOT = 'home';
    const sheetRoot = document.getElementById('sheet');
    const sheetPanel= sheetRoot?.querySelector('.sheet__panel');
    const sheetBody = document.getElementById('sheet-body');
    const sheetTitle= sheetRoot?.querySelector('.sheet__title');

    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const isInDOM = id => !!document.getElementById(id);

    function currentId(){
      const url = new URL(location.href);
      const qp = (url.searchParams.get('page') || '').trim();
      if (qp && isInDOM(qp)) return qp;
      const h = (location.hash || '#'+ROOT).replace(/^#/, '');
      return isInDOM(h) ? h : ROOT;
    }

    function setActivePage(id){
      qsa('main > section, section.page').forEach(s => {
        const on = (s.id === id);
        s.classList.toggle('active', on);
        s.style.display = on ? 'block' : 'none';
      });
      qsa('[data-page]').forEach(t => t.classList.toggle('active', t.dataset.page === id));
      requestAnimationFrame(()=> window.scrollTo({ top: 0, behavior:'auto' }));
      syncBack();
    }

    function navigateTo(id){
      if (!id || !isInDOM(id)) return;
      const h = '#'+id;
      if (h !== (location.hash || '#'+ROOT)){ history.pushState({id}, '', h); }
      setActivePage(id);
    }

    function showBack(){ try{ TG?.BackButton?.show && TG.BackButton.show(); }catch(_){ } }
    function hideBack(){ try{ TG?.BackButton?.hide && TG.BackButton.hide(); }catch(_){ } }
    function syncBack(){
      if (!TG) return;
      const atRoot = (currentId() === ROOT);
      const sheetOpen = sheetRoot?.classList.contains('is-open');
      if (sheetOpen || !atRoot) showBack(); else hideBack();
    }

    TG?.BackButton?.onClick?.(()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });
    TG?.onEvent?.('backButtonClicked', ()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });

    window.addEventListener('popstate', ()=> setActivePage(currentId()));

    function haptic(level='light'){
      try{ TG?.HapticFeedback?.impactOccurred && TG.HapticFeedback.impactOccurred(level); }
      catch(_){ try{ navigator.vibrate && navigator.vibrate(level==='light'?10:16); }catch(_){} }
    }
    function openSheet({title='', html='', from='bottom'} = {}){
      if (!sheetRoot) return;
      sheetRoot.classList.toggle('sheet-bottom', from==='bottom');
      if (sheetTitle) sheetTitle.textContent = title || '';
      if (sheetBody && html != null) sheetBody.innerHTML = html;
      sheetRoot.classList.add('is-open'); document.body.classList.add('sheet-open');
      requestAnimationFrame(()=> sheetPanel?.focus({preventScroll:true}));
      haptic('light'); syncBack();
    }
    function closeSheet(){
      if (!sheetRoot) return;
      sheetRoot.classList.remove('is-open'); document.body.classList.remove('sheet-open');
      haptic('light'); syncBack();
    }
    window.openSheet = openSheet;
    window.closeSheet = closeSheet;

    sheetRoot?.addEventListener('click', (e)=>{ if (e.target.closest('[data-close-sheet]')) closeSheet(); });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && sheetRoot?.classList.contains('is-open')) closeSheet(); });

    let y0=0,y=0,drag=false;
    sheetPanel?.addEventListener('touchstart', e=>{ drag=true; y0=y=e.touches[0].clientY; sheetPanel.style.transition='none'; }, {passive:true});
    sheetPanel?.addEventListener('touchmove',  e=>{
      if(!drag) return; y=e.touches[0].clientY; const dy=Math.max(0,y-y0);
      if (TG && typeof TG.disableVerticalSwipes === 'function'){ e.preventDefault?.(); return; }
      sheetPanel.style.transform=`translateY(${dy}px)`;
    }, {passive:false});
    sheetPanel?.addEventListener('touchend',   ()=>{ if(!drag) return; drag=false; sheetPanel.style.transition=''; sheetPanel.style.transform=''; if (y-y0>100) closeSheet(); });

    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    if (isiOS && !(TG && typeof TG.disableVerticalSwipes === 'function')){
      let startY = 0;
      document.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, {passive:true});
      document.addEventListener('touchmove', e => {
        const dy = e.touches[0].clientY - startY;
        const atTop = (window.scrollY <= 0);
        if (dy > 0 && atTop){ e.preventDefault(); }
      }, {passive:false});
    }

    document.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('[data-open-sheet]');
      if (openBtn){
        e.preventDefault();
        const tplSel = openBtn.dataset.tpl || '';
        const tpl    = tplSel ? document.querySelector(tplSel) : null;
        const html   = tpl ? tpl.innerHTML : '';
        const ttl    = openBtn.getAttribute('title') || openBtn.dataset.title || openBtn.textContent.trim() || '';
        const from   = openBtn.dataset.from || 'bottom';
        openSheet({ title: ttl, html, from });
        return;
      }
      const tab = e.target.closest('[data-page]');
      if (tab){
        e.preventDefault();
        navigateTo(tab.dataset.page);
      }
    });

    const start = currentId();
    history.replaceState({id:start}, '', '#'+start);
    setActivePage(start);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 0);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 300);
  })();
  </script>

<script>
(function introSlider(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // ====== –ö–û–ù–§–ò–ì –ö–ù–û–ü–û–ö –ü–û –°–õ–ê–ô–î–ê–ú ======
  // –ò–Ω–¥–µ–∫—Å—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ø–æ—Ä—è–¥–∫—É —Å–µ–∫—Ü–∏–π .intro__slide –≤ #intro-slides
  const INTRO_CFG = {
    actions: {
      0: [ // –°–ª–∞–π–¥ 0 ‚Äî –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
        { label:'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do:'next' }
      ],
      1: [ // –°–ª–∞–π–¥ 1 ‚Äî –¥–≤–µ —Ä—è–¥–æ–º
        { label:'–ù–µ—Ç', type:'ghost', do:'answer', value:'no' },
        { label:'–î–∞',  type:'primary', do:'navigate', to:'consult' } // –ø–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ó–∞–ø–∏—Å—å"
      ],
      2: [ // –°–ª–∞–π–¥ 2 ‚Äî –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
        { label:'–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do:'done' }
      ],
      // –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –±—É–¥—É—â–∏—Ö —Å–ª–∞–π–¥–æ–≤:
      // 3: [
      //   { label:'–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç', type:'primary', do:'link', href:'https://example.com' }
      // ],
      // 4: [
      //   { label:'–ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ', type:'primary', do:'sheet', title:'–î–µ–º–æ', tpl:'#tpl-example', from:'bottom' }
      // ]
    },
    onAnswer: (index, value) => {
      // –¢–≤–æ–π —Ö—É–∫ –Ω–∞ –æ—Ç–≤–µ—Ç—ã "–î–∞/–ù–µ—Ç" –∏ —Ç.–ø.
      // –ù–∞–ø—Ä–∏–º–µ—Ä: localStorage.setItem('intro_answer_'+index, value);
      // console.log('Answer on slide', index, '=>', value);
    }
  };

  // ====== DOM ======
  const root = document.getElementById('intro');
  if(!root) return;

  const slidesWrap = root.querySelector('#intro-slides');
  const slides = Array.from(root.querySelectorAll('.intro__slide'));
  const progress = root.querySelector('#intro-progress');
  const actions = root.querySelector('#intro-actions');

  // –ü—Ä–æ–≥—Ä–µ—Å—Å
  progress.innerHTML = slides.map(()=>'<i class="intro__seg"></i>').join('');
  const segs = Array.from(progress.children);

  let idx = 0, touchX0=0, touchX=0, dragging=false, backHandler=null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };

  // –°–µ—Ä–≤–∏—Å: —Å–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫—É
  function btnHTML(cfg){
    const cls = ['intro__btn'];
    if (cfg.type === 'primary') cls.push('intro__btn--primary');
    if (cfg.type === 'ghost')   cls.push('intro__btn--ghost');
    const attrs = [];
    if (cfg.do) attrs.push(`data-act="${cfg.do}"`);
    if (cfg.value != null) attrs.push(`data-val="${String(cfg.value)}"`);
    if (cfg.to)    attrs.push(`data-to="${String(cfg.to)}"`);
    if (cfg.href)  attrs.push(`data-href="${String(cfg.href)}"`);
    if (cfg.title) attrs.push(`data-title="${String(cfg.title)}"`);
    if (cfg.tpl)   attrs.push(`data-tpl="${String(cfg.tpl)}"`);
    if (cfg.from)  attrs.push(`data-from="${String(cfg.from)}"`);
    return `<button class="${cls.join(' ')}" ${attrs.join(' ')}>${cfg.label}</button>`;
  }

  // –†–µ–Ω–¥–µ—Ä –Ω–∏–∑–∞ (–∫–Ω–æ–ø–æ–∫)
  function renderActions(){
    const set = INTRO_CFG.actions[idx] || defaultActions();
    // —Å–µ—Ç–∫–∞: 1 / 2 / 3+
    actions.className = 'intro__actions';
    if (set.length === 1) actions.classList.add('intro__actions--one');
    else if (set.length === 2) actions.classList.add('intro__actions--two');
    else actions.classList.add('intro__actions--multi'); // —Å–º. CSS –Ω–∏–∂–µ
    actions.innerHTML = set.map(btnHTML).join('');
  }

  // –î–µ—Ñ–æ–ª—Ç, –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–ª –¥–ª—è —Å–ª–∞–π–¥–∞: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" –∏–ª–∏ "–ì–æ—Ç–æ–≤–æ" –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º
  function defaultActions(){
    const last = (idx === slides.length - 1);
    return [ { label: last ? '–ì–æ—Ç–æ–≤–æ' : '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å', type:'primary', do: last ? 'done' : 'next' } ];
    // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  }

  function apply(){
    slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
    segs.forEach((d,i)=> d.classList.toggle('active', i<=idx));
    renderActions();
  }

  // –û—Ç–∫—Ä—ã—Ç—å / –∑–∞–∫—Ä—ã—Ç—å
  function openIntro(startIndex){
    if (Number.isInteger(startIndex)) idx = Math.max(0, Math.min(startIndex, slides.length-1));
    root.classList.add('is-open');
    document.body.classList.add('intro-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeIntro();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
    }catch(_){}

    apply();
    window.syncBack?.();
  }
  function closeIntro(){
    root.classList.remove('is-open');
    document.body.classList.remove('intro-open');

    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  function next(){ if(idx<slides.length-1){ idx++; apply(); haptic(); } }
  function prev(){ if(idx>0){ idx--; apply(); haptic(); } }

  // –ñ–µ—Å—Ç—ã –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è
  slidesWrap.addEventListener('touchstart', e=>{ dragging=true; touchX0=touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchmove',  e=>{ if(!dragging) return; touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchend',   ()=>{ if(!dragging) return; dragging=false;
    const dx = touchX - touchX0; if (Math.abs(dx)>50){ dx<0 ? next() : prev(); }
  });

  // –ö–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–∞–º –Ω–∏–∑–∞
  actions.addEventListener('click', (e)=>{
    const b = e.target.closest('[data-act]'); if(!b) return;
    const act  = b.getAttribute('data-act');
    const val  = b.getAttribute('data-val');
    const to   = b.getAttribute('data-to');
    const href = b.getAttribute('data-href');
    const title= b.getAttribute('data-title');
    const tpl  = b.getAttribute('data-tpl');
    const from = b.getAttribute('data-from') || 'bottom';

    switch(act){
      case 'next': next(); break;
      case 'prev': prev(); break;
      case 'done': haptic('medium'); closeIntro(); break;
      case 'answer':
        try{ INTRO_CFG.onAnswer && INTRO_CFG.onAnswer(idx, val); }catch(_){}
        next(); break;
      case 'navigate':
        closeIntro();
        if (typeof window.navigateTo === 'function') window.navigateTo(to);
        else if (to) location.hash = '#'+to;
        break;
      case 'link':
        try{ TG?.openLink ? TG.openLink(href) : window.open(href, '_blank'); }catch(_){}
        break;
      case 'sheet':
        closeIntro();
        if (typeof window.openSheet === 'function'){
          const tplNode = tpl ? document.querySelector(tpl) : null;
          const html = tplNode ? tplNode.innerHTML : '<div class="card"><b>–ù–µ—Ç —à–∞–±–ª–æ–Ω–∞</b></div>';
          window.openSheet({ title, html, from });
        }
        break;
    }
  });

  // –û—Ç–∫—Ä—ã–≤–∞—Ç—å –ø–æ –∫–Ω–æ–ø–∫–µ: data-open-intro –∏–ª–∏ data-open-intro="2" (—Å—Ç–∞—Ä—Ç —Å–ª–∞–π–¥ 2)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-intro]');
    if (!t) return;
    e.preventDefault();
    const start = parseInt(t.getAttribute('data-open-intro'), 10);
    openIntro(Number.isFinite(start) ? start : undefined);
  });

  // –≠–∫—Å–ø–æ—Ä—Ç (–µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –æ—Ç–∫—Ä—ã—Ç—å –∏–∑ –∫–æ–¥–∞)
  window.openIntro  = openIntro;
  window.closeIntro = closeIntro;
})();
</script>


<script>
/* ===== FULLSCREEN CLICKER (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π) ===== */
(function(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root        = document.getElementById('clicker');
  if (!root) return;

  const stage       = document.getElementById('clicker-stage');
  const img         = root.querySelector('.clicker__img');

  const counterVal  = document.getElementById('counter-val');
  const timerText   = document.getElementById('timer-text');
  const timerBar    = document.getElementById('timer-bar');

  const scoreBox    = document.getElementById('clicker-score');
  const bestEl      = document.getElementById('score-best');
  const worldEl     = document.getElementById('score-world');
  const cta         = document.getElementById('clicker-cta');

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
  const WORLD_RECORD = 93;       // –º–æ–∂–µ—à—å –º–µ–Ω—è—Ç—å / –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å —Å –±—ç–∫–∞
  const TIMER_MS     = 60_000;   // 1 –º–∏–Ω—É—Ç–∞

  // –°–æ—Å—Ç–æ—è–Ω–∏–µ
  let diamonds   = 0;
  let best       = Number(localStorage.getItem('clicker_best') || 0);
  let pressing   = false;
  let running    = false;
  let t0         = 0;
  let rafId      = 0;
  let backHandler= null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };
  const mmss   = (ms)=>{
    const s = Math.max(0, Math.ceil(ms/1000));
    const m = Math.floor(s/60);
    const ss = String(s%60).padStart(2,'0');
    return `${m}:${ss}`;
  };
  const updateCounter = ()=> { counterVal.textContent = diamonds; };

  function spawnAt(x, y){
    // —Ä–æ–º–±–∏–∫
    const s = document.createElement('div');
    s.className = 'spark'; s.textContent = '‚óÜ';
    s.style.left = x+'px'; s.style.top = y+'px';
    stage.appendChild(s); s.addEventListener('animationend', ()=> s.remove());
    // —Ä–∏–ø–ª
    const r = document.createElement('i');
    r.className = 'ripple'; r.style.left = x+'px'; r.style.top = y+'px';
    stage.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
  }

  function registerHit(ev){
    if(!running) return;
    const rect = stage.getBoundingClientRect();
    const clientX = (ev.clientX ?? ev.touches?.[0]?.clientX);
    const clientY = (ev.clientY ?? ev.touches?.[0]?.clientY);
    if (clientX==null) return;
    spawnAt(clientX - rect.left, clientY - rect.top);
    diamonds += 1; updateCounter(); haptic('medium');
  }

  function pressOn(){ if(running && !pressing){ pressing=true; img.classList.add('is-press'); } }
  function pressOff(e){ if(!pressing) return; pressing=false; img.classList.remove('is-press'); if (e) registerHit(e); }

  // –ö–ª–∏–∫–∞–µ–º –¢–û–õ–¨–ö–û –ø–æ IMG (Pointer Events, fallbacks)
  if (window.PointerEvent){
    img.addEventListener('pointerdown', pressOn);
    img.addEventListener('pointerup',   pressOff);
    img.addEventListener('pointercancel', ()=> pressOff());
    img.addEventListener('pointerleave',  ()=> pressOff());
  } else {
    img.addEventListener('touchstart', ()=> pressOn(), {passive:true});
    img.addEventListener('touchend',   (e)=> pressOff(e), {passive:true});
    img.addEventListener('mousedown',  ()=> pressOn());
    img.addEventListener('mouseup',    (e)=> pressOff(e));
    img.addEventListener('mouseleave', ()=> pressOff());
  }

  // ===== –¢–∞–π–º–µ—Ä
  function tick(){
    const elapsed = Date.now() - t0;
    const left    = Math.max(0, TIMER_MS - elapsed);
    timerText.textContent = mmss(left);
    timerBar.style.transform = `scaleX(${Math.max(0, 1 - elapsed / TIMER_MS)})`;
    if (left <= 0){ finish(); return; }
    rafId = requestAnimationFrame(tick);
  }
  function startTimer(){
    cancelAnimationFrame(rafId);
    t0 = Date.now();
    timerBar.style.transform = 'scaleX(1)';
    timerText.textContent = mmss(TIMER_MS);
    rafId = requestAnimationFrame(tick);
  }

  // ===== –û—Ç–∫—Ä—ã—Ç—å / –ó–∞–∫—Ä—ã—Ç—å
  function openClicker(){
    // reset —Å—á—ë—Ç/–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    diamonds = 0; updateCounter();
    img.style.display = '';                // –ø–æ–∫–∞–∑–∞—Ç—å IMG
    scoreBox.classList.remove('show');     // —Å–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å —Å–æ —Å—á—ë—Ç–æ–º
    cta.classList.remove('show');          // —Å–∫—Ä—ã—Ç—å CTA

    root.classList.add('is-open');
    document.body.classList.add('clicker-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeClicker();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
      TG?.expand?.();
    }catch(_){}

    running = true;
    startTimer();
    window.syncBack?.();
  }
  function closeClicker(){
    running = false;
    cancelAnimationFrame(rafId);
    root.classList.remove('is-open');
    document.body.classList.remove('clicker-open');
    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  // ===== –§–∏–Ω–∏—à —Ä–∞—É–Ω–¥–∞
  function finish(){
    running = false;
    cancelAnimationFrame(rafId);

    // –æ–±–Ω–æ–≤–∏—Ç—å best
    if (diamonds > best){
      best = diamonds;
      try{ localStorage.setItem('clicker_best', String(best)); }catch(_){}
    }
    bestEl.textContent  = best;
    worldEl.textContent = WORLD_RECORD;

    // –∑–∞–º–µ–Ω–∏—Ç—å IMG –Ω–∞ –ø–∞–Ω–µ–ª—å —Å–æ —Å—á—ë—Ç–æ–º + –ø–æ–∫–∞–∑–∞—Ç—å CTA
    img.style.display = 'none';
    scoreBox.classList.add('show');
    cta.classList.add('show');

    haptic('medium');
  }

  // CTA: –∑–∞–∫—Ä—ã—Ç—å
  cta.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-clicker]')) closeClicker();
  });

  // Esc (desktop)
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeClicker(); });

  // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ: –ª—é–±–∞—è –∫–Ω–æ–ø–∫–∞ —Å data-open-clicker
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-clicker]');
    if (!t) return;
    e.preventDefault();
    openClicker();
  });

  // –≠–∫—Å–ø–æ—Ä—Ç (–µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –∑–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ)
  window.openClicker = openClicker;
  window.closeClicker = closeClicker;
})();
</script>

<script>
/* ===== TARGET POPPER v2 ‚Äî smooth energy regen + time drain + gold + combos ===== */
(function targetPopperV2(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root = document.getElementById('popper'); if (!root) return;
  const stage = document.getElementById('pp-stage');
  const timerText = document.getElementById('pp-timer-text');
  const timerBar  = document.getElementById('pp-timer-bar');
  const scoreVal  = document.getElementById('pp-score-val');
  const result    = document.getElementById('pp-result');
  const bestEl    = document.getElementById('pp-best');
  const worldEl   = document.getElementById('pp-world');
  const cta       = document.getElementById('pp-cta');
  const comboEl   = document.getElementById('pp-combo');
  const comboValEl= document.getElementById('pp-combo-val');
  const comboNoteEl = document.getElementById('pp-combo-note');

  // CONFIG
  const GAME_NAME        = 'popper';
  const WORLD_RECORD     = 120;

  // targets –∂–∏–∑–Ω—å —Ü–µ–ª–∏
  const SPAWN_EVERY_MS   = 520;
  const LIFE_MIN_MS      = 1100;
  const LIFE_MAX_MS      = 1700;
  const SIZE_MIN         = 44;
  const SIZE_MAX         = 68;
  const GOLD_PROB        = 0.08;
  const GOLD_SCORE       = 5;
  const NORMAL_SCORE     = 1;

  // combo
  const COMBO_STEP       = 3;     // +1 –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫–∞–∂–¥—ã–µ 3 –ø–æ–ø–∞–¥–∞–Ω–∏—è
  const COMBO_MAX_MULT   = 5;     // –º–∞–∫—Å–∏–º—É–º x5

  // energy (–¥–µ—Ñ–æ–ª—Ç—ã –º–æ–∂–Ω–æ –∫—Ä—É—Ç–∏—Ç—å)
  const ENERGY_MAX_DEFAULT = 100;
  const ENERGY_COST_HIT    = 0.1;
  const ENERGY_COST_MISS   = 0.3;
  const ENERGY_COST_EXPIRE = 0.2;
  const START_MIN_ENERGY   = 0.1;   // –º–∏–Ω–∏–º—É–º, —á—Ç–æ–±—ã —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å
  let   ENERGY_REGEN_MS    = 24 * 3600_000; // –≥–ª–æ–±–∞–ª—å–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç (–ø–æ–ª–Ω—ã–π –±–∞–∫ –∑–∞ 24—á)

  // –ø–ª–∞–≤–Ω—ã–π –ü–û–ú–ò–ù–£–¢–ù–´–ô —Ä–∞—Å—Ö–æ–¥ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã (Variant 2)
  const DRAIN_PER_MIN     = 0.10;   // –µ–¥/–º–∏–Ω; –ø–æ—Å—Ç–∞–≤—å –º–µ–Ω—å—à–µ/–±–æ–ª—å—à–µ
  let   lastDrainTs       = 0;

  // STATE
  let score = 0, best = 0;
  let running = false, spawnId = 0;
  let backHandler = null;
  let combo = 0;
  let sessionKey = 'default';
  let energyMax  = ENERGY_MAX_DEFAULT;
  let energyRafId = 0;
  let lockMode = false;

  // Utils
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const rnd  = (a,b)=> a + Math.random()*(b-a);
  const irnd = (a,b)=> Math.floor(rnd(a,b));
  const clamp= (v,a,b)=> Math.max(a, Math.min(b, v));

  // Storage helpers (per sessionKey)
  const k = (s)=> `${GAME_NAME}_${s}_${sessionKey}`;
  const getNum = (key, def=0)=> Number(localStorage.getItem(key) ?? def);
  const setNum = (key, v)=> { try{ localStorage.setItem(key, String(v)); }catch(_){} };

  // Energy model (value@ts + linear regen)
  function energyKeys(){ return { val: k('energy_val'), ts: k('energy_ts') }; }
  function energySnapshot(){
    const {val, ts} = energyKeys();
    let v = Number(localStorage.getItem(val));
    let t = Number(localStorage.getItem(ts));
    if (!Number.isFinite(v)) v = energyMax;
    if (!Number.isFinite(t)) t = Date.now();
    return { v, t };
  }
  function energyAt(now = Date.now()){
    const { v, t } = energySnapshot();
    const regenRate = energyMax / ENERGY_REGEN_MS; // –µ–¥/–º—Å
    return clamp(v + regenRate * (now - t), 0, energyMax);
  }
  function energyWrite(newVal, now = Date.now()){
    const { val, ts } = energyKeys();
    setNum(val, clamp(newVal, 0, energyMax));
    setNum(ts, now);
  }
  function energyUse(cost){
    const now = Date.now();
    const cur = energyAt(now);
    const next = cur - cost;
    energyWrite(next, now);
    if (next <= 0){ energyWrite(0, now); finish(true); return false; }
    return true;
  }
  function energyPctFloat(v = energyAt()){ return (v / energyMax) * 100; }

  // Smooth UI (rAF) + time drain
  function energyUIFrame(){
    // –ø–ª–∞–≤–Ω—ã–π –ø–æ–º–∏–Ω—É—Ç–Ω—ã–π —Ä–∞—Å—Ö–æ–¥, –ø–æ–∫–∞ –∏–≥—Ä–∞ –∏–¥—ë—Ç
    if (running && DRAIN_PER_MIN > 0){
      const nowPerf = performance.now();
      if (!lastDrainTs) lastDrainTs = nowPerf;
      const dtMin = (nowPerf - lastDrainTs) / 60000;
      if (dtMin > 0){
        const drain = dtMin * DRAIN_PER_MIN;
        const now   = Date.now();
        const cur   = energyAt(now);
        energyWrite(cur - drain, now);
        lastDrainTs = nowPerf;
      }
    }

    const pct = energyPctFloat();
    const pctText = Math.round(pct*10)/10;
    timerText.textContent = `Energy ${pctText}%`;
    timerBar.style.transform = `scaleX(${clamp(pct/100, 0, 1)})`;

    if (lockMode){
      const btn = cta.querySelector('.btn');
      if (btn) btn.textContent = (energyAt() >= START_MIN_ENERGY) ? 'Play' : 'Out of energy ‚Äî Close';
    }
    energyRafId = requestAnimationFrame(energyUIFrame);
  }
  function startEnergyRaf(){ cancelAnimationFrame(energyRafId); energyRafId = requestAnimationFrame(energyUIFrame); }
  function stopEnergyRaf(){ cancelAnimationFrame(energyRafId); energyRafId = 0; }

  // Score / Combo (x1 —Å–∫—Ä—ã—Ç)
  function updateScore(v){ score = v; scoreVal.textContent = v; }
  function setCombo(hitOk){
    if (hitOk){ combo += 1; } else { combo = 0; }
    const mult = 1 + Math.min(Math.floor(combo / COMBO_STEP), COMBO_MAX_MULT-1);
    if (mult > 1){
      comboValEl.textContent = `x${mult}`;
      comboNoteEl.textContent = 'combo';
      comboEl.classList.add('show');
    } else {
      comboEl.classList.remove('show');
      comboValEl.textContent = '';
      comboNoteEl.textContent = '';
    }
    return mult;
  }

  // FX
  function spark(x,y, text, cls){
    const s = document.createElement('div');
    s.className = 'pp-spark' + (cls?` ${cls}`:'');
    s.textContent = text;
    s.style.left = x+'px'; s.style.top = y+'px';
    stage.appendChild(s); s.addEventListener('animationend', ()=> s.remove());
  }
  function ripple(x,y){
    const r = document.createElement('i');
    r.className='pp-ripple'; r.style.left=x+'px'; r.style.top=y+'px';
    stage.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
  }

  // Spawn targets
  function spawn(){
    if(!running) return;
    const rect = stage.getBoundingClientRect();
    const pad = 16;
    const size = irnd(SIZE_MIN,SIZE_MAX);
    const x = irnd(pad, Math.max(pad, rect.width - size - pad));
    const y = irnd(pad, Math.max(pad, rect.height - size - pad));
    const life = irnd(LIFE_MIN_MS, LIFE_MAX_MS);
    const isGold = Math.random() < GOLD_PROB;

    const el = document.createElement('div');
    el.className = 'pp-target' + (isGold ? ' pp-target--gold' : '');
    el.style.width = el.style.height = size+'px';
    el.style.left = x+'px'; el.style.top = y+'px';
    el.dataset.base = String(isGold ? GOLD_SCORE : NORMAL_SCORE);
    let dead=false;

    function kill(){ if (dead) return; dead = true; el.style.animation = 'pp-out .12s ease-out forwards'; setTimeout(()=> el.remove(), 120); }

    el.addEventListener('pointerdown', (e)=>{
      if(!running) return;
      e.preventDefault(); e.stopPropagation();

      if (!energyUse(ENERGY_COST_HIT)) return;

      const base = Number(el.dataset.base||1);
      const mult = setCombo(true);
      const add  = base * mult;

      const cx = x + size/2, cy = y + size/2;
      updateScore(score + add);
      haptic('medium');
      spark(cx, cy, `+${add}` + (mult>1?` √ó${mult}`:''), isGold? 'pp-spark--gold':'' );
      ripple(cx, cy);

      kill();

      if (isGold){
        const now = Date.now();
        const cur = energyAt(now);
        energyWrite(Math.min(energyMax, cur + 2), now); // +2 —ç–Ω–µ—Ä–≥–∏–∏
      }
    }, {passive:false});

    stage.appendChild(el);

    // –∏—Å—Ç–µ—á–µ–Ω–∏–µ –∂–∏–∑–Ω–∏ —Ü–µ–ª–∏ = —à—Ç—Ä–∞—Ñ
    setTimeout(()=>{
      if (!dead && running){
        const cx = x + size/2, cy = y + size/2;
        combo = 0; setCombo(false);
        if (energyUse(ENERGY_COST_EXPIRE)){
          updateScore(Math.max(0, score - 1));
          spark(cx, cy, '‚Äì1', 'pp-spark--miss'); ripple(cx, cy);
          haptic('light');
        }
        kill();
      }
    }, life);
  }

  // Miss –ø–æ –ø—É—Å—Ç–æ–º—É –º–µ—Å—Ç—É
  stage.addEventListener('pointerdown', (e)=>{
    if(!running) return;
    if (e.target.closest('.pp-target')) return;
    e.preventDefault();
    const rect = stage.getBoundingClientRect();
    const cx = (e.clientX ?? 0) - rect.left, cy = (e.clientY ?? 0) - rect.top;

    combo = 0; setCombo(false);
    if (energyUse(ENERGY_COST_MISS)){
      updateScore(Math.max(0, score - 1));
      spark(cx, cy, '‚Äì1', 'pp-spark--miss'); ripple(cx, cy);
      haptic('light');
    }
  });

  // Open / Close / Lock
  function openLocked(){
    lockMode = true; running = false;
    result.classList.remove('show'); cta.classList.add('show');
    stage.style.pointerEvents='none';

    root.classList.add('is-open'); document.body.classList.add('popper-open');
    try{ TG?.BackButton?.show?.(); TG?.BackButton?.onClick?.(()=> closePopper()); TG?.disableVerticalSwipes?.(); TG?.expand?.(); }catch(_){}
    startEnergyRaf(); window.syncBack?.();
  }

  function openPopper(opts){
    sessionKey = opts?.key || 'default';
    ENERGY_REGEN_MS = Number.isFinite(opts?.regenMs) ? opts.regenMs : ENERGY_REGEN_MS; // Variant-B
    energyMax = ENERGY_MAX_DEFAULT;

    best = getNum(k('best'), 0);

    if (energyAt() < START_MIN_ENERGY) return openLocked();

    // reset
    lockMode = false; updateScore(0); combo = 0; setCombo(false);
    result.classList.remove('show'); cta.classList.remove('show');
    stage.style.pointerEvents='auto';
    stage.querySelectorAll('.pp-target,.pp-spark,.pp-ripple').forEach(n=>n.remove());

    root.classList.add('is-open'); document.body.classList.add('popper-open');
    try{
      TG?.BackButton?.show?.();
      TG?.BackButton?.onClick?.(()=> closePopper());
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    running = true;
    lastDrainTs = performance.now();
    clearInterval(spawnId);
    spawn();
    spawnId = setInterval(()=>{ if(running) spawn(); }, SPAWN_EVERY_MS);

    startEnergyRaf();
    window.syncBack?.();
  }

  function closePopper(){
    running = false; lockMode = false; lastDrainTs = 0;
    clearInterval(spawnId); stopEnergyRaf();
    root.classList.remove('is-open'); document.body.classList.remove('popper-open');
    try{ TG?.BackButton?.hide?.(); }catch(_){}
    window.syncBack?.();
  }

  // Finish
  async function finish(outOfEnergy=false){
    running = false; clearInterval(spawnId);
    if (score > best){ best = score; setNum(k('best'), best); }
    bestEl.textContent  = best; worldEl.textContent = WORLD_RECORD;

    result.classList.add('show'); cta.classList.add('show');
    const btn = cta.querySelector('.btn'); if (btn) btn.textContent = outOfEnergy ? 'Out of energy ‚Äî Close' : 'Close';
    haptic('medium');

    try{
      const base = window.APP_CONFIG?.WORKER_BASE;
      if (base){
        await fetch(`${base}games/submit`, {
          method:'POST', headers:{'content-type':'application/json'},
          body: JSON.stringify({
            game: GAME_NAME, mode:'daily', key: sessionKey, score,
            user: TG?.initDataUnsafe?.user || null
          })
        });
      }
    }catch(_){}
  }

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    if (lockMode && energyAt() >= START_MIN_ENERGY){
      openPopper({ key: sessionKey }); // regenMs –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
    } else {
      closePopper();
    }
  });

  // Delegated opener (Variant-B: –Ω–µ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º 24—á, –µ—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç –Ω–µ —É–∫–∞–∑–∞–Ω)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-popper]'); if (!t) return;
    e.preventDefault();
    const key  = t.getAttribute('data-game-key') || 'default';
    const hrsAttr = t.getAttribute('data-energy-regen-hours');
    const regenMs = (hrsAttr !== null && hrsAttr !== '')
      ? parseFloat(hrsAttr) * 3600_000
      : undefined;
    openPopper({ key, regenMs });
  });

  // Esc (desktop)
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closePopper(); });

  // —ç–∫—Å–ø–æ—Ä—Ç
  window.openPopper  = (opts)=> openPopper(opts);
  window.closePopper = closePopper;
})();
</script>


<script>
/* ===== Lane Runner ‚Äî sprites + tilt on lane change ===== */
(function laneRunner(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root   = document.getElementById('runner'); if (!root) return;
  const stage  = document.getElementById('rn-stage');
  const player = document.getElementById('rn-player');
  const timeEl = document.getElementById('rn-time');
  const barEl  = document.getElementById('rn-bar');
  const scoreEl= document.getElementById('rn-score-val');
  const resBox = document.getElementById('rn-result');
  const bestEl = document.getElementById('rn-best');
  const worldEl= document.getElementById('rn-world');
  const cta    = document.getElementById('rn-cta');

  /* ===== Sprites config (–ø–æ—Å—Ç–∞–≤—å —Å–≤–æ–∏ –ø—É—Ç–∏/—Ä–∞–∑–º–µ—Ä—ã) ===== */
  const SPRITES = {
    player: { img: 'travel.png', w: 56, h: 96 },
    obstacles: [
      { img: 'car.png',    w: 56, h: 96 },
      { img: 'car.png', w: 56, h: 96 },
      { img: 'car.png',  w: 56, h: 96 }
    ],
    coin: { img: 'coin.png', w: 38, h: 38 }
  };
  function applyPlayerSprite(){
    document.documentElement.style.setProperty('--player-w', SPRITES.player.w + 'px');
    document.documentElement.style.setProperty('--player-h', SPRITES.player.h + 'px');
    player.style.backgroundImage = `url(${SPRITES.player.img})`;
  }
  function pickObstacleSprite(){
    return SPRITES.obstacles[Math.floor(Math.random()*SPRITES.obstacles.length)];
  }
  function applyCoinVars(){
    document.documentElement.style.setProperty('--coin-w', SPRITES.coin.w + 'px');
    document.documentElement.style.setProperty('--coin-h', SPRITES.coin.h + 'px');
  }

  // CONFIG (–∫—Ä—É—Ç–∏ –∫–∞–∫ –Ω—É–∂–Ω–æ)
  const DURATION_MS     = 45_000;           // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–±–µ–≥–∞
  const WORLD_RECORD    = 5000;
  const BASE_SPEED_PX_S = 260;              // –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è, px/—Å–µ–∫
  const SPEED_ACCEL_EACH= 8_000;            // –∫–∞–∂–¥—ã–µ N –º—Å ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ
  const SPEED_DELTA     = 40;               // —à–∞–≥ —É—Å–∫–æ—Ä–µ–Ω–∏—è px/—Å–µ–∫
  const SPAWN_MS        = 550;              // –∏–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞ –æ–±—ä–µ–∫—Ç–æ–≤
  const COIN_PROB       = 0.30;             // —à–∞–Ω—Å –º–æ–Ω–µ—Ç–∫–∏
  const COIN_SCORE      = 15;               // –æ—á–∫–∏ –∑–∞ –º–æ–Ω–µ—Ç–∫—É
  const DIST_SCORE_K    = 0.06;             // –æ—á–∫–∏ –∑–∞ –∫–∞–∂–¥—ã–π px
  const PLAYER_Y        = 0.82;             // –≤—ã—Å–æ—Ç–∞ –∏–≥—Ä–æ–∫–∞ (0..1)
  const COLLIDE_PAD     = 16;               // ¬´–º—è–≥–∫–æ—Å—Ç—å¬ª –∫–æ–ª–ª–∏–∑–∏–∏, px

  // STATE
  let lane = 1;                              // 0/1/2
  let score= 0, best = Number(localStorage.getItem('runner_best')||0);
  let running=false, t0=0, raf=0, spawnTimer=0;
  let backOff=null;
  let entities=[]; // {type:'obs'|'coin', lane:0..2, x,y,el}

  // helpers
  const clamp = (v,a,b)=> Math.max(a,Math.min(b,v));
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const mmss = ms => { const s=Math.max(0,Math.ceil(ms/1000)); return `${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`; };
  const laneCenters = ()=>{
    const w = stage.clientWidth, laneW = w/3;
    return [laneW*0.5, laneW*1.5, laneW*2.5];
  };
  function placePlayer(){
    const x = laneCenters()[lane];
    const y = stage.clientHeight * PLAYER_Y;
    player.style.left = x+'px';
    player.style.top  = y+'px';
  }
  function tilt(dir){
    // –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏: —Å–Ω–∏–º–∞–µ–º –∫–ª–∞—Å—Å—ã, —Ä–µ—Ñ–ª–æ—É, —Å–Ω–æ–≤–∞ –Ω–∞–≤–µ—à–∏–≤–∞–µ–º
    player.classList.remove('tilt-left','tilt-right');
    void player.offsetWidth; // reflow
    player.classList.add(dir==='right' ? 'tilt-right' : 'tilt-left');
    setTimeout(()=> player.classList.remove('tilt-left','tilt-right'), 260);
  }

  // swipe / keys
  let startX=0,startY=0;
  stage.addEventListener('pointerdown', e=>{ startX=e.clientX; startY=e.clientY; }, {passive:true});
  stage.addEventListener('pointerup', e=>{
    if(!running) return;
    const dx = e.clientX - startX, dy = e.clientY - startY;
    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > 24){
      const prev = lane;
      if (dx>0) lane = clamp(lane+1,0,2); else lane = clamp(lane-1,0,2);
      if (lane!==prev){ placePlayer(); tilt(dx>0?'right':'left'); haptic('light'); }
    }
  }, {passive:true});
  document.addEventListener('keydown', e=>{
    if(!running) return;
    const prev = lane;
    if (e.key==='ArrowLeft')  lane=clamp(lane-1,0,2);
    if (e.key==='ArrowRight') lane=clamp(lane+1,0,2);
    if (lane!==prev){ placePlayer(); tilt(lane>prev?'right':'left'); haptic('light'); }
  });

  // entities
  function spawn(){
    const isCoin = Math.random()<COIN_PROB;
    const L = Math.floor(Math.random()*3);
    const el = document.createElement('div');
    const centers = laneCenters();

    if (isCoin){
      el.className = 'rn-coin';
      el.style.width  = SPRITES.coin.w + 'px';
      el.style.height = SPRITES.coin.h + 'px';
      el.style.backgroundImage = `url(${SPRITES.coin.img})`;
    } else {
      el.className = 'rn-obstacle';
      const s = pickObstacleSprite();
      el.style.width  = s.w + 'px';
      el.style.height = s.h + 'px';
      el.style.backgroundImage = `url(${s.img})`;
    }

    stage.appendChild(el);
    const e = { type:isCoin?'coin':'obs', lane:L, x:centers[L], y:-40, el };
    el.style.left = e.x+'px'; el.style.top = e.y+'px';
    entities.push(e);
  }

  function tick(){
    const t = Date.now();
    const dt = Math.min(32, t - (tick._prev||t)); tick._prev = t;

    // —Ç–∞–π–º–µ—Ä
    const elapsed = t - t0;
    const left = Math.max(0, DURATION_MS - elapsed);
    timeEl.textContent = mmss(left);
    barEl.style.transform = `scaleX(${Math.max(0,1 - elapsed/DURATION_MS)})`;

    // —Å–∫–æ—Ä–æ—Å—Ç—å (—É—Å–∫–æ—Ä—è–µ–º—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º)
    let speed = BASE_SPEED_PX_S + Math.floor(elapsed / SPEED_ACCEL_EACH) * SPEED_DELTA;

    // –¥–≤–∏–∂–µ–Ω–∏–µ, –æ—á–∫–∏ –∑–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—é
    const sy = speed * dt/1000;
    entities.forEach(e=>{
      e.y += sy;
      e.el.style.top = e.y+'px';
    });

    // –¥–∏—Å—Ç–∞–Ω—Ü–∏—è ‚Üí –æ—á–∫–∏
    score += Math.round(sy * DIST_SCORE_K);
    scoreEl.textContent = score;

    // –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π –∏ —Å–±–æ—Ä –º–æ–Ω–µ—Ç
    const px = laneCenters()[lane];
    const py = stage.clientHeight * PLAYER_Y;
    const dead=[];
    for (let i=0;i<entities.length;i++){
      const e=entities[i];
      // —É–±—Ä–∞—Ç—å –≤—ã—à–µ–¥—à–∏–µ
      if (e.y > stage.clientHeight + 80){ e.el.remove(); dead.push(i); continue; }

      if (e.lane===lane){
        const halfHPlayer = player.clientHeight * 0.45;
        const halfHEnt    = e.el.clientHeight * 0.45;
        const dy = Math.abs(e.y - py);
        if (dy < (halfHPlayer + halfHEnt - COLLIDE_PAD)){
          if (e.type==='obs'){
            crash(); return;
          } else if (e.type==='coin'){
            score += COIN_SCORE; scoreEl.textContent=score;
            haptic('medium');
            e.el.remove(); dead.push(i);
          }
        }
      }
    }
    // —É–¥–∞–ª–∏—Ç—å –º—ë—Ä—Ç–≤—ã—Ö —Å –∫–æ–Ω—Ü–∞
    for (let i=dead.length-1;i>=0;i--) entities.splice(dead[i],1);

    if (left<=0){ finish(); return; }
    raf = requestAnimationFrame(tick);
  }

  function crash(){
    haptic('heavy');
    finish();
  }

  function finish(){
    running=false;
    cancelAnimationFrame(raf);
    clearInterval(spawnTimer);

    if (score>best){ best=score; try{ localStorage.setItem('runner_best', String(best)); }catch(_){ } }
    bestEl.textContent=best; worldEl.textContent=WORLD_RECORD;

    resBox.classList.add('show'); cta.classList.add('show');
  }

  function openRunner(){
    // reset
    entities.forEach(e=> e.el.remove()); entities = [];
    resBox.classList.remove('show'); cta.classList.remove('show');
    score=0; scoreEl.textContent='0';

    root.classList.add('is-open'); document.body.classList.add('runner-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closeRunner();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    // —Å–ø—Ä–∞–π—Ç—ã –∏ –ø–æ–∑–∏—Ü–∏—è –∏–≥—Ä–æ–∫–∞
    applyPlayerSprite(); applyCoinVars();
    lane = 1; placePlayer();

    // —Å—Ç–∞—Ä—Ç
    running = true;
    t0 = Date.now();
    tick._prev = t0;
    tick();
    clearInterval(spawnTimer);
    spawn(); // –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
    spawnTimer = setInterval(spawn, SPAWN_MS);
  }

  function closeRunner(){
    running=false;
    cancelAnimationFrame(raf);
    clearInterval(spawnTimer);
    root.classList.remove('is-open'); document.body.classList.remove('runner-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  // CTA
  cta.addEventListener('click', e=>{
    if (!e.target.closest('.btn')) return;
    closeRunner(); openRunner();
  });

  // Openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-runner]'); if (!t) return;
    e.preventDefault(); openRunner();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-runner]')) closeRunner();
  });

  // Esc desktop
  document.addEventListener('keydown', e=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeRunner(); });

  // –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ (—Ü–µ–Ω—Ç—Ä –¥–æ—Ä–æ–∂–µ–∫)
  const ro = new ResizeObserver(()=> placePlayer());
  ro.observe(stage);
})();
</script>

<script>
/* ===== Flappy-lite+ ‚Äî coins, shield, custom sprites, BackButton ===== */
(function flappyLitePlus(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root   = document.getElementById('flappy'); if (!root) return;
  const stage  = document.getElementById('fl-stage');
  const birdEl = document.getElementById('fl-bird');
  const hintEl = document.getElementById('fl-hint');
  const scoreEl= document.getElementById('fl-score');
  const barEl  = document.getElementById('fl-bar');

  const coinIco= document.getElementById('fl-coin-ico');
  const coinCnt= document.getElementById('fl-coin-count');
  const shIco  = document.getElementById('fl-shield-ico');
  const shBar  = document.getElementById('fl-shield-bar');

  const resBox = document.getElementById('fl-result');
  const bestEl = document.getElementById('fl-best');
  const worldEl= document.getElementById('fl-world');
  const cta    = document.getElementById('fl-cta');

  /* ===== ASSETS: –ø–æ–º–µ–Ω—è–π –ø—É—Ç–∏/—Ä–∞–∑–º–µ—Ä—ã –ø–æ–¥ —Å–≤–æ–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ ===== */
 // –ó–ê–ú–ï–ù–ò –Ω–∞ —Å–≤–æ–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ —Ä–∞–∑–º–µ—Ä—ã (CSS-–ø–∏–∫—Å–µ–ª–∏, –Ω–µ –æ–±—è–∑–∞–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º —Ä–∞–∑–º–µ—Ä–æ–º PNG)
const ASSETS = {
  bird:   { img: 'bird.png',  w: 56, h: 42 },        // –ø—Ç–∏—á–∫–∞
  pipes:  {                                  // —Ç—Ä—É–±—ã: –≤–µ—Ä—Ö/–Ω–∏–∑ (–µ—Å–ª–∏ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äî —É–∫–∞–∂–∏ –µ—ë –≤ –æ–±–æ–∏—Ö)
    top:    'pipe_top.png',
    bottom: 'pipe_bottom.png',
    width:  54                                // –í–ê–ñ–ù–û: –≤–∏–¥–∏–º–∞—è —à–∏—Ä–∏–Ω–∞ —Ç—Ä—É–±—ã –≤ px
  },
  coin:   { img: 'coin.png',   w: 32, h: 32, value: 5 },
  shield: { img: 'shield.png', w: 34, h: 34, dur_ms: 6000 }
};


  /* ===== TUNING ===== */
  const WORLD_RECORD     = 200;
  const GRAVITY          = 1800;      // px/s^2
  const FLAP_VELOCITY    = -520;      // px/s
  const SPEED_X          = 220;       // –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Ç—Ä—É–±
  const ACCEL_EACH_MS    = 8000;      // –∞–≤—Ç–æ—É—Å–∫–æ—Ä–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ N –º—Å
  const SPEED_STEP       = 28;        // —à–∞–≥ —É—Å–∫–æ—Ä–µ–Ω–∏—è
  const PIPE_SPAWN_MS    = 1300;      // —á–∞—Å—Ç–æ—Ç–∞ —Å–ø–∞–≤–Ω–∞ —Ç—Ä—É–±
  const GAP_MIN          = 150;       // –º–∏–Ω. –∑–∞–∑–æ—Ä
  const GAP_MAX          = 190;       // –º–∞–∫—Å. –∑–∞–∑–æ—Ä
  const GAP_TOP_PAD      = 80;        // –æ—Ç—Å—Ç—É–ø –æ—Ç –∫—Ä–∞—ë–≤
  const BIRD_X_FACTOR    = 0.25;      // 25% —à–∏—Ä–∏–Ω—ã
  const ROT_UP           = -35, ROT_DOWN = 90;
  const SAFE_FLOOR_PAD   = 6;

  // items
  const COIN_IN_GAP_PROB = 0.9;      // —à–∞–Ω—Å –º–æ–Ω–µ—Ç–∫–∏ –≤ –∫–∞–∂–¥–æ–π —â–µ–ª–∏
  const SHIELD_PROB      = 0.9;      // —à–∞–Ω—Å —â–∏—Ç–∞ (—Ä–µ–¥–∫–∏–π)
  const SHIELD_COOLDOWN  = 9000;      // –Ω–µ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑ –≤ N –º—Å

  // === Magnet (coins attract to bird when shield is active) ===
const MAGNET_ENABLED   = true;  // –º–æ–∂–Ω–æ –≤—ã–∫–ª—é—á–∏—Ç—å
const MAGNET_RADIUS    = 140;   // —Ä–∞–¥–∏—É—Å –∑–∞—Ö–≤–∞—Ç–∞, px
const MAGNET_PULL_PX_S = 300;   // —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è, px/—Å–µ–∫


  // STATE
  let best     = Number(localStorage.getItem('flappy_best')||0);
  let running  = false, started=false;
  let raf      = 0, spawnT=0, t0=0, backOff=null;
  let w=0,h=0, birdX=0, birdY=0, birdVY=0;

  let pipes=[];   // {x, gapY, gap, topEl, botEl, passed:false}
  let items=[];   // [{type:'coin'|'shield', x,y, el}]
  let lastShieldSpawn = 0;

  let score=0, coins=0;
  let shieldActive=false, shieldUntil=0;

  // helpers
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const clamp  = (v,a,b)=> Math.max(a, Math.min(b, v));
  const rand   = (a,b)=> a + Math.random()*(b-a);

  // apply assets ‚Üí css vars & backgrounds
  function applyAssets(){
    // bird
    document.documentElement.style.setProperty('--bird-w', (ASSETS.bird.w||48)+'px');
    document.documentElement.style.setProperty('--bird-h', (ASSETS.bird.h||36)+'px');
    if (ASSETS.bird.img){
      birdEl.classList.add('fl-bird--sprite');
      birdEl.style.backgroundImage = `url(${ASSETS.bird.img})`;
    } else {
      birdEl.classList.remove('fl-bird--sprite'); birdEl.style.backgroundImage = '';
    }
    // pipes
    document.documentElement.style.setProperty('--pipe-w', (ASSETS.pipes.width||76)+'px');
    // hud icons
    if (ASSETS.coin.img) coinIco.style.backgroundImage = `url(${ASSETS.coin.img})`;
    if (ASSETS.shield.img) shIco.style.backgroundImage = `url(${ASSETS.shield.img})`;
    document.documentElement.style.setProperty('--coin-w', (ASSETS.coin.w||32)+'px');
    document.documentElement.style.setProperty('--coin-h', (ASSETS.coin.h||32)+'px');
    document.documentElement.style.setProperty('--pow-w',  (ASSETS.shield.w||34)+'px');
    document.documentElement.style.setProperty('--pow-h',  (ASSETS.shield.h||34)+'px');
  }

  // layout
  function layout(){
    w = stage.clientWidth; h = stage.clientHeight;
    birdX = w * BIRD_X_FACTOR;
    if (!started){ birdY = h * 0.45; applyBird(); }
  }
  function applyBird(){
    birdEl.style.left = birdX + 'px';
    birdEl.style.top  = birdY + 'px';
  }
  function setScore(v){ scoreEl.textContent = v; }
  function setCoins(v){ coinCnt.textContent = v; }

  // pipes
  function spawnPipe(){
    const gap = rand(GAP_MIN, GAP_MAX);
    const minY = GAP_TOP_PAD + gap/2;
    const maxY = h - GAP_TOP_PAD - gap/2;
    const gapY = rand(minY, maxY);

    const top = document.createElement('div');
    const bot = document.createElement('div');
    top.className = 'fl-pipe-part';
    bot.className = 'fl-pipe-part';
    if (ASSETS.pipes.top && ASSETS.pipes.bottom){
      top.classList.add('fl-pipe--sprite'); bot.classList.add('fl-pipe--sprite');
      top.style.backgroundImage = `url(${ASSETS.pipes.top})`;
      bot.style.backgroundImage = `url(${ASSETS.pipes.bottom})`;
    }
    stage.appendChild(top); stage.appendChild(bot);

    const p = { x: w + (ASSETS.pipes.width||76), gapY, gap, topEl: top, botEl: bot, passed:false };
    pipes.push(p);
    positionPipe(p);

    // coin in gap?
    if (Math.random() < COIN_IN_GAP_PROB){
      const c = document.createElement('div');
      c.className = 'fl-coin';
      if (ASSETS.coin.img) c.style.backgroundImage = `url(${ASSETS.coin.img})`;
      stage.appendChild(c);
      items.push({ type:'coin', x: p.x + 200, y: gapY, el: c }); // —á—É—Ç—å –ø—Ä–∞–≤–µ–µ –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç—Ä—É–±—ã
      positionItem(items[items.length-1]);
    }

    // occasional shield (with cooldown)
    if (Date.now() - lastShieldSpawn > SHIELD_COOLDOWN && Math.random() < SHIELD_PROB){
      const s = document.createElement('div');
      s.className = 'fl-power';
      if (ASSETS.shield.img) s.style.backgroundImage = `url(${ASSETS.shield.img})`;
      stage.appendChild(s);
      items.push({ type:'shield', x: p.x + 300, y: gapY - gap*0.35, el: s });
      positionItem(items[items.length-1]);
      lastShieldSpawn = Date.now();
    }
  }

  function positionPipe(p){
    const pipeW = (ASSETS.pipes.width||76);
    const th = p.gapY - p.gap/2;   // height of top pipe
    const bt = p.gapY + p.gap/2;   // top of bottom pipe
    p.topEl.style.left = p.x + 'px';
    p.topEl.style.top  = '0px';
    p.topEl.style.height = th + 'px';
    p.topEl.style.width  = pipeW + 'px';
    p.botEl.style.left = p.x + 'px';
    p.botEl.style.top  = bt + 'px';
    p.botEl.style.height = (h - bt) + 'px';
    p.botEl.style.width  = pipeW + 'px';
  }

  function positionItem(it){
    it.el.style.left = it.x + 'px';
    it.el.style.top  = it.y + 'px';
  }

  function removePipe(p){ p.topEl.remove(); p.botEl.remove(); }
  function removeItem(it){ it.el.remove(); }

  // collisions
  function rectsOverlap(a,b){
    return !(a.right < b.left || a.left > b.right || a.bottom < b.top || a.top > b.bottom);
  }
  function collidePipe(){
    const br = birdEl.getBoundingClientRect();
    for (const p of pipes){
      if (rectsOverlap(br, p.topEl.getBoundingClientRect()) || rectsOverlap(br, p.botEl.getBoundingClientRect())){
        return true;
      }
    }
    return false;
  }
  function collideItems(){
    const br = birdEl.getBoundingClientRect();
    const dead=[];
    for (let i=0;i<items.length;i++){
      const it = items[i];
      const ir = it.el.getBoundingClientRect();
      if (rectsOverlap(br, ir)){
        if (it.type==='coin'){
          coins += 1; setCoins(coins);
          score += (ASSETS.coin.value||5); setScore(score);
          haptic('medium');
        } else if (it.type==='shield'){
          activateShield();
          haptic('medium');
        }
        removeItem(it); dead.push(i);
      }
    }
    for (let i=dead.length-1;i>=0;i--) items.splice(dead[i],1);
  }

  // shield
  function activateShield(){
    shieldActive = true;
    shieldUntil  = Date.now() + (ASSETS.shield.dur_ms||6000);
    birdEl.classList.add('fl-bird--shield');
  }
  function updateShieldHud(){
    if (!shieldActive){ shBar.style.transform = 'scaleX(0)'; return; }
    const left = shieldUntil - Date.now();
    if (left <= 0){
      shieldActive = false; birdEl.classList.remove('fl-bird--shield');
      shBar.style.transform = 'scaleX(0)';
    } else {
      const pct = clamp(left / (ASSETS.shield.dur_ms||6000), 0, 1);
      shBar.style.transform = `scaleX(${pct})`;
    }
  }

  // control
  function flap(){
    if (!running) return;
    if (!started){
      started = true;
      hintEl.style.display = 'none';
      birdVY = FLAP_VELOCITY;
    } else {
      birdVY = FLAP_VELOCITY;
    }
    haptic('light');
  }

  // loop
  function tick(){
    const now = performance.now();
    const dt  = Math.min(32, now - (tick._prev||now)); tick._prev = now;

    // progress bar (–ø—Ä–æ—Å—Ç–æ ¬´–±–µ–∂–∏—Ç¬ª)
    const elapsed = now - t0;
    const prog = Math.min(1, elapsed / 45000);
    barEl.style.transform = `scaleX(${1-prog})`;

    // speed
    const speed = SPEED_X + Math.floor((now - t0) / ACCEL_EACH_MS) * SPEED_STEP;

    if (started){
      birdVY += GRAVITY * (dt/1000);
      birdY  += birdVY * (dt/1000);

      const ang = clamp((birdVY/600)*45, ROT_UP, ROT_DOWN);
      birdEl.style.transform = `translate(-50%,-50%) rotate(${ang}deg)`;

      const topLimit = 0 + 6;
      const botLimit = h - SAFE_FLOOR_PAD;
      if (birdY <= topLimit){ birdY = topLimit; birdVY = 0; }
      if (birdY >= botLimit){ birdY = botLimit; if (!shieldActive){ crash(); return; } else { /* –º—è–≥–∫–æ –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–µ–º—Å—è */ birdVY = -200; } }
    } else {
      birdY += Math.sin(now/300) * 0.12;
    }

// move pipes/items (+ coin magnet when shieldActive)
const dx = speed * dt/1000;
for (const p of pipes){ 
  p.x -= dx; 
  positionPipe(p); 
}

for (const it of items){
  // –æ–±—ã—á–Ω—ã–π —Å–∫—Ä–æ–ª–ª —Å—Ü–µ–Ω—ã
  it.x -= dx;

  // –º–∞–≥–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–Ω–µ—Ç –∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —â–∏—Ç–µ
  if (MAGNET_ENABLED && shieldActive && it.type === 'coin'){
    const vx = birdX - it.x;
    const vy = birdY - it.y;
    const dist = Math.hypot(vx, vy);

    if (dist < MAGNET_RADIUS){
      // —à–∞–≥ –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è (–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –Ω–µ ¬´–ø–µ—Ä–µ—Å–∫–∞–∫–∏–≤–∞–ª–æ¬ª)
      const pull = MAGNET_PULL_PX_S * (dt/1000);
      const step = Math.min(pull, dist || 0);
      const nx = vx / (dist || 1);
      const ny = vy / (dist || 1);

      it.x += nx * step;
      it.y += ny * step;

      // –ª—ë–≥–∫–∏–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –Ω–∞–º—ë–∫: —á—É—Ç—å —É–≤–µ–ª–∏—á–∏–º –º–æ–Ω–µ—Ç–∫—É, –∫–æ–≥–¥–∞ –≤ –∑–æ–Ω–µ –º–∞–≥–Ω–∏—Ç–∞
      it.el.style.transform = 'translate(-50%,-50%) scale(1.08)';
    } else {
      it.el.style.transform = 'translate(-50%,-50%)';
    }
  } else {
    // –≤–Ω–µ –º–∞–≥–Ω–∏—Ç–∞ ‚Äî –æ–±—ã—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    it.el.style.transform = 'translate(-50%,-50%)';
  }

  positionItem(it);
}


    // passed score
    for (const p of pipes){
      if (!p.passed && p.x + (ASSETS.pipes.width||76) < birdX){
        p.passed = true; score += 1; setScore(score); haptic('light');
      }
    }

    // remove off-screen
    while (pipes.length && pipes[0].x < -(ASSETS.pipes.width||76)-2){ removePipe(pipes[0]); pipes.shift(); }
    while (items.length && items[0].x < -80){ removeItem(items[0]); items.shift(); }

    // collisions
    collideItems();
    if (started && collidePipe()){
      if (shieldActive){
        // –≥–∞—Å–∏–º —â–∏—Ç –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ —Ç—Ä—É–±—ã –∏ –¥–∞—ë–º –º–∏–∫—Ä–æ-–æ—Ç–¥–∞—á—É
        shieldActive = false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';
        birdVY = -260;
      } else {
        crash(); return;
      }
    }

    // spawn pipes
    if (now - spawnT > PIPE_SPAWN_MS){ spawnT = now; spawnPipe(); }

    // HUD
    applyBird();
    updateShieldHud();

    raf = requestAnimationFrame(tick);
  }

  function crash(){ haptic('heavy'); finish(); }
  function finish(){
    running=false; cancelAnimationFrame(raf);
    if (score > best){ best=score; try{ localStorage.setItem('flappy_best', String(best)); }catch(_){ } }
    document.getElementById('fl-best').textContent = best;
    document.getElementById('fl-world').textContent = WORLD_RECORD;
    resBox.classList.add('show'); cta.classList.add('show');
  }

  function resetScene(){
    // clear
    pipes.forEach(removePipe); pipes = [];
    items.forEach(removeItem); items = [];
    coins=0; setCoins(0);
    shieldActive=false; birdEl.classList.remove('fl-bird--shield'); shBar.style.transform = 'scaleX(0)';
    // bird
    started=false; score=0; setScore(0);
    hintEl.style.display = '';
    birdVY = 0; birdEl.style.transform = 'translate(-50%,-50%) rotate(0deg)';
    layout();
    // spawn timer
    spawnT = performance.now() + 400;
    tick._prev = performance.now();
  }

  function openFlappy(){
    root.classList.add('is-open'); document.body.classList.add('flappy-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closeFlappy();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    resBox.classList.remove('show'); cta.classList.remove('show');

    applyAssets();
    layout(); resetScene();

    running = true; t0 = performance.now(); raf = requestAnimationFrame(tick);
  }

  function closeFlappy(){
    running=false; cancelAnimationFrame(raf);
    root.classList.remove('is-open'); document.body.classList.remove('flappy-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  // controls
  stage.addEventListener('pointerdown', (e)=>{ e.preventDefault(); flap(); }, {passive:false});
  document.addEventListener('keydown', (e)=>{
    if (!root.classList.contains('is-open')) return;
    if (e.code==='Space' || e.key==='ArrowUp'){ e.preventDefault(); flap(); }
    if (e.key==='Escape'){ closeFlappy(); }
  });

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closeFlappy(); openFlappy();
  });

  // openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-flappy]'); if (!t) return;
    e.preventDefault(); openFlappy();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-flappy]')) closeFlappy();
  });

  // resize
  const ro = new ResizeObserver(()=> layout());
  ro.observe(stage);
})();
</script>

<script>
/* ===== Memory Pairs 3√ó4 ‚Äî flips, timer, moves, BackButton ===== */
(function memoryPairs(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root  = document.getElementById('pairs'); if (!root) return;
  const grid  = document.getElementById('mp-grid');
  const timeEl= document.getElementById('mp-time');
  const movesEl=document.getElementById('mp-moves');
  const resBox= document.getElementById('mp-result');
  const yourT = document.getElementById('mp-your-time');
  const bestT = document.getElementById('mp-best-time');
  const cta   = document.getElementById('mp-cta');

  // ===== ASSETS: —ç–º–æ–¥–∑–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–∏ =====
  const ASSETS = {
    mode: 'emoji',  // 'emoji' | 'images'
    emoji: ['üéÉ','üëª','üï∏Ô∏è','üç≠','üß©','‚≠ê'], // 6 –ø–∞—Ä ‚Üí 12 –∫–∞—Ä—Ç
    images: [
      // 'assets/pairs/01.png','assets/pairs/02.png','assets/pairs/03.png',
      // 'assets/pairs/04.png','assets/pairs/05.png','assets/pairs/06.png'
    ]
  };

  // STATE
  let values = [];          // 12 –∑–Ω–∞—á–µ–Ω–∏–π (6√ó2)
  let first = null;         // {idx, val, el}
  let lock  = false;        // –±–ª–æ–∫ –∫–ª–∏–∫–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏
  let matched = 0;          // —Å–æ–≤–ø–∞–≤—à–∏–µ –ø–∞—Ä—ã
  let moves = 0;

  // timer
  let running=false, t0=0, raf=0, backOff=null;
  let bestMs = Number(localStorage.getItem('pairs_best_ms')||0);

  // utils
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const shuffle = (a)=>{ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; };
  const fmt = (ms)=>{
    const s = Math.floor(ms/1000), m = Math.floor(s/60), sec = s%60, tenths = Math.floor((ms%1000)/100);
    return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}.${tenths}`;
  };

  // build deck
  function buildValues(){
    const src = (ASSETS.mode==='images' ? ASSETS.images : ASSETS.emoji).slice(0,6);
    const deck = shuffle([...src, ...src]); // 12 –∫–∞—Ä—Ç
    values = deck;
  }

  function cardTemplate(i, val){
    const isImg = (ASSETS.mode==='images');
    const frontStyle = isImg ? `class="mp-face mp-face--front mp-front-img" style="background-image:url('${val}');"` : `class="mp-face mp-face--front"`;
    const frontInner = isImg ? '' : val;
    return `
      <button class="mp-card" data-idx="${i}" aria-label="card">
        <span class="mp-in">
          <i class="mp-face mp-face--back"></i>
          <i ${frontStyle}>${frontInner}</i>
        </span>
      </button>
    `;
  }

  function drawGrid(){
    grid.innerHTML = values.map((v,i)=> cardTemplate(i,v)).join('');
  }

  function reset(){
    matched = 0; moves = 0; movesEl.textContent = '0';
    first = null; lock = false; running=false; cancelAnimationFrame(raf);
    timeEl.textContent = '00:00.0';
    resBox.classList.remove('show'); cta.classList.remove('show');
    buildValues(); drawGrid();
  }

  function startTimer(){
    if (running) return;
    running = true; t0 = performance.now();
    tick();
  }
  function tick(){
    if (!running){ cancelAnimationFrame(raf); return; }
    const ms = performance.now() - t0;
    timeEl.textContent = fmt(ms);
    raf = requestAnimationFrame(tick);
  }

  function finish(){
    running=false; cancelAnimationFrame(raf);
    const ms = performance.now() - t0;
    yourT.textContent = fmt(ms);

    if (bestMs===0 || ms < bestMs){ bestMs = ms; try{ localStorage.setItem('pairs_best_ms', String(bestMs)); }catch(_){} }
    bestT.textContent = fmt(bestMs || ms);

    resBox.classList.add('show'); cta.classList.add('show');
    haptic('medium');
  }

  // flip logic
  function onCardClick(btn){
    if (lock) return;
    const idx = Number(btn.getAttribute('data-idx'));
    const val = values[idx];

    if (btn.disabled) return;       // —É–∂–µ —Å–æ–≤–ø–∞–ª–∞
    if (!running) startTimer();     // –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä

    // flip
    btn.classList.add('is-flipped'); haptic('light');

    if (!first){
      first = { idx, val, el: btn };
      return;
    }

    // –≤—Ç–æ—Ä–æ–π –∫–ª–∏–∫
    moves += 1; movesEl.textContent = String(moves);
    lock = true;

    if (val === first.val && idx !== first.idx){
      // MATCH
      setTimeout(()=>{
        btn.disabled = true; first.el.disabled = true;
        btn.classList.add('is-matched'); first.el.classList.add('is-matched');
        matched += 1;
        first = null; lock = false;
        haptic('medium');
        if (matched === 6){ finish(); }
      }, 120);
    } else {
      // MISMATCH
      btn.classList.add('is-wrong'); first.el.classList.add('is-wrong');
      haptic('light');
      setTimeout(()=>{
        btn.classList.remove('is-flipped','is-wrong');
        first.el.classList.remove('is-flipped','is-wrong');
        first = null; lock = false;
      }, 650);
    }
  }

  // open/close
  function openPairs(){
    reset();

    root.classList.add('is-open'); document.body.classList.add('pairs-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closePairs();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    grid.addEventListener('click', gridHandler, { passive:true });
  }

  function closePairs(){
    running=false; cancelAnimationFrame(raf);
    grid.removeEventListener('click', gridHandler);
    root.classList.remove('is-open'); document.body.classList.remove('pairs-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  function gridHandler(e){
    const b = e.target.closest('.mp-card'); if (!b) return;
    if (!b.classList.contains('is-flipped')) onCardClick(b);
  }

  // CTA
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closePairs(); openPairs();
  });

  // openers
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-pairs]'); if (!t) return;
    e.preventDefault(); openPairs();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-pairs]')) closePairs();
  });

  // Esc desktop
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closePairs(); });
})();
</script>

<script>
/* ===== Flick Coin ‚Äî physics, holes, bumpers, guide & magnet (patched) ===== */
(function flickCoin(){
  'use strict';
  const TG = window.Telegram && window.Telegram.WebApp;

  // DOM
  const root   = document.getElementById('flick'); if (!root) return;
  const stage  = document.getElementById('fk-stage');
  const coinEl = document.getElementById('fk-coin');
  const scoreEl= document.getElementById('fk-score');
  const shotsEl= document.getElementById('fk-shots');
  const resBox = document.getElementById('fk-result');
  const bestEl = document.getElementById('fk-best');
  const totalEl= document.getElementById('fk-total');
  const cta    = document.getElementById('fk-cta');
  const powerBtns = Array.from(document.querySelectorAll('.fk-power'));
  const guidePoly = document.getElementById('fk-poly');

  /* ===== CONFIG ===== */
  const SHOTS_MAX = 5;
  const BASE_SCORE = 100;
  const WALL_BONUS = 0.5;      // +50% –µ—Å–ª–∏ –±—ã–ª —Ä–∏–∫–æ—à–µ—Ç –æ—Ç —Å—Ç–µ–Ω/–±–∞–º–ø–µ—Ä–æ–≤

  // —Ñ–∏–∑–∏–∫–∞
  const GRAVITY   = 900;       // px/s^2
  const FRICTION  = 0.995;     // –∞—ç—Ä–æ–¥—Ä–∞–≥
  const BOUNCE    = 0.72;      // —É–ø—Ä—É–≥–æ—Å—Ç—å
  const SPEED_MAX = 1600;      // –∫–∞–ø —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
  const START_ZONE_H = 200;    // –Ω–∏–∂–Ω—è—è –∑–æ–Ω–∞, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π —Ä–∞–∑—Ä–µ—à—ë–Ω —Ñ–ª–∏–∫

  // ¬´–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É–¥–∞—Ä¬ª, –µ—Å–ª–∏ —Ç–∞–ø –±–µ–∑ —Å–≤–∞–π–ø–∞
  const MIN_KICK = 650;        // —Å–∫–æ—Ä–æ—Å—Ç—å –≤–≤–µ—Ä—Ö –ø—Ä–∏ –∫–æ—Ä–æ—Ç–∫–æ–º —Ç–∞–ø–µ

  // –ª—É–Ω–∫–∏ (x –∫–∞–∫ –¥–æ–ª—è —à–∏—Ä–∏–Ω—ã, y ‚Äî –ø–∏–∫—Å–µ–ª–∏ —Å–≤–µ—Ä—Ö—É)
  const HOLES = [
    { fx:.18, y:90, r:42, mult:1 },
    { fx:.50, y:90, r:42, mult:2 },
    { fx:.82, y:90, r:42, mult:3 }
  ];

  // –±–∞–º–ø–µ—Ä—ã
  const BUMPERS = [
    { x:  60, y:260, w: 90, h:14, vx: 95 },
    { x: 320, y:360, w: 90, h:14, vx:-115 }
  ];

  // –ø–∞—É—ç—Ä-–∞–ø—ã
  let hasGuide   = true;       // –≤—ã–¥–∞–Ω—ã –Ω–∞ —Ä–∞—É–Ω–¥
  let hasMagnet  = true;
  const MAGNET_RADIUS = 120;
  const MAGNET_PULL   = 480;   // px/s –∫ —Ü–µ–Ω—Ç—Ä—É –±–ª–∏–∂–∞–π—à–µ–π –ª—É–Ω–∫–∏

  /* ===== STATE ===== */
  let w=0,h=0, best=Number(localStorage.getItem('flick_best')||0);
  let shots=0, score=0;
  let coin = { x:0,y:0, vx:0,vy:0, flying:false, banked:false };
  let holes=[], bumpers=[];
  let running=false, raf=0, backOff=null;
  let aim={ down:false, sx:0,sy:0, t0:0 };
  let guideArmed=false, magnetArmed=false;

  /* ===== Utils ===== */
  const haptic = lvl=>{ try{ TG?.HapticFeedback?.impactOccurred(lvl||'light'); }catch(_){} };
  const clamp  = (v,a,b)=> Math.max(a, Math.min(b, v));
  const dist   = (ax,ay,bx,by)=> Math.hypot(ax-bx, ay-by);
  const now    = ()=> performance.now();

  /* ===== Build targets ===== */
  function buildTargets(){
    holes.forEach(h=>h.el.remove()); holes=[];
    bumpers.forEach(b=>b.el.remove()); bumpers=[];

    HOLES.forEach(cfg=>{
      const el = document.createElement('div'); el.className='fk-hole';
      const ring = document.createElement('i'); ring.className='fk-hole__ring';
      const core = document.createElement('b'); core.className='fk-hole__core';
      const lbl  = document.createElement('span'); lbl.className='fk-hole__lbl'; lbl.textContent = `x${cfg.mult}`;
      el.append(ring, core, lbl); stage.appendChild(el);
      holes.push({ cfg, el, cx:0, cy:cfg.y, r:cfg.r });
    });

    BUMPERS.forEach(cfg=>{
      const el = document.createElement('div'); el.className='fk-bumper';
      stage.appendChild(el);
      bumpers.push({ ...cfg, el, x0: cfg.x });
    });
  }

  function layout(){
    w = stage.clientWidth; h = stage.clientHeight;
    holes.forEach(hh=>{ hh.cx = w * hh.cfg.fx; hh.cy = hh.cfg.y; hh.r = hh.cfg.r; positionHole(hh); });
    bumpers.forEach(bb=> positionBumper(bb));
    if (!coin.flying){
      coin.x = w/2; coin.y = h - START_ZONE_H/2; applyCoin();
    }
    // SVG viewport –¥–ª—è –≥–∏–¥–∞
    guidePoly.ownerSVGElement.setAttribute('viewBox', `0 0 ${w} ${h}`);
  }
  const positionHole = h=>{ const s=h.el.style; s.left=(h.cx-42)+'px'; s.top=(h.cy-42)+'px'; };
  const positionBumper = b=>{ const s=b.el.style; s.left=(b.x - b.w/2)+'px'; s.top=(b.y - b.h/2)+'px'; s.width=b.w+'px'; s.height=b.h+'px'; };
  function applyCoin(){ coinEl.style.left = coin.x+'px'; coinEl.style.top = coin.y+'px'; }

  /* ===== Open / Close ===== */
  function openFlick(){
    root.classList.add('is-open'); document.body.classList.add('flick-open');
    try{
      TG?.BackButton?.show?.();
      backOff = ()=> closeFlick();
      TG?.BackButton?.onClick?.(backOff);
      TG?.disableVerticalSwipes?.(); TG?.expand?.();
    }catch(_){}

    guideArmed = hasGuide;
    magnetArmed = hasMagnet;
    updatePowerButtons();

    shots=0; score=0; updateHud();
    buildTargets(); layout();
    resBox.classList.remove('show'); cta.classList.remove('show');

    running=true; raf=requestAnimationFrame(tick);
  }
  function closeFlick(){
    running=false; cancelAnimationFrame(raf);
    root.classList.remove('is-open'); document.body.classList.remove('flick-open');
    try{ TG?.BackButton?.offClick?.(backOff); TG?.BackButton?.hide?.(); }catch(_){}
  }

  function updateHud(){
    scoreEl.textContent = score;
    shotsEl.textContent = `${shots}/${SHOTS_MAX}`;
  }
  function updatePowerButtons(){
    powerBtns.forEach(b=>{
      const k=b.dataset.power;
      b.classList.toggle('is-on', k==='guide' ? guideArmed : magnetArmed);
    });
  }

  /* ===== Input (patched) ===== */
  stage.addEventListener('pointerdown', (e)=>{
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    if (coin.flying) return;

    // —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –º–æ–∂–Ω–æ –ò–õ–ò –∏–∑ –Ω–∏–∂–Ω–µ–π –∑–æ–Ω—ã, –ò–õ–ò ¬´—Å –º–æ–Ω–µ—Ç—ã¬ª
    const onCoin = Math.hypot(x - coin.x, y - coin.y) <= 40;
    const inStartZone = y >= h - START_ZONE_H;
    if (!onCoin && !inStartZone) return;

    aim = { down:true, sx:x, sy:y, t0: now() };
    coinEl.classList.add('is-aim');
    if (guideArmed) drawGuideFrom(x,y);
  }, {passive:true});

  stage.addEventListener('pointermove', (e)=>{
    if (!aim.down) return;
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;
    if (guideArmed) drawGuideFrom(aim.sx, aim.sy, x,y);
  }, {passive:true});

  stage.addEventListener('pointerup', (e)=>{
    if (!aim.down) return;
    const rect = stage.getBoundingClientRect();
    const x = e.clientX - rect.left, y = e.clientY - rect.top;

    const dt = Math.max(16, now() - aim.t0);
    let vx = (aim.sx - x) / dt * 800;
    let vy = (aim.sy - y) / dt * 800;

    // –µ—Å–ª–∏ ¬´–ø–æ—á—Ç–∏ —Ç–∞–ø¬ª ‚Äî –∑–∞–¥–∞—ë–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É–¥–∞—Ä –≤–≤–µ—Ä—Ö
    const drag = Math.hypot(aim.sx - x, aim.sy - y);
    if (drag < 10){ vx = 0; vy = -MIN_KICK; }

    // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
    const sp = Math.hypot(vx,vy);
    if (sp > SPEED_MAX){ const k = SPEED_MAX/sp; vx*=k; vy*=k; }

    startShot(vx, vy);
    coinEl.classList.remove('is-aim');
    aim.down=false;
    clearGuide();
  }, {passive:true});

  function startShot(vx,vy){
    if (coin.flying || shots >= SHOTS_MAX) return;
    shots++; updateHud();
    coin.flying=true; coin.vx=vx; coin.vy=vy; coin.banked=false;
    haptic('light');
    if (guideArmed){ guideArmed=false; updatePowerButtons(); }
  }

  /* ===== Guide (preview) ===== */
  function drawGuideFrom(sx,sy, mx, my){
    const pvx = ((sx - (mx??sx)) / Math.max(16, now()-aim.t0)) * 800;
    const pvy = ((sy - (my??(sy-80))) / Math.max(16, now()-aim.t0)) * 800;
    const pts = [];
    let x = coin.x, y = coin.y, vx=pvx, vy=pvy;
    let step=24;
    for (let i=0;i<50;i++){
      vy += GRAVITY * (step/1000);
      x += vx * (step/1000);
      y += vy * (step/1000);
      if (x<28){ x=28; vx = -vx*BOUNCE; }
      if (x>w-28){ x=w-28; vx = -vx*BOUNCE; }
      pts.push(`${x},${y}`);
      if (y<0 || y>h) break;
    }
    guidePoly.setAttribute('points', pts.join(' '));
  }
  function clearGuide(){ guidePoly.setAttribute('points',''); }

  /* ===== Loop ===== */
  function tick(){
    const t = performance.now();
    const dt = Math.min(32, tick._prev ? t - tick._prev : 16); tick._prev = t;

    // move bumpers
    for (const b of bumpers){
      b.x += b.vx * dt/1000;
      if (b.x <= 40 || b.x >= w-40){ b.vx *= -1; }
      positionBumper(b);
    }

    if (coin.flying){
      // –º–∞–≥–Ω–∏—Ç –∫ –±–ª–∏–∂–∞–π—à–µ–π –ª—É–Ω–∫–µ
      if (magnetArmed){
        let bestH=null, bd=1e9;
        for (const h of holes){ const d=dist(coin.x,coin.y,h.cx,h.cy); if (d<bd){ bd=d; bestH=h; } }
        if (bestH && bd < MAGNET_RADIUS){
          const nx=(bestH.cx-coin.x)/(bd||1), ny=(bestH.cy-coin.y)/(bd||1);
          coin.vx += nx * MAGNET_PULL * dt/1000;
          coin.vy += ny * MAGNET_PULL * dt/1000;
        }
      }

      // —Ñ–∏–∑–∏–∫–∞
      coin.vy += GRAVITY * dt/1000;
      coin.x  += coin.vx * dt/1000;
      coin.y  += coin.vy * dt/1000;
      coin.vx *= FRICTION; coin.vy *= FRICTION;

      // —Å—Ç–µ–Ω—ã
      if (coin.x < 28){ coin.x=28; coin.vx=-coin.vx*BOUNCE; coin.banked=true; haptic('light'); }
      if (coin.x > w-28){ coin.x=w-28; coin.vx=-coin.vx*BOUNCE; coin.banked=true; haptic('light'); }
      if (coin.y < 28){ coin.y=28; coin.vy=-coin.vy*BOUNCE; haptic('light'); }

      // –±–∞–º–ø–µ—Ä—ã (AABB vs circle)
      for (const b of bumpers){
        if (circleRectOverlap(coin.x,coin.y, 28, b.x-b.w/2,b.y-b.h/2,b.w,b.h)){
          coin.y = (coin.y < b.y ? b.y - b.h/2 - 28 : b.y + b.h/2 + 28);
          coin.vy = -coin.vy * BOUNCE;
          coin.banked=true;
          haptic('light');
        }
      }

      // –ø–æ–ø–∞–¥–∞–Ω–∏–µ –≤ –ª—É–Ω–∫—É
      for (const h of holes){
        const d = dist(coin.x,coin.y, h.cx,h.cy);
        if (d <= h.r * 0.6){
          const gained = Math.round(BASE_SCORE * h.cfg.mult * (coin.banked ? (1+WALL_BONUS) : 1));
          score += gained; updateHud();
          coin.x=h.cx; coin.y=h.cy; coin.vx=0; coin.vy=0; coin.flying=false;
          haptic('medium'); flashHole(h.el);
          endIfNeeded(); break;
        }
      }

      // –ø—Ä–æ–º–∞—Ö ‚Äî —É—à–ª–∞ –∑–∞ –Ω–∏–∑ –∏–ª–∏ ¬´–∑–∞—Ç—É—Ö–ª–∞¬ª —É –Ω–∏–∑–∞
      if (coin.y > h + 40 || (Math.abs(coin.vx)<10 && Math.abs(coin.vy)<10 && coin.y > h-60)){
        coin.flying=false; endIfNeeded();
      }
    }

    applyCoin();
    raf = requestAnimationFrame(tick);
  }

  function endIfNeeded(){
    if (shots >= SHOTS_MAX && !coin.flying){
      finish();
    } else {
      setTimeout(()=>{ coin.x=w/2; coin.y=h-START_ZONE_H/2; coin.vx=coin.vy=0; applyCoin(); }, 250);
    }
  }

  function finish(){
    if (score > best){ best=score; try{ localStorage.setItem('flick_best', String(best)); }catch(_){} }
    bestEl.textContent = best;
    totalEl.textContent = score;
    resBox.classList.add('show'); cta.classList.add('show');
  }

  /* ===== Helpers ===== */
  function flashHole(el){ el.style.transform='scale(1.06)'; setTimeout(()=> el.style.transform='', 160); }
  function circleRectOverlap(cx,cy,r, rx,ry,rw,rh){
    const nx = clamp(cx, rx, rx+rw);
    const ny = clamp(cy, ry, ry+rh);
    return ( (cx-nx)**2 + (cy-ny)**2 ) <= r*r;
  }

  /* ===== Powers ===== */
  powerBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const k = btn.dataset.power;
      if (k==='guide'){ guideArmed = !guideArmed && hasGuide; }
      if (k==='magnet'){ magnetArmed = !magnetArmed && hasMagnet; }
      updatePowerButtons();
    });
  });

  /* ===== CTA / Openers ===== */
  cta.addEventListener('click', (e)=>{
    if (!e.target.closest('.btn')) return;
    closeFlick(); openFlick();
  });

  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-flick]'); if (!t) return;
    e.preventDefault(); openFlick();
  });
  document.addEventListener('click', (e)=>{
    if (e.target.closest('[data-close-flick]')) closeFlick();
  });

  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeFlick(); });

  /* ===== Resize ===== */
  const ro = new ResizeObserver(()=> layout());
  ro.observe(stage);
})();
</script>


</body>
</html>
