<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥ ‚Äî –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b0c15; --text:#f4f6fa; --muted:#a7acc2;
      --primary:#7b5bff; --mint:#3de0c5; --blue:#5b8cff;
      --card:rgba(255,255,255,.05); --stroke:rgba(255,255,255,.10);
      --toast:#0f1221; --border:rgba(255,255,255,.10);
      --radius:14px; --pad:14px; --content-max:1080px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{max-width:var(--content-max);margin:0 auto;padding:16px 14px 48px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .brand-wrap{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:9px;background:#0f1318;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .brand{font-family:Montserrat,Inter,sans-serif;font-weight:700;letter-spacing:.2px}

    nav#spa-nav{position:sticky;top:0;z-index:20;display:flex;gap:8px;overflow:hidden;padding:6px;margin:8px 0 18px;background:rgba(10,12,22,.65);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.35);justify-content:flex-start;align-items:center}
    #spa-nav .track{ position:relative; display:flex; gap:8px; overflow-x:auto; -ms-overflow-style:none; scrollbar-width:none; padding:6px 8px; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; scroll-snap-stop:always; overscroll-behavior-x:contain; align-items:center; touch-action:pan-x; }
    #spa-nav .track::-webkit-scrollbar{display:none}
#spa-nav .btn{appearance:none;border:1px solid transparent;background:transparent;color:var(--text);font-weight:700;font-size:14px;padding:9px 12px;border-radius:12px;cursor:pointer;text-decoration:none;transition:.18s;white-space:nowrap;position:relative;flex:0 0 auto;z-index:1;-webkit-tap-highlight-color:transparent;scroll-snap-align:center; scroll-snap-stop:always; }
    #spa-nav .btn.active{background:transparent;color:var(--text);box-shadow:none}
    #spa-nav .bubble{position:absolute;z-index:0;height:34px;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--mint));box-shadow:0 10px 22px rgba(91,140,255,.35);left:0;top:50%;transform:translateY(-50%);transition:left .12s cubic-bezier(.2,.8,.2,1), width .12s cubic-bezier(.2,.8,.2,1);will-change:left,width;pointer-events:none;opacity:.95}
    #spa-nav .bubble.fast{transition:none}
.h1{font-size:19px;line-height:1.2;font-weight:800;margin:14px 0 10px}
    .h1 span{background:linear-gradient(90deg,var(--blue),var(--mint));-webkit-background-clip:text;color:transparent}
    .lead{color:var(--muted);font-size:17px;max-width:820px}

    .grid{display:grid;gap:14px}
    @media(min-width:920px){.grid-2{grid-template-columns:repeat(2,1fr)}.h1{font-size:44px}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:18px;backdrop-filter:blur(8px)}
    .card h3{margin:0 0 8px;font-size:18px}

    .list{list-style:none;margin:0;padding:0;display:grid;gap:10px;color:var(--muted)}
    .list li{display:flex;gap:10px;align-items:flex-start}
    .dot{width:10px;height:10px;border-radius:50%;margin-top:6px;background:linear-gradient(135deg,var(--mint),var(--primary))}
    .btn{appearance:none;border:1px solid var(--border);background:#141a21;color:var(--text);padding:10px 12px;border-radius:14px;cursor:pointer;transition:.18s}
    .btn-primary{background:linear-gradient(135deg,var(--primary),var(--mint));color:#0b0f12;border-color:transparent;font-weight:800}
    .btn-ghost{background:transparent;border-color:var(--border);color:var(--text)}

    .highlight-banner{margin:14px 0;padding:12px 14px;border-radius:12px;background:var(--bg);color:var(--primary);font-weight:600;font-size:15px}

    /* Calendar */
    .cal-wrap{display:grid;gap:12px}
    .dur-row{display:flex;gap:8px;flex-wrap:wrap}
    .calendar{user-select:none;background:#0f141a;border:1px solid var(--border);border-radius:12px;padding:10px}
    .cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .cal-head .mon{font-weight:800}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-cell{height:36px;display:grid;place-items:center;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);font-weight:600;cursor:pointer;transition:transform .15s ease, background .15s ease, color .15s ease}
    .cal-cell:hover{transform:translateY(-1px)}
    .cal-cell.muted{opacity:.35}
    .cal-cell.off{opacity:.25;pointer-events:none}
    .cal-cell.sel{color:#0b0f12;background:linear-gradient(135deg,var(--primary),var(--mint));border-color:transparent}
    .cal-dow{opacity:.6;font-weight:700;font-size:12px}

    .slots{display:flex;gap:8px;flex-wrap:wrap;opacity:0;transform:translateY(4px);transition:all .2s ease}
    .slots.show{opacity:1;transform:translateY(0)}
    .contact-row{display:flex;gap:8px;flex-wrap:wrap}
    input[type="tel"],input[type="text"]{flex:1;min-width:220px;background:#0f141a;border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px 12px;font-size:16px;outline:none}
    input::placeholder{color:#6e7786}

    /* Toasts */
    .toasts{position:fixed;right:12px;bottom:12px;display:grid;gap:8px;z-index:99999}
    .toast{background:#0f1318;border:1px solid var(--border);border-radius:12px;padding:10px 12px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .toast .t{font-weight:800;margin-bottom:2px}
    .toast .m{font-size:13px;color:var(--muted)}
  

/* === HOME blocks (calc + steps) === */
.savings { display:grid; gap:8px; }
.savings .row{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.savings .row label{ font-size:14px; opacity:.9; }
.savings input[type=range]{ width:50%; }
.savings .stat{ display:flex; gap:8px; flex-wrap:wrap; }
.big{ font-size:28px; font-weight:800; letter-spacing:0.3px; }
</style>
  <style>
    /* Tables */
    .table{width:100%;border-collapse:separate;border-spacing:0 8px}
    .table th{font-size:12px;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);text-align:left;padding:4px 8px}
    .table td{background:rgba(255,255,255,.03);border:1px solid var(--border);padding:10px 12px;border-radius:10px}
    .table tr td:first-child{border-top-right-radius:0;border-bottom-right-radius:0}
    .table tr td:last-child{border-top-left-radius:0;border-bottom-left-radius:0}
    .pill{display:inline-block;padding:2px 8px;border-radius:9999px;border:1px solid var(--border);font-size:12px;color:var(--muted)}
    .muted-sm{color:var(--muted);font-size:13px}
  </style>
  <!-- overrides for nav menu look & behavior -->
  <style>
    /* Center the nav row and keep carousel scroll */
    nav#spa-nav{ justify-content:flex-start; }
    #spa-nav .track{ position:relative; display:flex; gap:8px; overflow-x:auto; -ms-overflow-style:none; scrollbar-width:none; padding:6px 8px; -webkit-overflow-scrolling:touch; scroll-snap-type:x proximity; }

    /* Buttons sit ABOVE the moving bubble so text is never covered */
    #spa-nav .btn{ position:relative; z-index:1; -webkit-tap-highlight-color: transparent; }
    /* Do not visually highlight active button itself */
    #spa-nav .btn.active{ background:transparent !important; color:var(--text) !important; box-shadow:none !important; }
    #spa-nav .btn:active{ transform:none; }

    /* Bubble floats under text and doesn't catch clicks */
    #spa-nav .bubble{ z-index:0; pointer-events:none; opacity:.92; }
  </style>
  <style>
    /* Bottom sheet (–ø—Ä–æ—Ñ–∏–ª—å) + backdrop */
    .sheet-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(3px);opacity:0;pointer-events:none;transition:.18s;z-index:999}
    .sheet{position:fixed;left:0;right:0;bottom:-100%;background:rgba(20,22,35,.98);border-top-left-radius:18px;border-top-right-radius:18px;box-shadow:0 -10px 40px rgba(0,0,0,.5);transition:transform .22s ease, bottom .22s ease;transform:translateY(14px);z-index:1000}
    .sheet.open{bottom:0;transform:none}
    .sheet-backdrop.open{opacity:1;pointer-events:auto}
    .sheet .grab{width:44px;height:5px;border-radius:99px;background:rgba(255,255,255,.18);margin:8px auto 4px}
    .sheet .head{padding:8px 14px 6px;display:flex;align-items:center;justify-content:space-between}
    .sheet .title{font-weight:800}
    .sheet .body{padding:4px 14px 14px}
    .profile-toggle{position:fixed;right:14px;bottom:14px;z-index:1001}
    .profile-list{display:grid;gap:8px}
    .profile-item{background:rgba(255,255,255,.03);border:1px solid var(--stroke);border-radius:12px;padding:10px 12px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand-wrap">
        <div class="logo" aria-label="logo"></div>
        <div>
          <div class="brand">–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥</div>
          <div class="slogan" style="color:var(--muted);font-size:13px">–°—á–∏—Ç–∞–µ–º –ø—Ä–∏–±—ã–ª—å, –∞ –Ω–µ –∫–ª–∏–∫–∏</div>
        </div>
      </div>
    </header>

    <nav id="spa-nav"><div class="track">
      <a class="btn active" data-page="home" href="#home">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a class="btn" data-page="services" href="#services">üß© –£—Å–ª—É–≥–∏</a>
      <a class="btn" data-page="about" href="#about">üë©‚Äçüíº –û–±–æ –º–Ω–µ</a>
      <a class="btn" data-page="bonuses" href="#bonuses">üéÅ –ë–æ–Ω—É—Å—ã</a>
      <a class="btn" data-page="history" href="#history">üìã –ò—Å—Ç–æ—Ä–∏—è</a>
      <a class="btn" data-page="consult" href="#consult">üìÖ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</a>
      <a class="btn" data-page="invite" href="#invite">üéØ –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</a>
      <span class="bubble" aria-hidden="true"></span>
    </div></nav>

    <main>
      <!-- HOME -->
      <section class="card" id="home">
          <h2>–£—Å–ª—É–≥–∏</h2>
        <p class="muted-sm">–†–∞–∑–¥–µ–ª-–∑–∞–≥–ª—É—à–∫–∞. –°–∫–∞–∂–∏, —á—Ç–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å –∏–∑ —Ç–≤–æ–µ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî –≤—Å—Ç–∞–≤–ª—é –∫–æ–Ω—Ç–µ–Ω—Ç –±–ª–æ–∫–∞–º–∏.</p>
      </section>
  <div class="grid grid-2" style="margin-top:14px">
    <!-- –ë—ã—Å—Ç—Ä—ã–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏ –±–∏–∑–Ω–µ—Å–∞ -->
    <div class="card savings">
      <div class="h1">–ë—ã—Å—Ç—Ä—ã–π <span>—Ä–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏</span> –±–∏–∑–Ω–µ—Å–∞</div>

      <div class="row">
        <label>–í—ã—Ä—É—á–∫–∞: <strong id="revVal">10 000 000 ‚ÇΩ</strong></label>
        <input id="rev" type="range" min="500000" max="50000000" step="500000" value="10000000">
      </div>

      <div class="row">
        <label>–≠—Ñ—Ñ–µ–∫—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: <strong id="pctVal">12%</strong></label>
        <input id="pct" type="range" min="1" max="30" step="1" value="12">
      </div>

      <div class="stat">
        <div class="badge">–ë—ã–ª–æ: <span id="oldTax">1 500 000 ‚ÇΩ</span></div>
        <div class="badge">–°—Ç–∞–ª–æ: <span id="newTax">1 320 000 ‚ÇΩ</span></div>
      </div>

      <div>–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è:</div>
      <div class="big" id="saveCounter">0 ‚ÇΩ</div>

      <div class="cta">
        <button class="btn btn-primary confetti" id="ctaCalc">–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</button>
      </div>
    </div>

    <!-- –ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º -->
    <div class="card" style="margin-bottom:12px">
      <div class="h1" style="margin-bottom:20px">–ö–∞–∫ <span>–º—ã</span> —Ä–∞–±–æ—Ç–∞–µ–º</div>
      <div id="flow" style="display:grid;gap:8px">
        <div class="badge">–®–∞–≥ 1 ¬∑ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</div>
        <div class="badge">–®–∞–≥ 2 ¬∑ –ü–ª–∞–Ω –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</div>
        <div class="badge">–®–∞–≥ 3 ¬∑ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ</div>
        <div class="badge">–®–∞–≥ 4 ¬∑ –ö–æ–Ω—Ç—Ä–æ–ª—å –∏ –æ—Ç—á—ë—Ç—ã</div>
      </div>
      <div class="cta" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn btn-primary" id="flowNext">–î–∞–ª—å—à–µ</button>
        <button class="btn btn-ghost" id="flowReset">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ -->
  <div class="card">
    <div class="h1" style="margin-bottom:20px">–ß—Ç–æ <span>–¥–µ–ª–∞—Ç—å</span> –¥–∞–ª—å—à–µ</div>
    <ul class="list">
      <li><span class="dot"></span>–ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤ –±–æ—Ç–µ</li>
      <li><span class="dot"></span>–§–∏–∫—Å–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ ¬´—É—Ç–µ—á–µ–∫¬ª</li>
      <li><span class="dot"></span>–§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω</li>
    </ul>
    <div class="highlight-banner" style="text-align:left">
      <strong>–ë–æ–Ω—É—Å:</strong> –º–∏–Ω–∏-–≥–∞–π–¥ ¬´–ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤—ã–≥–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º¬ª
    </div>
  </div>
</section>
      <!-- SERVICES -->
      <section class="card" id="services" style="margin-top:18px;display:none">
        <h2>–£—Å–ª—É–≥–∏</h2>
        <p class="muted-sm">–†–∞–∑–¥–µ–ª-–∑–∞–≥–ª—É—à–∫–∞. –°–∫–∞–∂–∏, —á—Ç–æ –ø–æ–¥—Ç—è–Ω—É—Ç—å –∏–∑ —Ç–≤–æ–µ–≥–æ —Ñ–∞–π–ª–∞ ‚Äî –≤—Å—Ç–∞–≤–ª—é –∫–æ–Ω—Ç–µ–Ω—Ç –±–ª–æ–∫–∞–º–∏.</p>
      </section>

      

      <!-- ABOUT -->
      <section class="card" id="about" style="margin-top:18px;display:none">
        <h2>–û –ø—Ä–æ–µ–∫—Ç–µ</h2>
        <p class="muted-sm">–ö–æ—Ä–æ—Ç–∫–∏–π –±–ª–æ–∫ ¬´–û –Ω–∞—Å¬ª. –ì–æ—Ç–æ–≤ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–≤–æ–π —Ç–µ–∫—Å—Ç/–∫–∞—Ä—Ç–∏–Ω–∫–∏.</p>
      </section>

      <!-- BONUSES -->
      <section class="card" id="bonuses" style="margin-top:18px">
        <h2>–ë–æ–Ω—É—Å—ã</h2>
        <div class="btn-row cta">
          <button class="btn bonus" data-code="–û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é">–û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</button>
          <button class="btn bonus" data-code="–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º">–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º</button>
          <button class="btn bonus" data-code="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø—Ä–µ—Å—Å-–∞—É–¥–∏—Ç">–ü–æ–ª—É—á–∏—Ç—å —ç–∫—Å–ø—Ä–µ—Å—Å‚Äë–∞—É–¥–∏—Ç</button>
        </div>
      </section>

      <!-- WHEEL -->
      <section class="card" id="wheel" style="margin-top:18px">
        <h2>–ö–æ–ª–µ—Å–æ –ø—Ä–∏–∑–æ–≤</h2>
        <div class="cta"><button class="btn" id="spin">–ö—Ä—É—Ç–∏—Ç—å üé°</button></div>
        <div id="spinRes" class="muted">‚Äî</div>
      </section>
      <!-- HISTORY -->
      <section class="card" id="history" style="margin-top:18px;display:none">
        <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
        <div class="muted-sm" style="margin-bottom:8px">–í—ã–ø–∞–≤—à–∏–µ –ø—Ä–∏–∑—ã, –∑–∞—è–≤–∫–∏ –∏ –±–æ–Ω—É—Å—ã. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
        <div class="grid">
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <h3>–°–ø–∏–Ω—ã</h3>
            <table class="table" id="tblSpins">
              <thead><tr><th>–î–∞—Ç–∞</th><th>–ü—Ä–∏–∑</th><th>–ö–æ–º–º–µ–Ω—Ç</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <h3>–ü—Ä–∏–∑—ã</h3>
            <table class="table" id="tblPrizes">
              <thead><tr><th>–î–∞—Ç–∞</th><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–ò—Å—Ç–æ—á–Ω–∏–∫</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <h3>–ë–æ–Ω—É—Å—ã</h3>
            <table class="table" id="tblBonuses">
              <thead><tr><th>–î–∞—Ç–∞</th><th>–¢–∏–ø</th><th>–û—á–∫–∏</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- INVITE / –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞ -->
      <section class="card" id="invite" style="margin-top:18px;display:none">
        <h2>–ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</h2>
        <div class="muted-sm" style="margin-bottom:8px">–î–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π –∏ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã. –°–ø–∏—Å–æ–∫ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –Ω–∏–∂–µ.</div>
        <div class="grid">
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <div><b>–¢–≤–æ—è —Å—Å—ã–ª–∫–∞:</b> <span id="refLink">‚Äî</span></div>
            <div class="muted-sm">–ö–æ–¥: <span id="refCode">‚Äî</span> ¬∑ –ü—Ä–∏–≤–µ–¥–µ–Ω–æ: <span id="refCount">0</span></div>
          </div>
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <h3>–†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
            <table class="table" id="tblRefs">
              <thead><tr><th>–î–∞—Ç–∞</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–°—Ç–∞—Ç—É—Å</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- CONSULT (Calendar) -->
      <section class="card cal-wrap" id="consult" style="margin-top:18px">
        <h2>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</h2>
        <div class="dur-row">
          <button class="btn dur btn-primary" data-min="30">30 –º–∏–Ω</button>
          <button class="btn dur" data-min="60">60 –º–∏–Ω</button>
          <button class="btn dur" data-min="90">90 –º–∏–Ω</button>
        </div>
        <div id="cal" class="calendar"></div>
        <div id="slots" class="slots"></div>
        <div class="contact-row">
          <input id="contact" type="tel" inputmode="numeric" placeholder="@username –∏–ª–∏ +79991234567" />
          <button id="confirmConsult" class="btn btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
      </section>

      <!-- PROFILE (light) -->
      <section class="card" id="profile" style="margin-top:18px">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <div><b>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–∑:</b> <span id="profPrize">‚Äî</span></div>
        <div><b>–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å:</b> <span id="profBook">‚Äî</span></div>
        <div><b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ—á–∫–∏:</b> <span id="profPoints">‚Äî</span></div>
        <div class="muted" id="profHint">–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ; –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è‚Ä¶</div>
      </section>

    </main>

    <!-- Floating Profile button -->
    <button class="btn btn-ghost profile-toggle">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
    <!-- Backdrop + Bottom Sheet -->
    <div class="sheet-backdrop" id="profileBackdrop"></div>
    <section class="sheet" id="profileSheet" aria-hidden="true">
      <div class="grab" aria-hidden="true"></div>
      <div class="head">
        <div class="title">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <button class="btn btn-ghost" id="profileClose">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div class="body">
        <div class="profile-list">
          <div class="profile-item"><b>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–∑:</b> <span id="profileSheetPrize">‚Äî</span></div>
          <div class="profile-item"><b>–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å:</b> <span id="profileSheetBook">‚Äî</span></div>
          <div class="profile-item"><b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ—á–∫–∏:</b> <span id="profileSheetPoints">‚Äî</span></div>
        </div>
      </div>
    </section>

    <div class="toasts" aria-live="polite"></div>
  </div>

  <!-- Telegram SDK (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –≤ WebApp) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    /* ==== CONFIG ==== */
    window.APP_CONFIG = window.APP_CONFIG || {};
    APP_CONFIG.API_BASE = APP_CONFIG.API_BASE || "https://<YOUR-WORKER-DOMAIN>"; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –≤–æ—Ä–∫–µ—Ä
    APP_CONFIG.ENABLE_HOOKS = (APP_CONFIG.ENABLE_HOOKS ?? true);

    /* ==== –ê–≤—Ç–æ–±—Ä–µ–Ω–¥–∏–Ω–≥: –ª–æ–≥–æ—Ç–∏–ø + —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏ ==== */
    (function autoBrand(){
      const host = document.querySelector('.logo');
      if (host){
        const cand = ['logo.svg','logo.png','logo.jpg','logo.webp'];
        (async () => { for (const f of cand){ try{ const r=await fetch(f,{method:'HEAD'}); if(r.ok){ const img=new Image(); img.src=f; img.alt='logo'; img.style.cssText='width:100%;height:100%;object-fit:cover;border-radius:inherit;display:block'; host.innerHTML=''; host.appendChild(img); break; } }catch(_){}} })();
      }
      ['favicon-16.png','favicon.png','favicon.ico','logo.svg'].forEach(h=>{ const l=document.createElement('link'); l.rel='icon'; l.href=h; document.head.appendChild(l); });
    })();

    /* ==== Toast (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è) ==== */
    const __toasts = new Set();
    function showToast(title, msg='', key='', timeout=2600){
      if (key && __toasts.has(key)) return; if (key) __toasts.add(key);
      let box=document.querySelector('.toasts'); const t=document.createElement('div'); t.className='toast';
      t.innerHTML=`<div class="t">${title}</div>${msg?`<div class="m">${msg}</div>`:''}`; box.appendChild(t);
      setTimeout(()=>{ t.remove(); if(key) __toasts.delete(key); }, timeout);
    }

    /* ==== –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —É –∫–Ω–æ–ø–∫–∏ ==== */
    function blastConfetti(btn, count=24){
      try{
        const rect = btn.getBoundingClientRect(); const root=document.createElement('div');
        root.style.cssText = `position:fixed;left:${rect.left}px;top:${rect.top}px;width:${rect.width}px;height:${rect.height}px;pointer-events:none;overflow:visible;z-index:9999`;
        document.body.appendChild(root);
        for(let i=0;i<count;i++){
          const p=document.createElement('i'); const x=rect.width/2, y=rect.height/2; const dx=(Math.random()*2-1)*80, dy=(Math.random()*-1)*120-40; const rot=(Math.random()*360)|0; const size=6+(Math.random()*6|0);
          p.style.cssText=`position:absolute;left:${x}px;top:${y}px;width:${size}px;height:${size}px;background:currentColor;border-radius:2px;transform:translate(-50%,-50%) rotate(${rot}deg);opacity:1`;
          p.style.color=['#7b5bff','#3de0c5','#5b8cff','#ffffff'][i%4]; root.appendChild(p);
          const tx=x+dx, ty=y+dy;
          p.animate([{transform:`translate(-50%,-50%) rotate(${rot}deg)`,opacity:1},{transform:`translate(${tx-rect.left}px,${ty-rect.top}px) rotate(${rot+180}deg)`,opacity:0}],{duration:700+(Math.random()*400|0),easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>p.remove();
        }
        setTimeout(()=>root.remove(),1200);
      }catch(_){}
    }

    /* ==== Telegram context ==== */
    const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null;
    function getTgId(){ try{ return tg?.initDataUnsafe?.user?.id || null }catch(_){ return null } }
    function getStartParam(){ try{ return tg?.initDataUnsafe?.start_param || '' }catch(_){ return '' } }
    function getInitData(){ try{ return tg?.initData || '' }catch(_){ return '' } }
    try{ tg?.ready(); tg?.expand?.(); }catch(_){}

    /* ==== API helpers ==== */
    function qp(base, params){ const u=new URL(base); Object.entries(params||{}).forEach(([k,v])=>{ if(v!==undefined&&v!==null) u.searchParams.set(k,String(v)); }); return u; }
    async function apiGet(path, params){ const r=await fetch(qp(APP_CONFIG.API_BASE+path, params)); const t=await r.text(); try{return JSON.parse(t)}catch{return {ok:false,error:'bad_json',raw:t}} }
    async function apiPost(path, body){ body=body||{}; if(!body.tg_id) body.tg_id=String(getTgId()||''); if(!body._start_param) body._start_param=getStartParam(); if(!body._init_data) body._init_data=getInitData(); const r=await fetch(APP_CONFIG.API_BASE+path,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); const t=await r.text(); try{return JSON.parse(t)}catch{return {ok:false,error:'bad_json',raw:t}} }

    /* ==== –¢–µ–ª–µ—Ñ–æ–Ω: –º—è–≥–∫–∞—è –º–∞—Å–∫–∞ + –∞–Ω—Ç–∏‚Äëzoom ==== */
    (function phoneMask(){ const el=document.getElementById('contact'); if(!el) return; el.setAttribute('inputmode','numeric'); el.setAttribute('autocomplete','tel'); el.style.fontSize='16px'; const fmt=v=>{ const d=(v||'').replace(/\D+/g,''); let p=d; if(p.startsWith('8')) p='7'+p.slice(1); if(!p.startsWith('7')) p='7'+p; return '+'+p.slice(0,11) }; el.addEventListener('input', ()=>{ const s=el.selectionStart, before=el.value, after=fmt(before); el.value=after; const shift=after.length-before.length; el.setSelectionRange(s+shift, s+shift); }); })();

    /* ==== –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç ==== */
    (function personalCalc(){ const btn=document.getElementById('ctaCalc'); if(!btn) return; btn.addEventListener('click', async ()=>{ blastConfetti(btn, 28); showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞','–ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç','calc_sent'); if(!APP_CONFIG.ENABLE_HOOKS) return; try{ await apiPost('/api/prize/code',{code:'–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç'}); }catch(_){}}); })();

    /* ==== –ö–æ–ª–µ—Å–æ –ø—Ä–∏–∑–æ–≤ ==== */
    (function wheel(){ const btn=document.getElementById('spin'), out=document.getElementById('spinRes'); if(!btn||!out) return; btn.addEventListener('click', async ()=>{ blastConfetti(btn, 30); try{ const res=await apiPost('/api/prize/spin',{}); if(res?.ok){ out.textContent='–í—ã–ø–∞–ª–æ: '+(res.prize?.title||'–ø—Ä–∏–∑'); showToast('–ü—Ä–∏–∑ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω','–°–º–æ—Ç—Ä–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ','spin_ok'); } else { out.textContent='–ö—Ä—É—Ç–∏–ª–∫–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞'; showToast('–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ','–í–µ–¥–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ','spin_warn'); } }catch(_){ out.textContent='–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; } }); })();

    /* ==== –ë–æ–Ω—É—Å—ã ==== */
    (function bonuses(){ document.querySelectorAll('.btn.bonus').forEach(btn=>{ btn.addEventListener('click', async ()=>{ const code=btn.dataset.code||'–ë–æ–Ω—É—Å'; blastConfetti(btn,24); showToast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',code,`bonus_${code}`); if(!APP_CONFIG.ENABLE_HOOKS) return; try{ await apiPost('/api/prize/code',{code}); }catch(_){} }); }); })();

    /* ==== –û–Ω–±–æ—Ä–¥–∏–Ω–≥-–±–æ–Ω—É—Å +100 ==== */
    (function welcomeBonus(){ if(localStorage.getItem('onb_bonus_v1')) return; localStorage.setItem('onb_bonus_v1','1'); (async()=>{ try{ await apiPost('/api/bonus/grant',{kind:'welcome',points:100}); }catch(_){ } showToast('+100 –±–æ–Ω—É—Å–æ–≤','–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º üëã','onb100',3000); })(); })();

    /* ================== –ö–ê–õ–ï–ù–î–ê–†–¨ ================== */
    (function calendar(){
      const calWrap=document.getElementById('cal'), slotsBox=document.getElementById('slots');
      const tz=Intl.DateTimeFormat().resolvedOptions().timeZone||'Europe/Moscow';
      const durBtns=[...document.querySelectorAll('.dur')];
      const confirmBtn=document.getElementById('confirmConsult');
      const contactEl=document.getElementById('contact');
      if(!calWrap||!slotsBox||!confirmBtn) return;

      let cur=new Date(), y=cur.getFullYear(), m=cur.getMonth();
      let FREE={}, selDate=null, selTime=null, selDur=30, GRAN=30, SERVER_FILTERED=false;

      durBtns.forEach(b=>{ b.addEventListener('click', async ()=>{ durBtns.forEach(x=>x.classList.remove('btn-primary')); b.classList.add('btn-primary'); selDur=+b.dataset.min||30; await syncMonth(); if(selDate) renderSlots(selDate); }); });

      function dd2(n){return String(n).padStart(2,'0')}
      function drawCalendar(){ calWrap.innerHTML=''; const head=document.createElement('div'); head.className='cal-head'; const mon=new Date(y,m,1); const label=mon.toLocaleDateString('ru-RU',{month:'long',year:'numeric'}); head.innerHTML=`<div class="mon">${label[0].toUpperCase()+label.slice(1)}</div><div class="cta"><button class="btn btn-ghost" id="pm">‚óÄ</button><button class="btn btn-ghost" id="nm">‚ñ∂</button></div>`; calWrap.appendChild(head); const grid=document.createElement('div'); grid.className='cal-grid'; calWrap.appendChild(grid); ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(d=>{const c=document.createElement('div'); c.className='cal-cell cal-dow'; c.textContent=d; grid.appendChild(c);}); const firstDow=(new Date(y,m,1).getDay()+6)%7; for(let i=0;i<firstDow;i++){const s=document.createElement('div'); s.className='cal-cell muted'; grid.appendChild(s);} const count=new Date(y,m+1,0).getDate(); for(let d=1; d<=count; d++){ const iso=`${y}-${dd2(m+1)}-${dd2(d)}`; const cell=document.createElement('div'); cell.className='cal-cell'; cell.textContent=d; cell.dataset.iso=iso; cell.onclick=()=>{ selDate=iso; renderSlots(iso); grid.querySelectorAll('.cal-cell.sel').forEach(x=>x.classList.remove('sel')); cell.classList.add('sel'); }; grid.appendChild(cell);} document.getElementById('pm').onclick=async()=>{ m--; if(m<0){m=11;y--;} await syncMonth(true);}; document.getElementById('nm').onclick=async()=>{ m++; if(m>11){m=0;y++;} await syncMonth(true);}; applyDaysState(); }

      function applyDaysState(){ const grid=calWrap.querySelector('.cal-grid'); grid.querySelectorAll('.cal-cell').forEach(cell=>{ if(!cell.dataset.iso) return; const arr=FREE[cell.dataset.iso]||[]; const off=!(Array.isArray(arr)&&arr.length); cell.classList.toggle('off', off); cell.classList.toggle('muted', off); }); }

      function filterStartsByDuration(starts,dur,step){ if(!Array.isArray(starts)||!starts.length) return []; const toMin=t=>{ const m=t.match(/(\d{1,2}):(\d{2})/); return m?(+m[1])*60+(+m[2]):null }; const need=Math.ceil(dur/step); const set=new Set(starts.map(toMin).filter(x=>x!=null)); return starts.filter(t=>{ const m=toMin(t); if(m==null) return false; for(let i=0;i<need;i++){ if(!set.has(m+i*step)) return false } return true; }); }

      function renderSlots(dateIso){ slotsBox.innerHTML=''; slotsBox.classList.add('show'); selTime=null; const arr=FREE[dateIso]||[]; const list=SERVER_FILTERED?arr:filterStartsByDuration(arr, selDur, GRAN); if(!list.length){ slotsBox.innerHTML=`<div class="muted">–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è ${selDur} –º–∏–Ω</div>`; return; } list.forEach(t=>{ const b=document.createElement('button'); b.className='btn'; b.textContent=t; b.dataset.time=t; b.onclick=()=>{ slotsBox.querySelectorAll('.btn').forEach(x=>x.classList.remove('btn-primary')); b.classList.add('btn-primary'); selTime=t; }; slotsBox.appendChild(b); }); }

      async function syncMonth(keepSel=false){ const first=`${y}-${dd2(m+1)}-01`; const last=`${y}-${dd2(m+1)}-${dd2(new Date(y,m+1,0).getDate())}`; const data=await apiGet('/api/slots/free',{from:first,to:last,tz,lead_min:60,duration_min:selDur}); if(data?.ok){ FREE=data.days||{}; GRAN=data.gran||30; SERVER_FILTERED=!!data.filtered_by_duration; drawCalendar(); if(keepSel && selDate && FREE[selDate]?.length){ const cell=calWrap.querySelector(`.cal-cell[data-iso="${selDate}"]`); if(cell){ cell.classList.add('sel'); renderSlots(selDate); } } else { const days=Object.keys(FREE).filter(d=>(FREE[d]||[]).length).sort(); selDate=days[0]||null; if(selDate){ const cell=calWrap.querySelector(`.cal-cell[data-iso="${selDate}"]`); if(cell) cell.classList.add('sel'); renderSlots(selDate); } else { slotsBox.innerHTML='<div class="muted">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –¥–∞—Ç</div>'; } } } else { showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏','–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ—Ç—ã','slots_err'); } }

      confirmBtn.addEventListener('click', async ()=>{ if(!selDate||!selTime){ showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ—Ç','–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã','pick_warn'); return; } const contact=(contactEl?.value||'').trim(); if(!contact){ showToast('–ù—É–∂–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç','–¢–µ–ª–µ–≥—Ä–∞–º @username –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω','contact_warn'); return; } confirmBtn.disabled=true; try{ const hold=await apiPost('/api/slots/hold',{date:selDate,time:selTime,duration_min:selDur}); if(!hold?.ok){ await syncMonth(true); showToast('–°–ª–æ—Ç –∑–∞–Ω—è—Ç','–û–±–Ω–æ–≤–∏–ª —Å–ª–æ—Ç—ã','taken'); return; } const res=await apiPost('/api/consult/book',{date:selDate,time:selTime,duration_min:selDur,format:'call',contact}); if(res?.ok){ blastConfetti(confirmBtn,36); showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞','–ú—ã —Å–≤—è–∂–µ–º—Å—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è','booked',3200); await syncMonth(true); } else { showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å','–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–ª–æ—Ç','book_err'); await syncMonth(true); } } finally { confirmBtn.disabled=false; } });

      // init
      syncMonth();
    })();
    /* ==== –ü—Ä–æ—Ñ–∏–ª—å: –±—ã—Å—Ç—Ä–∞—è –≤—Å—Ç–∞–≤–∫–∞ + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥—Ç—è–∂–∫–∞ ==== */
    (function profile(){ (async()=>{ try{ const res=await apiPost('/api/bootstrap',{}); if(res?.last_booking){ const s=`${res.last_booking.date} ${res.last_booking.time}`; const a=document.getElementById('profBook'); if(a) a.textContent=s; const b=document.getElementById('profileSheetBook'); if(b) b.textContent=s; } const lp=res?.last_prize?.title || (res?.prizes && res.prizes[0]?.title); if(lp){ const el1=document.getElementById('profPrize'); if(el1) el1.textContent=lp; const el2=document.getElementById('profileSheetPrize'); if(el2) el2.textContent=lp; } if(typeof res?.points==='number'){ const v=String(res.points); const p1=document.getElementById('profPoints'); if(p1) p1.textContent=v; const p2=document.getElementById('profileSheetPoints'); if(p2) p2.textContent=v; } const hint=document.getElementById('profHint'); if(hint) hint.textContent='–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.'; }catch(_){ /* —Ç–∏—Ö–æ */ } })(); })();

    /* ==== Bottom Sheet: toggle ==== */
    (function profileSheet(){
      const btn=document.querySelector('.profile-toggle');
      const sheet=document.getElementById('profileSheet');
      const close=document.getElementById('profileClose');
      const backdrop=document.getElementById('profileBackdrop');
      if(!btn||!sheet||!backdrop) return;
      function open(){ sheet.classList.add('open'); backdrop.classList.add('open'); sheet.setAttribute('aria-hidden','false'); }
      function hide(){ sheet.classList.remove('open'); backdrop.classList.remove('open'); sheet.setAttribute('aria-hidden','true'); }
      btn.addEventListener('click', open);
      close?.addEventListener('click', hide);
      backdrop.addEventListener('click', hide);
      // swipe to close on touch
      let startY=0, dy=0; sheet.addEventListener('touchstart',e=>{ startY=e.touches[0].clientY; dy=0; },{passive:true});
      sheet.addEventListener('touchmove',e=>{ dy=e.touches[0].clientY-startY; if(dy>0){ sheet.style.transform = `translateY(${dy}px)`; } },{passive:true});
      sheet.addEventListener('touchend',()=>{ if(dy>40){ hide(); sheet.style.transform=''; } else { sheet.style.transform=''; } });
    })();

    /* ==== SPA‚Äë–Ω–∞–≤–∏–≥–∞—Ü–∏—è + –ø—É–∑—ã—Ä—å (mobile‚Äëproof) ==== */
(function nav(){
  const nav = document.getElementById('spa-nav'); if(!nav) return;
  const track = nav.querySelector('.track') || nav;
  const bubble = track.querySelector('.bubble');
  const links = Array.from(track.querySelectorAll('.btn,[data-page]'));

  const ALLOW_DRAG = (window.matchMedia && matchMedia('(pointer: coarse)').matches);

  function pageIdFromHash(h){ return (h||location.hash||'#home').replace('#','') || 'home'; }

  function showPage(hash){
    const id = pageIdFromHash(hash);
    document.querySelectorAll('main > section, section.page').forEach(s=>{
      s.style.display = (s.id===id) ? 'block' : 'none';
    });
    links.forEach(a=> a.classList.toggle('active', (a.dataset && a.dataset.page)===id ));
    centerActive();
    moveBubble();
  }

  function moveBubble(){
    if (!bubble) return;
    const a = track.querySelector('.btn.active,[data-page].active') || links[0];
    if (!a) return;
    const aRect = a.getBoundingClientRect();
    const tRect = track.getBoundingClientRect();
    // left –≤–Ω—É—Ç—Ä–∏ .track (—É—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Å–∞–º–æ–≥–æ track)
    const left = (aRect.left - tRect.left) + track.scrollLeft + 6;
    bubble.style.left = Math.max(0, Math.round(left)) + 'px';
    bubble.style.width = Math.max(32, Math.round(aRect.width)) + 'px';
  }

  function centerActive(){
    const a = track.querySelector('.btn.active,[data-page].active');
    if (!a) return;
    if (a.scrollIntoView){
      a.scrollIntoView({ behavior:'smooth', inline:'center', block:'nearest' });
      setTimeout(moveBubble, 220);
    } else {
      const target = a.offsetLeft - (track.clientWidth - a.offsetWidth)/2;
      const max = Math.max(0, track.scrollWidth - track.clientWidth);
      track.scrollTo({ left: Math.min(max, Math.max(0, target)), behavior:'smooth' });
      setTimeout(moveBubble, 220);
    }
  }

  // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∏–∫–∏ + –ø–æ—Ä–æ–≥ –¥–ª—è drag, —á—Ç–æ–±—ã –Ω–µ —Å—Ç—Ä–µ–ª—è–ª–∏ ¬´–ª–æ–∂–Ω—ã–µ¬ª –∫–ª–∏–∫–∏
  let isDown=false, sx=0, sl=0, moved=false;
  track.addEventListener('pointerdown', (e)=>{
    if (!ALLOW_DRAG) return;
    isDown = true; moved = false; sx = e.clientX; sl = track.scrollLeft;
    track.setPointerCapture(e.pointerId);
  });
  track.addEventListener('pointermove', (e)=>{
    if (!ALLOW_DRAG || !isDown) return;
    const dx = e.clientX - sx;
    if (Math.abs(dx) > 6) moved = true;
    track.scrollLeft = sl - dx;
    requestAnimationFrame(moveBubble);
  });
  track.addEventListener('pointerup', ()=>{ isDown = false; });

  track.addEventListener('click', (e)=>{
    const a = e.target.closest('.btn,[data-page]'); if(!a) return;
    if (moved) { moved = false; return; } // —ç—Ç–æ –±—ã–ª drag, –Ω–µ –∫–ª–∏–∫
    const id = a.dataset && a.dataset.page;
    if (id){
      // –ü–æ–∑–≤–æ–ª—è–µ–º hashchange, –æ–Ω –≤—ã–∑–æ–≤–µ—Ç showPage()
      history.replaceState(null, '', '#'+id);
      showPage();
    } else {
      setTimeout(()=>{ moveBubble(); centerActive(); }, 0);
    }
  }, {passive:false});

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø—É–∑—ã—Ä—å –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
  track.addEventListener('scroll', ()=>{ requestAnimationFrame(moveBubble); }, {passive:true});
  window.addEventListener('resize', ()=>{ requestAnimationFrame(moveBubble); });
  window.addEventListener('orientationchange', ()=>{ setTimeout(()=>{ moveBubble(); centerActive(); }, 0); });
  window.addEventListener('hashchange', ()=> showPage());

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  showPage();
  if (document.fonts && document.fonts.ready) document.fonts.ready.then(()=> setTimeout(()=>{ moveBubble(); centerActive(); }, 0));
  window.addEventListener('load', ()=>{ moveBubble(); centerActive(); });
})();

/* ==== –ò—Å—Ç–æ—Ä–∏—è + –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞: –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–µ–Ω–¥–µ—Ä ==== */
    (function historyAndInvite(){
      function fmtDate(s){ try{ if(!s) return '‚Äî'; const d=new Date(s.replace(' ','T')); return d.toLocaleString('ru-RU',{day:'2-digit',month:'2-digit',year:'2-digit',hour:'2-digit',minute:'2-digit'}); }catch(_){ return s; } }
      function el(id){ return document.getElementById(id); }
      function renderRows(tbody, rows, map){
        tbody.innerHTML = '';
        (rows||[]).forEach(r=>{
          const tr=document.createElement('tr');
          tr.innerHTML = map(r);
          tbody.appendChild(tr);
        });
      }
      async function loadBootstrap(){ try{ return await apiPost('/api/bootstrap',{}); }catch(_){ return {}; } }
      async function loadList(path){ try{ const r=await apiGet(path,{}); return r?.items||r?.rows||[]; }catch(_){ return []; } }

      async function hydrate(){
        const data = await loadBootstrap();
        const spins = data.spins || await loadList('/api/spins/list');
        const prizes = data.prizes || await loadList('/api/prizes/list');
        const bonuses = data.bonuses || await loadList('/api/bonuses/list');
        const refs = data.referrals || data.refs || await loadList('/api/referrals/list');
        const ref = data.ref || {};

        // spins
        if (el('tblSpins')){
          const tb = el('tblSpins').querySelector('tbody');
          renderRows(tb, spins, (r)=>{
            const when = r.created_at || r.date || r.time || '';
            const prize = r.prize?.title || r.title || r.label || '‚Äî';
            const note = r.note || r.comment || '';
            return `<td>${fmtDate(when)}</td><td>${prize}</td><td>${note||''}</td>`;
          });
        }
        // prizes
        if (el('tblPrizes')){
          const tb = el('tblPrizes').querySelector('tbody');
          renderRows(tb, prizes, (r)=>{
            const when = r.created_at || r.date || '';
            const title = r.title || r.code || '';
            const src = r.source || r.kind || r.type || '';
            return `<td>${fmtDate(when)}</td><td>${title}</td><td>${src}</td>`;
          });
        }
        // bonuses
        if (el('tblBonuses')){
          const tb = el('tblBonuses').querySelector('tbody');
          renderRows(tb, bonuses, (r)=>{
            const when = r.created_at || r.date || '';
            const kind = r.kind || r.title || '';
            const pts = r.points ?? r.value ?? '';
            return `<td>${fmtDate(when)}</td><td>${kind}</td><td>${pts}</td>`;
          });
        }
        // referrals
        if (el('tblRefs')){
          const tb = el('tblRefs').querySelector('tbody');
          renderRows(tb, refs, (r)=>{
            const when = r.created_at || r.date || '';
            const user = r.user?.name || r.username || r.user || '‚Äî';
            const st = r.status || r.stage || '‚Äî';
            return `<td>${fmtDate(when)}</td><td>${user}</td><td><span class="pill">${st}</span></td>`;
          });
        }
        // ref link
        if (el('refLink')){
          const link = ref.link || ref.url || '';
          el('refLink').textContent = link || '‚Äî';
        }
        if (el('refCode')) el('refCode').textContent = ref.code || ref.id || '‚Äî';
        if (el('refCount')) el('refCount').textContent = (refs||[]).length;
      }

      // –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª—ã
      function onRoute(){
        const page=(location.hash||'#home').slice(1);
        if (page==='history' || page==='invite') hydrate();
      }
      window.addEventListener('hashchange', onRoute);
      onRoute(); // –ø–µ—Ä–≤—ã–π —Ä–∞–∑
    })();

  </script>

<script>
// === Quick profit calc (sliders) ===
(function(){
  const rev = document.getElementById('rev');
  const pct = document.getElementById('pct');
  const revVal = document.getElementById('revVal');
  const pctVal = document.getElementById('pctVal');
  const oldTax = document.getElementById('oldTax');
  const newTax = document.getElementById('newTax');
  const saveCounter = document.getElementById('saveCounter');
  if(!rev || !pct) return;

  function fmt(n){ return (n||0).toLocaleString('ru-RU') + ' ‚ÇΩ'; }
  function animateTo(el, target){
    const start = parseInt((el.textContent||'0').replace(/[^\d]/g,''))||0;
    const dur = 600; const t0 = performance.now();
    function tick(t){
      const k = Math.min(1, (t - t0) / dur);
      const val = Math.round(start + (target - start) * k);
      el.textContent = fmt(val);
      if(k < 1) requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  }

  function recalc(){
    const R = +rev.value;
    const P = +pct.value / 100;
    revVal.textContent = fmt(R);
    pctVal.textContent = Math.round(P*100) + '%';

    const oldT = Math.round(R * 0.15);
    const newT = Math.round(oldT * (1 - P));
    const save = oldT - newT;

    oldTax.textContent = fmt(oldT);
    newTax.textContent = fmt(newT);
    animateTo(saveCounter, save);
  }

  rev.addEventListener('input', recalc);
  pct.addEventListener('input', recalc);
  recalc();
})();

// === Steps: "–ö–∞–∫ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º" ===
(function(){
  const flow = document.getElementById('flow');
  const next = document.getElementById('flowNext');
  const reset = document.getElementById('flowReset');
  if(!flow || !next) return;
  const steps = Array.from(flow.querySelectorAll('.badge'));
  let i = 0;

  function render(){
    steps.forEach((s,idx)=>{
      s.style.opacity = idx<=i ? 1 : .45;
      s.style.filter  = idx<=i ? 'none' : 'grayscale(.3)';
    });
    next.textContent = (i >= steps.length-1) ? '–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏' : '–î–∞–ª—å—à–µ';
  }

  next.addEventListener('click', ()=>{
    if(i < steps.length-1){ i++; render(); }
    else {
      try{ window.showToast && showToast('–ì–æ—Ç–æ–≤–æ', '–û—Ç–∫—Ä—ã–ª —Ä–∞–∑–¥–µ–ª ¬´–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è¬ª'); }catch(_){}
      location.hash = '#consult';
      try{ const a = document.querySelector('#spa-nav .btn[data-page=\"consult\"]'); a && a.click(); }catch(_){}
    }
  });
  reset && reset.addEventListener('click', ()=>{ i = 0; render(); });
  render();
})();
</script>
</body>
</html>
