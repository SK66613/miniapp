<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Mini‑app | Router + BackButton + No-Swipe (robust)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
const tg = window.Telegram && window.Telegram.WebApp;

function openAsMainMiniApp(startParam = 'home'){
  const url = `https://t.me/serge_kamensky_bot/app?startapp=${encodeURIComponent(startParam)}`;
  // если мы внутри Telegram — откроется во встроенном контейнере (фуллскрин)
  if (tg && typeof tg.openTelegramLink === 'function') {
    tg.openTelegramLink(url);
  } else {
    // открыто в браузере (не в Telegram) → покажем страницу t.me (нормально)
    window.open(url, '_blank');
  }
}
</script>


  <style>
    :root{
      --tabH: 64px;
      --navGap: 12px;
      --bg:#0b0c15; --text:#f4f6fa; --border:rgba(255,255,255,.10);
      --appW: 428px;
    }
    *{ box-sizing:border-box }
    img{ max-width:100%; display:block }
    html,body{ height:100% }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      overscroll-behavior: none;
    }
    @media (min-width:900px){ body{ display:grid; place-items:center; } }
    .wrap{
      width:100%; max-width:1080px; margin:0 auto;
      min-height:100svh;
      padding:16px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px);
    }
    @media (min-width:900px){
      .wrap{ max-width:var(--appW); padding:20px 14px calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom,0px) + 22px); }
    }
    main>section, section.page{ display:none }
    main>section.active, section.page.active{ display:block }
    .btm-nav{
      position:fixed; left:0; right:0;
      bottom: calc(var(--navGap) + env(safe-area-inset-bottom, 0px));
      height: var(--tabH);
      z-index: 9999;
      display:grid; grid-template-columns:repeat(5,1fr); align-items:center;
      padding: 6px 6px 6px;
      background: rgba(10,12,14,.72);
      -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,.08);
      border-left:0; border-right:0; border-bottom:0;
      border-radius: 16px 16px 0 0;
    }
    .btm-nav .tab{
      height:100%; border:0; background:none; color:#dfe3e6; cursor:pointer;
      display:flex; flex-direction:column; align-items:center; justify-content:center; gap:4px;
      font-size:11px; font-weight:700;
      filter: grayscale(.35) saturate(.8); opacity:.85;
      border-radius:14px; -webkit-tap-highlight-color:transparent;
    }
    .btm-nav .tab img{ width:24px; height:24px }
    .btm-nav .tab:active{ transform: translateY(1px) }
    .btm-nav .tab.active{ opacity:1; filter:none; color:#fff; position:relative }
    .btm-nav .tab.active::before{
      content:""; position:absolute; inset:6px 10px 18px 10px; z-index:-1;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    @media (min-width:900px){
      .btm-nav{ left:50%; right:auto; width: var(--appW); transform: translateX(-50%); }
    }
    .card{ background:rgba(255,255,255,.05); border:1px solid var(--border); border-radius:16px; padding:16px; }
    .page-title{ margin:0 0 12px }
    .h1{ font-weight:800; font-size:20px; margin:0 0 8px }
    .muted-sm{ opacity:.8 }
    .sheet{ position:fixed; inset:0; z-index:9990; pointer-events:none; }
    .sheet.is-open{ pointer-events:auto; }
    .sheet__overlay{
      position:absolute; left:0; right:0; top:0;
      bottom: calc(var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      background: rgba(0,0,0,.48); opacity:0; transition:opacity .2s ease;
      -webkit-backdrop-filter: blur(4px); backdrop-filter: blur(4px);
    }
    .sheet.is-open .sheet__overlay{ opacity:1; }
    .sheet__panel{
      position:absolute; left:0; right:0; margin:0 auto;
      width:min(820px,100%); max-height:88vh; overflow:auto;
      background:linear-gradient(180deg, rgba(18,20,24,.98), rgba(18,20,24,.96));
      border:1px solid rgba(255,255,255,.08);
      box-shadow:0 20px 40px rgba(0,0,0,.45);
      transition: transform .28s cubic-bezier(.2,.8,.2,1), opacity .2s ease;
      padding:12px 14px calc(16px + var(--tabH) + var(--navGap) + env(safe-area-inset-bottom, 0px));
      will-change: transform;
      touch-action: pan-y;
    }
    .sheet.sheet-bottom .sheet__panel{ bottom:0; top:auto; border-radius: 16px 16px 0 0; transform: translateY(100%); }
    .sheet.is-open.sheet-bottom .sheet__panel{ transform: translateY(0); }
    .sheet__handle{ width:42px; height:4px; border-radius:999px; margin:6px auto 10px; background:rgba(255,255,255,.18) }
    .sheet__header{ display:flex; align-items:center; gap:10px; margin:0 0 8px }
    .sheet__title{ font-weight:800; font-size:18px; margin:0 }
    .sheet__close{ margin-left:auto; border:0; background:transparent; color:#fff; opacity:.85; width:36px; height:36px; border-radius:10px; display:grid; place-items:center }
    .sheet__close:active{ transform:translateY(1px); opacity:1 }
    .sheet__body{ display:grid; gap:10px }
    body.sheet-open{ overflow:hidden }
    @media (min-width:900px){ .sheet__panel{ width:min(var(--appW),92vw); } }
  </style>


<style>
/* ===== ГЛАВНАЯ HERO GIF (full-bleed) ===== */
:root{
  --wrapPadX: 14px;   /* должен совпасть с боковыми паддингами .wrap */
  --wrapPadTop: 16px; /* верхний паддинг .wrap */
}
.hero{
  position: relative;
  margin: calc(-1 * var(--wrapPadTop)) calc(-1 * var(--wrapPadX)) 14px;
  padding-top: env(safe-area-inset-top, 0px);
  background:#000; overflow:hidden;
}
.hero__media{
  width:100%;
  height: clamp(260px, 42vh, 460px);
  object-fit: cover; display:block;
}
.hero::after{
  content:""; position:absolute; left:0; right:0; bottom:-1px; height:84px;
  pointer-events:none; background:linear-gradient(180deg, rgba(0,0,0,0) 0%, var(--bg) 100%);
}

/* ===== PROMO (одна плашка, без .card-обёртки) ===== */
.promo{
  display:grid; grid-template-columns:48px 1fr auto; align-items:center; gap:12px;
  padding:10px 12px; margin:0 0 12px;
  background: rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.08);
  border-radius:16px;
}
.promo__icon{ width:48px; height:48px; border-radius:12px; display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden }
.promo__icon img{ width:28px; height:28px; display:block }
.promo__title{ font-weight:800 }
.promo__sub{ opacity:.8; font-size:13px; margin-top:2px }
.promo__btn{
  height:36px; padding:0 14px; border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:linear-gradient(180deg,#2d7cff,#0f56ff); color:#fff; font-weight:800; cursor:pointer;
}
.promo__btn:active{ transform: translateY(1px) }

/* ===== LIST CARD ("Start here") ===== */
.list-card .list-head{ font:800 16px/1.2 Inter,system-ui; margin-bottom:8px }
.list{ display:grid; gap:8px }

/* Убираем фон и рамки у пунктов */
.list-card .list__item{ background:transparent; border:0; box-shadow:none }

/* Сдвигаем левее и выравниваем под заголовок карточки */
.list-card.tight .list{ margin-left:-16px; margin-right:-16px } /* 16 = padding .card */
.list-card.tight .list__item{
  padding:12px 16px; gap:10px;
  display:grid; grid-template-columns:36px 1fr auto; align-items:center;
}
.list-card.tight .list__icon{
  width:36px; height:36px; border-radius:10px;
  display:grid; place-items:center; background:rgba(255,255,255,.06); overflow:hidden
}
.list-card.tight .list__icon img{ width:22px; height:22px; display:block }
.list__text{ display:grid; gap:4px }
.list__title{ font-weight:800 }
.list__sub{ opacity:.8; font-size:13px }

/* Кликабельная только стрелка */
.list__chev-btn{
  width:36px; height:36px; display:grid; place-items:center;
  border-radius:999px; border:1px solid rgba(255,255,255,.10);
  background:transparent; color:inherit; font-size:18px; cursor:pointer;
}
.list__chev-btn:active{ transform:translateY(1px) }

/* ховер по желанию */
.list-card .list__item:hover{ background: rgba(255,255,255,.04) }

/* центрирование на десктопе под мобильное полотно */
@media (min-width:900px){
  .hero{
    margin-left: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
    margin-right: calc((var(--appW) - 100vw)/2 - var(--wrapPadX));
  }
}


</style>

<style>
  /* ===== FULLSCREEN INTRO ===== */
/* ===== FULLSCREEN INTRO (обновлено) ===== */
:root{ --introBottomPad: 28px; } /* насколько выше кнопки от нижней перекладины */

.intro{
  position:fixed; inset:0; z-index:10050;
  background:#000; color:#fff;
  display:none; pointer-events:auto;
}
.intro.is-open{ display:block; }
body.intro-open{ overflow:hidden; }

.intro__wrap{
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  padding:
    calc(env(safe-area-inset-top,0px) + 6px)
    14px
    calc(env(safe-area-inset-bottom,0px) + var(--introBottomPad));
}

.intro__progress{
  display:flex; gap:8px; justify-content:center;
  padding:8px 0 12px;
}
.intro__seg{ width:44px; height:4px; border-radius:999px; background:rgba(255,255,255,.28) }
.intro__seg.active{ background:#fff }

.intro__stage{
  flex:1; display:grid; place-items:center; padding:12px; text-align:center;
}
.intro__slides{ width:100% }
.intro__slide{ display:none }
.intro__slide.active{ display:block }

.intro__h1{ font-weight:900; font-size:28px; margin:0 0 10px }
.intro__p{ opacity:.85; font-size:15px; margin:0 auto; max-width:26ch }

/* низ экрана — динамически рендерим набор кнопок */
.intro__actions{
  margin-top:auto; display:grid; gap:10px;
  padding-top:8px;
}
.intro__actions--one{ grid-template-columns:1fr }
.intro__actions--two{ grid-template-columns:1fr 1fr }

.intro__btn{
  height:52px; padding:0 16px; border-radius:16px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(255,255,255,.06);
  color:#fff; font-weight:800; cursor:pointer;
}
.intro__btn--primary{ background:#fff; color:#000; border-color:#fff }
.intro__btn--ghost{ background:transparent }
.intro__btn:active{ transform:translateY(1px) }

@media (min-width:900px){
  .intro__wrap{ max-width: var(--appW,428px); margin:0 auto }
}
</style>
 <style>
  /* ===== FULLSCREEN CLICKER ===== */
.clicker{
  position:fixed; inset:0; z-index:10060; /* выше шторок/интро */
  background:#000; color:#fff; display:none;
}
.clicker.is-open{ display:block; }
body.clicker-open{ overflow:hidden; }

.clicker__wrap{
  position:absolute; inset:0;
  display:flex; flex-direction:column;
  padding:
    calc(env(safe-area-inset-top,0px) + 6px)
    14px
    calc(env(safe-area-inset-bottom,0px) + 14px);
}

.clicker__counter{
  align-self:center;
  min-width:120px; height:40px;
  display:grid; place-items:center;
  padding:0 12px; border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);
  font:800 16px/1 Inter, system-ui;
}

.clicker__stage{
  flex:1; display:grid; place-items:center; position:relative;
  user-select:none; -webkit-user-select:none;
  touch-action:manipulation;
}

.clicker__img{
  width:min(84vw, 520px); height:auto; display:block;
  filter: drop-shadow(0 20px 60px rgba(0,255,255,.12));
}

.clicker__hud{
  position:absolute; left:0; right:0; bottom:0; display:grid; place-items:center;
  padding-bottom: 4px;
  opacity:.45; font:600 13px/1 Inter, system-ui;
}

/* всплывающий «ромбик» */
.spark{
  position:absolute; pointer-events:none;
  font-weight:900; font-size:22px; color:#6be3ff; /* ромбик-циан */
  transform: translate(-50%, -50%);
  animation: spark-rise .7s ease-out forwards;
  text-shadow: 0 0 10px rgba(107,227,255,.55);
}
@keyframes spark-rise{
  0%   { opacity:1; transform: translate(-50%,-50%) scale(1); }
  60%  { opacity:.9; transform: translate(-50%,-110%) scale(1.05); }
  100% { opacity:0; transform: translate(-50%,-170%) scale(.9); }
}

/* рипл по клику */
.ripple{
  position:absolute; width:14px; height:14px; border-radius:999px;
  border:2px solid rgba(255,255,255,.35);
  transform:translate(-50%,-50%); pointer-events:none;
  animation:ripple .45s ease-out forwards;
}
@keyframes ripple{
  to{ width:140px; height:140px; opacity:0; }
}

@media (min-width:900px){
  .clicker__wrap{ max-width: var(--appW, 428px); margin:0 auto; }
}

 </style>

</head>
<body>
  <div class="wrap">
    <nav id="btm-nav" class="btm-nav" aria-label="Навигация">
      <button class="tab" data-page="home"><img src="ic_home.png" alt=""><span>Главная</span></button>
      <button class="tab" data-page="services"><img src="ic_services.png" alt=""><span>Услуги</span></button>
      <button class="tab" data-page="consult"><img src="ic_consult.png" alt=""><span>Запись</span></button>
      <button class="tab" data-page="bonuses"><img src="ic_bonus.png" alt=""><span>Бонусы</span></button>
      <button class="tab" data-page="about"><img src="ic_about.png" alt=""><span>Обо мне</span></button>
    </nav>

    <main>
<!-- FULLSCREEN CLICKER -->
<div id="clicker" class="clicker" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="clicker__wrap">
    <div id="clicker-counter" class="clicker__counter">◆ 0</div>

    <div id="clicker-stage" class="clicker__stage">
      <!-- Картинка-цель. Положи свой файл в assets и замени src -->
      <img class="clicker__img" src="sales_genius_aibot.png" alt="Click target">
      <div class="clicker__hud">кликай по картинке</div>
    </div>
  </div>
</div>





      <div id="sheet" class="sheet sheet-bottom" aria-hidden="true" role="dialog" aria-modal="true">
        <div class="sheet__overlay" data-close-sheet></div>
        <section class="sheet__panel" tabindex="-1">
          <div class="sheet__handle"></div>
          <header class="sheet__header">
            <h3 class="sheet__title">Заголовок</h3>
            <button class="sheet__close" aria-label="Закрыть" data-close-sheet>✕</button>
          </header>
          <div class="sheet__body" id="sheet-body"></div>
        </section>
      </div>

      <template id="tpl-example">
        <div class="card">
          <div class="h1">Демо‑страница</div>
          <p class="muted-sm">Любой HTML внутрь: формы, карточки, таблицы…</p>
        </div>
      </template>

<section class="page" id="home">
  <!-- HERO (gif/mp4) -->
  <div class="hero">
    <!-- GIF: -->
    <img class="hero__media" src="demo.gif" alt="Hero">
    <!-- Если тяжёлый GIF, замени на mp4 (тот же класс):
    <video class="hero__media" autoplay muted loop playsinline preload="metadata">
      <source src="assets/hero.mp4" type="video/mp4">
    </video>
    -->
  </div>

  <!-- Промо-плашка -->
  <div class="promo">
    <div class="promo__icon">
      <img src="ic_about.png" alt="">
    </div>
    <div>
      <div class="promo__title">Halloween Clicker</div>
      <div class="promo__sub">Play now</div>
    </div>
<button class="promo__btn" data-open-clicker>Clicker</button>
  </div>

  <!-- Start here -->
  <div class="card list-card tight">
    <div class="list-head">Start here</div>
    <div class="list">
      <div class="list__item">
        <div class="list__icon"><img src="ic_bonus.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">What is Notcoin?</div>
          <div class="list__sub">Intro</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="What is Notcoin?"
                data-tpl="#tpl-example"
                aria-label="Открыть">
          ›
        </button>
      </div>

<div class="list__item">
  <div class="list__icon"><img src="ic_services.png" alt=""></div>
  <div class="list__text">
    <div class="list__title">Get $NOT</div>
    <div class="list__sub">Swap cash or crypto to $NOT</div>
  </div>

  <!-- Открывает только интро-слайдер -->
  <button class="list__chev-btn"
          data-open-intro
          aria-controls="intro"
          aria-label="Открыть онбординг">
    ›
  </button>
</div>

      <div class="list__item">
        <div class="list__icon"><img src="ic_about.png" alt=""></div>
        <div class="list__text">
          <div class="list__title">Whitepaper</div>
          <div class="list__sub">Literally</div>
        </div>
        <button class="list__chev-btn"
                data-open-sheet
                data-title="Whitepaper"
                data-tpl="#tpl-example"
                aria-label="Открыть">
          ›
        </button>
      </div>
    </div>
  </div>
</section>


      <section class="page" id="services">
        <div class="card page-title">
          <div class="h1">Услуги</div>
          <p class="muted-sm">Тарифы, переключатель месяц/год и т.д.</p>
          <button class="btn" data-open-sheet data-title="Прайс" data-tpl="#tpl-example" data-from="bottom">Показать прайс</button>
        </div>
      </section>

      <section class="page" id="consult">
        <div class="card page-title">
          <div class="h1">Запись на консультацию</div>
          <button class="btn btn-primary" data-open-sheet data-title="Подтверждение" data-tpl="#tpl-example" data-from="bottom">Открыть снизу</button>
        </div>
      </section>

      <section class="page" id="bonuses">
        <div class="card page-title">
          <div class="h1">Бонусы</div>
        </div>
      </section>

      <section class="page" id="about">
        <div class="card page-title">
          <div class="h1">Обо мне</div>
        </div>
      </section>

      <!-- FULLSCREEN INTRO -->
<!-- FULLSCREEN INTRO -->
<div id="intro" class="intro" aria-hidden="true" role="dialog" aria-modal="true">
  <div class="intro__wrap">
    <div class="intro__progress" id="intro-progress"></div>

    <div class="intro__stage">
      <div class="intro__slides" id="intro-slides">
        <!-- 1 -->
        <section class="intro__slide active">
          <h2 class="intro__h1">Welcome fren</h2>
          <p class="intro__p">Короткий тизер, чем полезен мини-апп.</p>
        </section>
        <!-- 2 -->
        <section class="intro__slide">
          <h2 class="intro__h1">Вопрос</h2>
          <p class="intro__p">Продолжить сейчас?</p>
        </section>

        <!-- 3 -->
        <section class="intro__slide">
          <h2 class="intro__h1">Погнали!</h2>
          <p class="intro__p">Последний штрих — и начнём.</p>
        </section>
      </div>
    </div>

    <!-- сюда JS будет рендерить нужный набор кнопок -->
    <div id="intro-actions" class="intro__actions"></div>
  </div>
</div>


    </main>
  </div>

  <script>
  (function app(){
    const TG = window.Telegram && window.Telegram.WebApp;

    if (TG){
      try{
        TG.ready();
        TG.expand();
        TG.disableVerticalSwipes?.();
        TG.enableClosingConfirmation?.();
        TG.onEvent?.('viewportChanged', () => TG.disableVerticalSwipes?.());
      }catch(e){ console.warn('TG init error', e); }
    }

    const ROOT = 'home';
    const sheetRoot = document.getElementById('sheet');
    const sheetPanel= sheetRoot?.querySelector('.sheet__panel');
    const sheetBody = document.getElementById('sheet-body');
    const sheetTitle= sheetRoot?.querySelector('.sheet__title');

    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const isInDOM = id => !!document.getElementById(id);

    function currentId(){
      const url = new URL(location.href);
      const qp = (url.searchParams.get('page') || '').trim();
      if (qp && isInDOM(qp)) return qp;
      const h = (location.hash || '#'+ROOT).replace(/^#/, '');
      return isInDOM(h) ? h : ROOT;
    }

    function setActivePage(id){
      qsa('main > section, section.page').forEach(s => {
        const on = (s.id === id);
        s.classList.toggle('active', on);
        s.style.display = on ? 'block' : 'none';
      });
      qsa('[data-page]').forEach(t => t.classList.toggle('active', t.dataset.page === id));
      requestAnimationFrame(()=> window.scrollTo({ top: 0, behavior:'auto' }));
      syncBack();
    }

    function navigateTo(id){
      if (!id || !isInDOM(id)) return;
      const h = '#'+id;
      if (h !== (location.hash || '#'+ROOT)){ history.pushState({id}, '', h); }
      setActivePage(id);
    }

    function showBack(){ try{ TG?.BackButton?.show && TG.BackButton.show(); }catch(_){ } }
    function hideBack(){ try{ TG?.BackButton?.hide && TG.BackButton.hide(); }catch(_){ } }
    function syncBack(){
      if (!TG) return;
      const atRoot = (currentId() === ROOT);
      const sheetOpen = sheetRoot?.classList.contains('is-open');
      if (sheetOpen || !atRoot) showBack(); else hideBack();
    }

    TG?.BackButton?.onClick?.(()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });
    TG?.onEvent?.('backButtonClicked', ()=>{
      if (sheetRoot && sheetRoot.classList.contains('is-open')){ closeSheet(); return; }
      const atRoot = (currentId() === ROOT);
      if (!atRoot) history.back();
    });

    window.addEventListener('popstate', ()=> setActivePage(currentId()));

    function haptic(level='light'){
      try{ TG?.HapticFeedback?.impactOccurred && TG.HapticFeedback.impactOccurred(level); }
      catch(_){ try{ navigator.vibrate && navigator.vibrate(level==='light'?10:16); }catch(_){} }
    }
    function openSheet({title='', html='', from='bottom'} = {}){
      if (!sheetRoot) return;
      sheetRoot.classList.toggle('sheet-bottom', from==='bottom');
      if (sheetTitle) sheetTitle.textContent = title || '';
      if (sheetBody && html != null) sheetBody.innerHTML = html;
      sheetRoot.classList.add('is-open'); document.body.classList.add('sheet-open');
      requestAnimationFrame(()=> sheetPanel?.focus({preventScroll:true}));
      haptic('light'); syncBack();
    }
    function closeSheet(){
      if (!sheetRoot) return;
      sheetRoot.classList.remove('is-open'); document.body.classList.remove('sheet-open');
      haptic('light'); syncBack();
    }
    window.openSheet = openSheet;
    window.closeSheet = closeSheet;

    sheetRoot?.addEventListener('click', (e)=>{ if (e.target.closest('[data-close-sheet]')) closeSheet(); });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && sheetRoot?.classList.contains('is-open')) closeSheet(); });

    let y0=0,y=0,drag=false;
    sheetPanel?.addEventListener('touchstart', e=>{ drag=true; y0=y=e.touches[0].clientY; sheetPanel.style.transition='none'; }, {passive:true});
    sheetPanel?.addEventListener('touchmove',  e=>{
      if(!drag) return; y=e.touches[0].clientY; const dy=Math.max(0,y-y0);
      if (TG && typeof TG.disableVerticalSwipes === 'function'){ e.preventDefault?.(); return; }
      sheetPanel.style.transform=`translateY(${dy}px)`;
    }, {passive:false});
    sheetPanel?.addEventListener('touchend',   ()=>{ if(!drag) return; drag=false; sheetPanel.style.transition=''; sheetPanel.style.transform=''; if (y-y0>100) closeSheet(); });

    const isiOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    if (isiOS && !(TG && typeof TG.disableVerticalSwipes === 'function')){
      let startY = 0;
      document.addEventListener('touchstart', e => { startY = e.touches[0].clientY; }, {passive:true});
      document.addEventListener('touchmove', e => {
        const dy = e.touches[0].clientY - startY;
        const atTop = (window.scrollY <= 0);
        if (dy > 0 && atTop){ e.preventDefault(); }
      }, {passive:false});
    }

    document.addEventListener('click', (e)=>{
      const openBtn = e.target.closest('[data-open-sheet]');
      if (openBtn){
        e.preventDefault();
        const tplSel = openBtn.dataset.tpl || '';
        const tpl    = tplSel ? document.querySelector(tplSel) : null;
        const html   = tpl ? tpl.innerHTML : '';
        const ttl    = openBtn.getAttribute('title') || openBtn.dataset.title || openBtn.textContent.trim() || '';
        const from   = openBtn.dataset.from || 'bottom';
        openSheet({ title: ttl, html, from });
        return;
      }
      const tab = e.target.closest('[data-page]');
      if (tab){
        e.preventDefault();
        navigateTo(tab.dataset.page);
      }
    });

    const start = currentId();
    history.replaceState({id:start}, '', '#'+start);
    setActivePage(start);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 0);
    setTimeout(()=>{ TG?.disableVerticalSwipes?.(); syncBack(); }, 300);
  })();
  </script>

<script>
(function introSlider(){
  const TG = window.Telegram && window.Telegram.WebApp;

  // ====== КОНФИГ КНОПОК ПО СЛАЙДАМ ======
  // Индексы соответствуют порядку секций .intro__slide в #intro-slides
  const INTRO_CFG = {
    actions: {
      0: [ // Слайд 0 — одна кнопка
        { label:'Продолжить', type:'primary', do:'next' }
      ],
      1: [ // Слайд 1 — две рядом
        { label:'Нет', type:'ghost', do:'answer', value:'no' },
        { label:'Да',  type:'primary', do:'navigate', to:'consult' } // перейти в раздел "Запись"
      ],
      2: [ // Слайд 2 — одна кнопка
        { label:'Продолжить', type:'primary', do:'done' }
      ],
      // Примеры для будущих слайдов:
      // 3: [
      //   { label:'Открыть сайт', type:'primary', do:'link', href:'https://example.com' }
      // ],
      // 4: [
      //   { label:'Показать окно', type:'primary', do:'sheet', title:'Демо', tpl:'#tpl-example', from:'bottom' }
      // ]
    },
    onAnswer: (index, value) => {
      // Твой хук на ответы "Да/Нет" и т.п.
      // Например: localStorage.setItem('intro_answer_'+index, value);
      // console.log('Answer on slide', index, '=>', value);
    }
  };

  // ====== DOM ======
  const root = document.getElementById('intro');
  if(!root) return;

  const slidesWrap = root.querySelector('#intro-slides');
  const slides = Array.from(root.querySelectorAll('.intro__slide'));
  const progress = root.querySelector('#intro-progress');
  const actions = root.querySelector('#intro-actions');

  // Прогресс
  progress.innerHTML = slides.map(()=>'<i class="intro__seg"></i>').join('');
  const segs = Array.from(progress.children);

  let idx = 0, touchX0=0, touchX=0, dragging=false, backHandler=null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };

  // Сервис: создать кнопку
  function btnHTML(cfg){
    const cls = ['intro__btn'];
    if (cfg.type === 'primary') cls.push('intro__btn--primary');
    if (cfg.type === 'ghost')   cls.push('intro__btn--ghost');
    const attrs = [];
    if (cfg.do) attrs.push(`data-act="${cfg.do}"`);
    if (cfg.value != null) attrs.push(`data-val="${String(cfg.value)}"`);
    if (cfg.to)    attrs.push(`data-to="${String(cfg.to)}"`);
    if (cfg.href)  attrs.push(`data-href="${String(cfg.href)}"`);
    if (cfg.title) attrs.push(`data-title="${String(cfg.title)}"`);
    if (cfg.tpl)   attrs.push(`data-tpl="${String(cfg.tpl)}"`);
    if (cfg.from)  attrs.push(`data-from="${String(cfg.from)}"`);
    return `<button class="${cls.join(' ')}" ${attrs.join(' ')}>${cfg.label}</button>`;
  }

  // Рендер низа (кнопок)
  function renderActions(){
    const set = INTRO_CFG.actions[idx] || defaultActions();
    // сетка: 1 / 2 / 3+
    actions.className = 'intro__actions';
    if (set.length === 1) actions.classList.add('intro__actions--one');
    else if (set.length === 2) actions.classList.add('intro__actions--two');
    else actions.classList.add('intro__actions--multi'); // см. CSS ниже
    actions.innerHTML = set.map(btnHTML).join('');
  }

  // Дефолт, если не задал для слайда: "Продолжить" или "Готово" на последнем
  function defaultActions(){
    const last = (idx === slides.length - 1);
    return [ { label: last ? 'Готово' : 'Продолжить', type:'primary', do: last ? 'done' : 'next' } ];
    // можно заменить на то, что тебе нужно по умолчанию
  }

  function apply(){
    slides.forEach((s,i)=> s.classList.toggle('active', i===idx));
    segs.forEach((d,i)=> d.classList.toggle('active', i<=idx));
    renderActions();
  }

  // Открыть / закрыть
  function openIntro(startIndex){
    if (Number.isInteger(startIndex)) idx = Math.max(0, Math.min(startIndex, slides.length-1));
    root.classList.add('is-open');
    document.body.classList.add('intro-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeIntro();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
    }catch(_){}

    apply();
    window.syncBack?.();
  }
  function closeIntro(){
    root.classList.remove('is-open');
    document.body.classList.remove('intro-open');

    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  function next(){ if(idx<slides.length-1){ idx++; apply(); haptic(); } }
  function prev(){ if(idx>0){ idx--; apply(); haptic(); } }

  // Жесты перелистывания
  slidesWrap.addEventListener('touchstart', e=>{ dragging=true; touchX0=touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchmove',  e=>{ if(!dragging) return; touchX=e.touches[0].clientX; }, {passive:true});
  slidesWrap.addEventListener('touchend',   ()=>{ if(!dragging) return; dragging=false;
    const dx = touchX - touchX0; if (Math.abs(dx)>50){ dx<0 ? next() : prev(); }
  });

  // Клики по кнопкам низа
  actions.addEventListener('click', (e)=>{
    const b = e.target.closest('[data-act]'); if(!b) return;
    const act  = b.getAttribute('data-act');
    const val  = b.getAttribute('data-val');
    const to   = b.getAttribute('data-to');
    const href = b.getAttribute('data-href');
    const title= b.getAttribute('data-title');
    const tpl  = b.getAttribute('data-tpl');
    const from = b.getAttribute('data-from') || 'bottom';

    switch(act){
      case 'next': next(); break;
      case 'prev': prev(); break;
      case 'done': haptic('medium'); closeIntro(); break;
      case 'answer':
        try{ INTRO_CFG.onAnswer && INTRO_CFG.onAnswer(idx, val); }catch(_){}
        next(); break;
      case 'navigate':
        closeIntro();
        if (typeof window.navigateTo === 'function') window.navigateTo(to);
        else if (to) location.hash = '#'+to;
        break;
      case 'link':
        try{ TG?.openLink ? TG.openLink(href) : window.open(href, '_blank'); }catch(_){}
        break;
      case 'sheet':
        closeIntro();
        if (typeof window.openSheet === 'function'){
          const tplNode = tpl ? document.querySelector(tpl) : null;
          const html = tplNode ? tplNode.innerHTML : '<div class="card"><b>Нет шаблона</b></div>';
          window.openSheet({ title, html, from });
        }
        break;
    }
  });

  // Открывать по кнопке: data-open-intro или data-open-intro="2" (старт слайд 2)
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-intro]');
    if (!t) return;
    e.preventDefault();
    const start = parseInt(t.getAttribute('data-open-intro'), 10);
    openIntro(Number.isFinite(start) ? start : undefined);
  });

  // Экспорт (если захочешь открыть из кода)
  window.openIntro  = openIntro;
  window.closeIntro = closeIntro;
})();
</script>


<script>
  /* ===== FULLSCREEN CLICKER ===== */
(function(){
  const TG = window.Telegram && window.Telegram.WebApp;
  const root   = document.getElementById('clicker');
  if (!root) return;

  const stage  = document.getElementById('clicker-stage');
  const counterEl = document.getElementById('clicker-counter');

  let diamonds = 0;
  let backHandler = null;

  const haptic = (lvl='light') => { try{ TG?.HapticFeedback?.impactOccurred(lvl); }catch(_){ } };

  function updateCounter(){
    counterEl.textContent = `◆ ${diamonds}`;
  }

  function spawnAt(x, y){
    // ромбик
    const s = document.createElement('div');
    s.className = 'spark';
    s.textContent = '◆';
    s.style.left = x+'px'; s.style.top = y+'px';
    stage.appendChild(s);
    s.addEventListener('animationend', ()=> s.remove());

    // рипл
    const r = document.createElement('i');
    r.className = 'ripple';
    r.style.left = x+'px'; r.style.top = y+'px';
    stage.appendChild(r);
    r.addEventListener('animationend', ()=> r.remove());
  }

  function onClick(e){
    const rect = stage.getBoundingClientRect();
    const cx = (e.touches?.[0]?.clientX ?? e.clientX) - rect.left;
    const cy = (e.touches?.[0]?.clientY ?? e.clientY) - rect.top;
    diamonds += 1; updateCounter(); haptic('medium'); spawnAt(cx, cy);
  }

  function openClicker(){
    root.classList.add('is-open');
    document.body.classList.add('clicker-open');

    try{
      TG?.BackButton?.show?.();
      backHandler = ()=> closeClicker();
      TG?.BackButton?.onClick?.(backHandler);
      TG?.disableVerticalSwipes?.();
      TG?.expand?.();
    }catch(_){}

    window.syncBack?.();
  }

  function closeClicker(){
    root.classList.remove('is-open');
    document.body.classList.remove('clicker-open');

    try{ TG?.BackButton?.offClick?.(backHandler); backHandler=null; }catch(_){}
    if (typeof window.syncBack === 'function') window.syncBack(); else try{ TG?.BackButton?.hide?.(); }catch(_){}
  }

  // клики/тачи по зоне
  stage.addEventListener('click', onClick);
  stage.addEventListener('touchstart', onClick, {passive:true});

  // esc на десктопе
  document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && root.classList.contains('is-open')) closeClicker(); });

  // делегирование открытия по кнопкам с data-open-clicker
  document.addEventListener('click', (e)=>{
    const t = e.target.closest('[data-open-clicker]');
    if (!t) return;
    e.preventDefault();
    diamonds = 0; updateCounter();
    openClicker();
  });

  // экспорт если нужно открыть из кода
  window.openClicker = openClicker;
  window.closeClicker = closeClicker;
})();

</script>


</body>
</html>
