<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –£—á—ë—Ç ‚Äî –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="format-detection" content="telephone=no" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b0d10; --card:#12161c; --muted:#7b8496; --text:#e8eef9; --primary:#69e1d0; --accent:#7b5bff; --border:rgba(255,255,255,0.08);
      --radius:14px; --pad:14px; --content-max:1080px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b0d10 0%,#0e1218 100%);color:var(--text);font:16px/1.45 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{max-width:var(--content-max);margin:0 auto;padding:16px 14px 48px;}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .brand-wrap{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:9px;background:#0f1318;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .brand{font-family:Montserrat,Inter,sans-serif;font-weight:700;letter-spacing:.2px}

    nav#spa-nav{position:sticky;top:0;z-index:20;display:flex;gap:8px;overflow:hidden;padding:6px;margin:8px 0 18px;background:rgba(10,12,22,.65);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.35)}
    #spa-nav .track{display:flex;gap:8px;overflow-x:auto;scroll-snap-type:x mandatory;-ms-overflow-style:none;scrollbar-width:none}
    #spa-nav .track::-webkit-scrollbar{display:none}
    #spa-nav .btn{appearance:none;border:1px solid transparent;background:transparent;color:var(--text);font-weight:700;font-size:14px;padding:9px 12px;border-radius:12px;cursor:pointer;text-decoration:none;transition:.18s;white-space:nowrap;position:relative;flex:0 0 auto}
    #spa-nav .btn.active{background:linear-gradient(135deg,var(--accent),var(--primary));color:#0b0f12;box-shadow:0 10px 22px rgba(91,140,255,.35)}
    #spa-nav .bubble{position:absolute;z-index:0;height:32px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--primary));box-shadow:0 10px 22px rgba(91,140,255,.35);transition:left .24s,width .24s;will-change:left,width}

    .h1{font-size:19px;line-height:1.2;font-weight:800;margin:14px 0 10px}
    .h1 span{background:linear-gradient(90deg,var(--accent),var(--primary));-webkit-background-clip:text;color:transparent}
    .lead{color:var(--muted);font-size:17px;max-width:820px}

    .grid{display:grid;gap:14px}
    @media(min-width:920px){.grid-2{grid-template-columns:repeat(2,1fr)}.h1{font-size:44px}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:20px;padding:18px;backdrop-filter:blur(8px)}
    .card h3{margin:0 0 8px;font-size:18px}

    .list{list-style:none;margin:0;padding:0;display:grid;gap:10px;color:var(--muted)}
    .list li{display:flex;gap:10px;align-items:flex-start}
    .dot{width:10px;height:10px;border-radius:50%;margin-top:6px;background:linear-gradient(135deg,var(--primary),var(--accent))}

    .cta{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .btn{appearance:none;border:1px solid var(--border);background:#141a21;color:var(--text);padding:10px 12px;border-radius:14px;cursor:pointer;transition:.18s}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--primary));color:#0b0f12;border-color:transparent;font-weight:800}
    .btn-ghost{background:transparent;border-color:var(--border);color:var(--text)}

    .highlight-banner{margin:14px 0;padding:12px 14px;border-radius:12px;background:linear-gradient(135deg,rgba(61,224,197,.14),rgba(123,91,255,.14));color:var(--primary);font-weight:600;font-size:15px}

    /* Calendar */
    .cal-wrap{display:grid;gap:12px}
    .dur-row{display:flex;gap:8px;flex-wrap:wrap}
    .calendar{user-select:none;background:#0f141a;border:1px solid var(--border);border-radius:12px;padding:10px}
    .cal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .cal-head .mon{font-weight:800}
    .cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .cal-cell{height:36px;display:grid;place-items:center;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);font-weight:600;cursor:pointer;transition:transform .15s ease, background .15s ease, color .15s ease}
    .cal-cell:hover{transform:translateY(-1px)}
    .cal-cell.muted{opacity:.35}
    .cal-cell.off{opacity:.25;pointer-events:none}
    .cal-cell.sel{color:#0b0f12;background:linear-gradient(135deg,var(--accent),var(--primary));border-color:transparent}
    .cal-dow{opacity:.6;font-weight:700;font-size:12px}

    .slots{display:flex;gap:8px;flex-wrap:wrap;opacity:0;transform:translateY(4px);transition:all .2s ease}
    .slots.show{opacity:1;transform:translateY(0)}
    .contact-row{display:flex;gap:8px;flex-wrap:wrap}
    input[type="tel"],input[type="text"]{flex:1;min-width:220px;background:#0f141a;border:1px solid var(--border);border-radius:12px;color:var(--text);padding:10px 12px;font-size:16px;outline:none}
    input::placeholder{color:#6e7786}

    /* Toasts */
    .toasts{position:fixed;right:12px;bottom:12px;display:grid;gap:8px;z-index:99999}
    .toast{background:#0f1318;border:1px solid var(--border);border-radius:12px;padding:10px 12px;box-shadow:0 8px 30px rgba(0,0,0,.35)}
    .toast .t{font-weight:800;margin-bottom:2px}
    .toast .m{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand-wrap">
        <div class="logo" aria-label="logo"></div>
        <div>
          <div class="brand">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –£—á—ë—Ç</div>
          <div class="slogan" style="color:var(--muted);font-size:13px">–°—á–∏—Ç–∞–µ–º –ø—Ä–∏–±—ã–ª—å, –∞ –Ω–µ –∫–ª–∏–∫–∏</div>
        </div>
      </div>
    </header>

    <nav id="spa-nav"><div class="track">
      <a class="btn active" data-page="home" href="#home">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a class="btn" data-page="services" href="#services">üß© –£—Å–ª—É–≥–∏</a>
      <a class="btn" data-page="about" href="#about">üë©‚Äçüíº –û–±–æ –º–Ω–µ</a>
      <a class="btn" data-page="bonuses" href="#bonuses">üéÅ –ë–æ–Ω—É—Å—ã</a>
      <a class="btn" data-page="consult" href="#consult">üìÖ –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</a>
      <a class="btn" data-page="invite" href="#invite">üéØ –ü–∞—Ä—Ç–Ω—ë—Ä–∫–∞</a>
      <span class="bubble" aria-hidden="true"></span>
    </div></nav>

    <main>
      <!-- HOME -->
      <section class="card" id="home">
        <div class="h1">–ü–æ–∫–∞–∂–µ–º, –≥–¥–µ —É—Ç–µ–∫–∞—é—Ç –¥–µ–Ω—å–≥–∏ –∏ <span>–¥–∞–¥–∏–º –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π</span> —Å –ø–æ–Ω—è—Ç–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–µ–π</div>
        <p class="lead">‚ùóÔ∏è <strong>–ï—Å–ª–∏ –ø–æ –∏—Ç–æ–≥–∞–º –Ω–µ —Å—Ç–∞–Ω–µ—Ç —è—Å–Ω–æ</strong>, –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –¥–∞—Ä–∏–º 60 –º–∏–Ω—É—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.</p>
        <div class="grid grid-2" style="margin-top:14px">
          <div class="card" style="background:transparent;border-color:transparent;padding:0">
            <div class="h1" style="margin-bottom:10px">–ë—ã—Å—Ç—Ä—ã–π <span>—Ä–∞—Å—á—ë—Ç –ø—Ä–∏–±—ã–ª–∏</span></div>
            <div class="cta"><button class="btn btn-primary" id="ctaCalc">–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</button></div>
          </div>
          <div class="card">
            <div class="h1" style="margin-bottom:20px">–ß—Ç–æ <span>–¥–µ–ª–∞—Ç—å</span> –¥–∞–ª—å—à–µ</div>
            <ul class="list">
              <li><span class="dot"></span>–ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –≤ –±–æ—Ç–µ</li>
              <li><span class="dot"></span>–§–∏–∫—Å–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ ¬´—É—Ç–µ—á–µ–∫¬ª</li>
              <li><span class="dot"></span>–§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω</li>
            </ul>
            <div class="highlight-banner" style="text-align:left"><strong>–ë–æ–Ω—É—Å:</strong> –º–∏–Ω–∏‚Äë–≥–∞–π–¥ ¬´–ö–∞–∫ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≤—ã–≥–æ–¥–Ω—ã–π —Ä–µ–∂–∏–º¬ª</div>
          </div>
        </div>
      </section>

      <!-- BONUSES -->
      <section class="card" id="bonuses" style="margin-top:18px">
        <h2>–ë–æ–Ω—É—Å—ã</h2>
        <div class="btn-row cta">
          <button class="btn bonus" data-code="–û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é">–û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</button>
          <button class="btn bonus" data-code="–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º">–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º</button>
          <button class="btn bonus" data-code="–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —ç–∫—Å–ø—Ä–µ—Å—Å-–∞—É–¥–∏—Ç">–ü–æ–ª—É—á–∏—Ç—å —ç–∫—Å–ø—Ä–µ—Å—Å‚Äë–∞—É–¥–∏—Ç</button>
        </div>
      </section>

      <!-- WHEEL -->
      <section class="card" id="wheel" style="margin-top:18px">
        <h2>–ö–æ–ª–µ—Å–æ –ø—Ä–∏–∑–æ–≤</h2>
        <div class="cta"><button class="btn" id="spin">–ö—Ä—É—Ç–∏—Ç—å üé°</button></div>
        <div id="spinRes" class="muted">‚Äî</div>
      </section>

      <!-- CONSULT (Calendar) -->
      <section class="card cal-wrap" id="consult" style="margin-top:18px">
        <h2>–ó–∞–ø–∏—Å—å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</h2>
        <div class="dur-row">
          <button class="btn dur btn-primary" data-min="30">30 –º–∏–Ω</button>
          <button class="btn dur" data-min="60">60 –º–∏–Ω</button>
          <button class="btn dur" data-min="90">90 –º–∏–Ω</button>
        </div>
        <div id="cal" class="calendar"></div>
        <div id="slots" class="slots"></div>
        <div class="contact-row">
          <input id="contact" type="tel" inputmode="numeric" placeholder="@username –∏–ª–∏ +79991234567" />
          <button id="confirmConsult" class="btn btn-primary">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
      </section>

      <!-- PROFILE (light) -->
      <section class="card" id="profile" style="margin-top:18px">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
        <div><b>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–∑:</b> <span id="profPrize">‚Äî</span></div>
        <div><b>–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å:</b> <span id="profBook">‚Äî</span></div>
        <div><b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ—á–∫–∏:</b> <span id="profPoints">‚Äî</span></div>
        <div class="muted" id="profHint">–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ; –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è‚Ä¶</div>
      </section>

    </main>

    <div class="toasts" aria-live="polite"></div>
  </div>

  <!-- Telegram SDK (–µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –≤ WebApp) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    /* ==== CONFIG ==== */
    window.APP_CONFIG = window.APP_CONFIG || {};
    APP_CONFIG.API_BASE = APP_CONFIG.API_BASE || "https://cifrovichkoff.cyberian13.workers.dev"; // ‚Üê –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –≤–æ—Ä–∫–µ—Ä
    APP_CONFIG.ENABLE_HOOKS = (APP_CONFIG.ENABLE_HOOKS ?? true);

    /* ==== –ê–≤—Ç–æ–±—Ä–µ–Ω–¥–∏–Ω–≥: –ª–æ–≥–æ—Ç–∏–ø + —Ñ–∞–≤–∏–∫–æ–Ω–∫–∏ ==== */
    (function autoBrand(){
      const host = document.querySelector('.logo');
      if (host){
        const cand = ['logo.svg','logo.png','logo.jpg','logo.webp'];
        (async () => { for (const f of cand){ try{ const r=await fetch(f,{method:'HEAD'}); if(r.ok){ const img=new Image(); img.src=f; img.alt='logo'; img.style.cssText='width:100%;height:100%;object-fit:cover;border-radius:inherit;display:block'; host.innerHTML=''; host.appendChild(img); break; } }catch(_){}} })();
      }
      ['favicon-16.png','favicon.png','favicon.ico','logo.svg'].forEach(h=>{ const l=document.createElement('link'); l.rel='icon'; l.href=h; document.head.appendChild(l); });
    })();

    /* ==== Toast (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è) ==== */
    const __toasts = new Set();
    function showToast(title, msg='', key='', timeout=2600){
      if (key && __toasts.has(key)) return; if (key) __toasts.add(key);
      let box=document.querySelector('.toasts'); const t=document.createElement('div'); t.className='toast';
      t.innerHTML=`<div class="t">${title}</div>${msg?`<div class="m">${msg}</div>`:''}`; box.appendChild(t);
      setTimeout(()=>{ t.remove(); if(key) __toasts.delete(key); }, timeout);
    }

    /* ==== –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ —É –∫–Ω–æ–ø–∫–∏ ==== */
    function blastConfetti(btn, count=24){
      try{
        const rect = btn.getBoundingClientRect(); const root=document.createElement('div');
        root.style.cssText = `position:fixed;left:${rect.left}px;top:${rect.top}px;width:${rect.width}px;height:${rect.height}px;pointer-events:none;overflow:visible;z-index:9999`;
        document.body.appendChild(root);
        for(let i=0;i<count;i++){
          const p=document.createElement('i'); const x=rect.width/2, y=rect.height/2; const dx=(Math.random()*2-1)*80, dy=(Math.random()*-1)*120-40; const rot=(Math.random()*360)|0; const size=6+(Math.random()*6|0);
          p.style.cssText=`position:absolute;left:${x}px;top:${y}px;width:${size}px;height:${size}px;background:currentColor;border-radius:2px;transform:translate(-50%,-50%) rotate(${rot}deg);opacity:1`;
          p.style.color=['#7b5bff','#3de0c5','#5b8cff','#ffffff'][i%4]; root.appendChild(p);
          const tx=x+dx, ty=y+dy;
          p.animate([{transform:`translate(-50%,-50%) rotate(${rot}deg)`,opacity:1},{transform:`translate(${tx-rect.left}px,${ty-rect.top}px) rotate(${rot+180}deg)`,opacity:0}],{duration:700+(Math.random()*400|0),easing:'cubic-bezier(.2,.8,.2,1)'}).onfinish=()=>p.remove();
        }
        setTimeout(()=>root.remove(),1200);
      }catch(_){}
    }

    /* ==== Telegram context ==== */
    const tg = (window.Telegram && Telegram.WebApp) ? Telegram.WebApp : null;
    function getTgId(){ try{ return tg?.initDataUnsafe?.user?.id || null }catch(_){ return null } }
    function getStartParam(){ try{ return tg?.initDataUnsafe?.start_param || '' }catch(_){ return '' } }
    function getInitData(){ try{ return tg?.initData || '' }catch(_){ return '' } }
    try{ tg?.ready(); tg?.expand?.(); }catch(_){}

    /* ==== API helpers ==== */
    function qp(base, params){ const u=new URL(base); Object.entries(params||{}).forEach(([k,v])=>{ if(v!==undefined&&v!==null) u.searchParams.set(k,String(v)); }); return u; }
    async function apiGet(path, params){ const r=await fetch(qp(APP_CONFIG.API_BASE+path, params)); const t=await r.text(); try{return JSON.parse(t)}catch{return {ok:false,error:'bad_json',raw:t}} }
    async function apiPost(path, body){ body=body||{}; if(!body.tg_id) body.tg_id=String(getTgId()||''); if(!body._start_param) body._start_param=getStartParam(); if(!body._init_data) body._init_data=getInitData(); const r=await fetch(APP_CONFIG.API_BASE+path,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)}); const t=await r.text(); try{return JSON.parse(t)}catch{return {ok:false,error:'bad_json',raw:t}} }

    /* ==== –¢–µ–ª–µ—Ñ–æ–Ω: –º—è–≥–∫–∞—è –º–∞—Å–∫–∞ + –∞–Ω—Ç–∏‚Äëzoom ==== */
    (function phoneMask(){ const el=document.getElementById('contact'); if(!el) return; el.setAttribute('inputmode','numeric'); el.setAttribute('autocomplete','tel'); el.style.fontSize='16px'; const fmt=v=>{ const d=(v||'').replace(/\D+/g,''); let p=d; if(p.startsWith('8')) p='7'+p.slice(1); if(!p.startsWith('7')) p='7'+p; return '+'+p.slice(0,11) }; el.addEventListener('input', ()=>{ const s=el.selectionStart, before=el.value, after=fmt(before); el.value=after; const shift=after.length-before.length; el.setSelectionRange(s+shift, s+shift); }); })();

    /* ==== –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç ==== */
    (function personalCalc(){ const btn=document.getElementById('ctaCalc'); if(!btn) return; btn.addEventListener('click', async ()=>{ blastConfetti(btn, 28); showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞','–ü–æ–¥–≥–æ—Ç–æ–≤–∏–º –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç','calc_sent'); if(!APP_CONFIG.ENABLE_HOOKS) return; try{ await apiPost('/api/prize/code',{code:'–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç'}); }catch(_){}}); })();

    /* ==== –ö–æ–ª–µ—Å–æ –ø—Ä–∏–∑–æ–≤ ==== */
    (function wheel(){ const btn=document.getElementById('spin'), out=document.getElementById('spinRes'); if(!btn||!out) return; btn.addEventListener('click', async ()=>{ blastConfetti(btn, 30); try{ const res=await apiPost('/api/prize/spin',{}); if(res?.ok){ out.textContent='–í—ã–ø–∞–ª–æ: '+(res.prize?.title||'–ø—Ä–∏–∑'); showToast('–ü—Ä–∏–∑ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω','–°–º–æ—Ç—Ä–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ','spin_ok'); } else { out.textContent='–ö—Ä—É—Ç–∏–ª–∫–∞ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞'; showToast('–°–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ','–í–µ–¥–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ','spin_warn'); } }catch(_){ out.textContent='–û—à–∏–±–∫–∞ —Å–µ—Ç–∏'; } }); })();

    /* ==== –ë–æ–Ω—É—Å—ã ==== */
    (function bonuses(){ document.querySelectorAll('.btn.bonus').forEach(btn=>{ btn.addEventListener('click', async ()=>{ const code=btn.dataset.code||'–ë–æ–Ω—É—Å'; blastConfetti(btn,24); showToast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',code,`bonus_${code}`); if(!APP_CONFIG.ENABLE_HOOKS) return; try{ await apiPost('/api/prize/code',{code}); }catch(_){} }); }); })();

    /* ==== –û–Ω–±–æ—Ä–¥–∏–Ω–≥-–±–æ–Ω—É—Å +100 ==== */
    (function welcomeBonus(){ if(localStorage.getItem('onb_bonus_v1')) return; localStorage.setItem('onb_bonus_v1','1'); (async()=>{ try{ await apiPost('/api/bonus/grant',{kind:'welcome',points:100}); }catch(_){ } showToast('+100 –±–æ–Ω—É—Å–æ–≤','–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–º üëã','onb100',3000); })(); })();

    /* ================== –ö–ê–õ–ï–ù–î–ê–†–¨ ================== */
    (function calendar(){
      const calWrap=document.getElementById('cal'), slotsBox=document.getElementById('slots');
      const tz=Intl.DateTimeFormat().resolvedOptions().timeZone||'Europe/Moscow';
      const durBtns=[...document.querySelectorAll('.dur')];
      const confirmBtn=document.getElementById('confirmConsult');
      const contactEl=document.getElementById('contact');
      if(!calWrap||!slotsBox||!confirmBtn) return;

      let cur=new Date(), y=cur.getFullYear(), m=cur.getMonth();
      let FREE={}, selDate=null, selTime=null, selDur=30, GRAN=30, SERVER_FILTERED=false;

      durBtns.forEach(b=>{ b.addEventListener('click', async ()=>{ durBtns.forEach(x=>x.classList.remove('btn-primary')); b.classList.add('btn-primary'); selDur=+b.dataset.min||30; await syncMonth(); if(selDate) renderSlots(selDate); }); });

      function dd2(n){return String(n).padStart(2,'0')}
      function drawCalendar(){ calWrap.innerHTML=''; const head=document.createElement('div'); head.className='cal-head'; const mon=new Date(y,m,1); const label=mon.toLocaleDateString('ru-RU',{month:'long',year:'numeric'}); head.innerHTML=`<div class="mon">${label[0].toUpperCase()+label.slice(1)}</div><div class="cta"><button class="btn btn-ghost" id="pm">‚óÄ</button><button class="btn btn-ghost" id="nm">‚ñ∂</button></div>`; calWrap.appendChild(head); const grid=document.createElement('div'); grid.className='cal-grid'; calWrap.appendChild(grid); ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(d=>{const c=document.createElement('div'); c.className='cal-cell cal-dow'; c.textContent=d; grid.appendChild(c);}); const firstDow=(new Date(y,m,1).getDay()+6)%7; for(let i=0;i<firstDow;i++){const s=document.createElement('div'); s.className='cal-cell muted'; grid.appendChild(s);} const count=new Date(y,m+1,0).getDate(); for(let d=1; d<=count; d++){ const iso=`${y}-${dd2(m+1)}-${dd2(d)}`; const cell=document.createElement('div'); cell.className='cal-cell'; cell.textContent=d; cell.dataset.iso=iso; cell.onclick=()=>{ selDate=iso; renderSlots(iso); grid.querySelectorAll('.cal-cell.sel').forEach(x=>x.classList.remove('sel')); cell.classList.add('sel'); }; grid.appendChild(cell);} document.getElementById('pm').onclick=async()=>{ m--; if(m<0){m=11;y--;} await syncMonth(true);}; document.getElementById('nm').onclick=async()=>{ m++; if(m>11){m=0;y++;} await syncMonth(true);}; applyDaysState(); }

      function applyDaysState(){ const grid=calWrap.querySelector('.cal-grid'); grid.querySelectorAll('.cal-cell').forEach(cell=>{ if(!cell.dataset.iso) return; const arr=FREE[cell.dataset.iso]||[]; const off=!(Array.isArray(arr)&&arr.length); cell.classList.toggle('off', off); cell.classList.toggle('muted', off); }); }

      function filterStartsByDuration(starts,dur,step){ if(!Array.isArray(starts)||!starts.length) return []; const toMin=t=>{ const m=t.match(/(\d{1,2}):(\d{2})/); return m?(+m[1])*60+(+m[2]):null }; const need=Math.ceil(dur/step); const set=new Set(starts.map(toMin).filter(x=>x!=null)); return starts.filter(t=>{ const m=toMin(t); if(m==null) return false; for(let i=0;i<need;i++){ if(!set.has(m+i*step)) return false } return true; }); }

      function renderSlots(dateIso){ slotsBox.innerHTML=''; slotsBox.classList.add('show'); selTime=null; const arr=FREE[dateIso]||[]; const list=SERVER_FILTERED?arr:filterStartsByDuration(arr, selDur, GRAN); if(!list.length){ slotsBox.innerHTML=`<div class="muted">–ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –¥–ª—è ${selDur} –º–∏–Ω</div>`; return; } list.forEach(t=>{ const b=document.createElement('button'); b.className='btn'; b.textContent=t; b.dataset.time=t; b.onclick=()=>{ slotsBox.querySelectorAll('.btn').forEach(x=>x.classList.remove('btn-primary')); b.classList.add('btn-primary'); selTime=t; }; slotsBox.appendChild(b); }); }

      async function syncMonth(keepSel=false){ const first=`${y}-${dd2(m+1)}-01`; const last=`${y}-${dd2(m+1)}-${dd2(new Date(y,m+1,0).getDate())}`; const data=await apiGet('/api/slots/free',{from:first,to:last,tz,lead_min:60,duration_min:selDur}); if(data?.ok){ FREE=data.days||{}; GRAN=data.gran||30; SERVER_FILTERED=!!data.filtered_by_duration; drawCalendar(); if(keepSel && selDate && FREE[selDate]?.length){ const cell=calWrap.querySelector(`.cal-cell[data-iso="${selDate}"]`); if(cell){ cell.classList.add('sel'); renderSlots(selDate); } } else { const days=Object.keys(FREE).filter(d=>(FREE[d]||[]).length).sort(); selDate=days[0]||null; if(selDate){ const cell=calWrap.querySelector(`.cal-cell[data-iso="${selDate}"]`); if(cell) cell.classList.add('sel'); renderSlots(selDate); } else { slotsBox.innerHTML='<div class="muted">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –¥–∞—Ç</div>'; } } } else { showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏','–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ—Ç—ã','slots_err'); } }

      confirmBtn.addEventListener('click', async ()=>{ if(!selDate||!selTime){ showToast('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ—Ç','–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã','pick_warn'); return; } const contact=(contactEl?.value||'').trim(); if(!contact){ showToast('–ù—É–∂–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç','–¢–µ–ª–µ–≥—Ä–∞–º @username –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω','contact_warn'); return; } confirmBtn.disabled=true; try{ const hold=await apiPost('/api/slots/hold',{date:selDate,time:selTime,duration_min:selDur}); if(!hold?.ok){ await syncMonth(true); showToast('–°–ª–æ—Ç –∑–∞–Ω—è—Ç','–û–±–Ω–æ–≤–∏–ª —Å–ª–æ—Ç—ã','taken'); return; } const res=await apiPost('/api/consult/book',{date:selDate,time:selTime,duration_min:selDur,format:'call',contact}); if(res?.ok){ blastConfetti(confirmBtn,36); showToast('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞','–ú—ã —Å–≤—è–∂–µ–º—Å—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è','booked',3200); await syncMonth(true); } else { showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø–∏—Å–∞—Ç—å','–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Å–ª–æ—Ç','book_err'); await syncMonth(true); } } finally { confirmBtn.disabled=false; } });

      // init
      syncMonth();
    })();

    /* ==== –ü—Ä–æ—Ñ–∏–ª—å: –±—ã—Å—Ç—Ä–∞—è –≤—Å—Ç–∞–≤–∫–∞ + –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥—Ç—è–∂–∫–∞ ==== */
    (function profile(){ (async()=>{ try{ const res=await apiPost('/api/bootstrap',{}); if(res?.last_booking){ document.getElementById('profBook').textContent = `${res.last_booking.date} ${res.last_booking.time}`; } const lp=res?.last_prize?.title || (res?.prizes && res.prizes[0]?.title); if(lp) document.getElementById('profPrize').textContent=lp; if(typeof res?.points==='number') document.getElementById('profPoints').textContent=String(res.points); document.getElementById('profHint').textContent='–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.'; }catch(_){ /* —Ç–∏—Ö–æ */ } })(); })();

    /* ==== –ü—Ä–æ—Å—Ç–∞—è SPA-–Ω–∞–≤–∏–≥–∞—Ü–∏—è + –ø—É–∑—ã—Ä—å-–∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ==== */
    (function nav(){ const nav=document.getElementById('spa-nav'); if(!nav) return; const bubble=nav.querySelector('.bubble'); function activate(hash){ const page=(hash||location.hash||'#home').replace('#',''); document.querySelectorAll('main > section, section.page').forEach(s=>{ s.style.display = (s.id===page)?'block':'none'; }); nav.querySelectorAll('.btn').forEach(a=>a.classList.toggle('active', a.dataset.page===page)); const act=nav.querySelector('.btn.active'); if(act){ const r=act.getBoundingClientRect(); const n=nav.getBoundingClientRect(); bubble.style.left=(r.left-n.left)+'px'; bubble.style.width=r.width+'px'; } } window.addEventListener('hashchange',()=>activate()); activate(); setTimeout(()=>activate(),50); })();
  </script>
</body>
</html>
